<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sentimento de Mercado â€“ DireÃ§Ã£o do Dia</title>

<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>

<style>
    body {
        margin: 0;
        background: #0e0e0e;
        color: #e0e0e0;
        font-family: Arial, sans-serif;
    }
    h2 {
        padding: 12px;
    }
    #chart {
        width: 100vw;
        height: 520px;
    }
</style>
</head>

<body>

<h2>ðŸ“Š Sentimento de Mercado â€“ DireÃ§Ã£o do Dia</h2>
<div id="chart"></div>

<script>
/* â”€â”€â”€â”€â”€ ConfiguraÃ§Ã£o â”€â”€â”€â”€â”€ */
const container = document.getElementById('chart');
const MAX_POINTS = 390; // 1 dia intraday (1 min)

/* â”€â”€â”€â”€â”€ GrÃ¡fico â”€â”€â”€â”€â”€ */
const chart = LightweightCharts.createChart(container, {
    width: container.clientWidth,
    height: container.clientHeight,
    layout: {
        background: { color: '#0e0e0e' },
        textColor: '#cfcfcf',
    },
    grid: {
        vertLines: { color: '#222' },
        horzLines: { color: '#222' },
    },
    timeScale: {
        timeVisible: true,
        secondsVisible: false,
    },
});

/* â”€â”€â”€â”€â”€ SÃ©ries â”€â”€â”€â”€â”€ */
const riskSeries = chart.addLineSeries({
    color: '#00ff88',
    lineWidth: 3,
});

const safetySeries = chart.addLineSeries({
    color: '#ff4444',
    lineWidth: 3,
});

/* â”€â”€â”€â”€â”€ Estado â”€â”€â”€â”€â”€ */
let risk = 100;
let safety = 100;

const riskData = [];
const safetyData = [];

/* â”€â”€â”€â”€â”€ FunÃ§Ã£o de update (1 minuto real) â”€â”€â”€â”€â”€ */
function update() {

    const now = Math.floor(Date.now() / 1000);

    // movimentos coerentes com sua tabela
    risk *= 1 + (Math.random() - 0.5) * 0.003;
    safety *= 1 + (Math.random() - 0.5) * 0.0015;

    riskData.push({ time: now, value: risk });
    safetyData.push({ time: now, value: safety });

    // manter apenas 1 dia
    if (riskData.length > MAX_POINTS) {
        riskData.shift();
        safetyData.shift();
    }

    riskSeries.setData(riskData);
    safetySeries.setData(safetyData);
}

/* â”€â”€â”€â”€â”€ InicializaÃ§Ã£o (preenche histÃ³rico atÃ© agora) â”€â”€â”€â”€â”€ */
(function init() {
    const now = Math.floor(Date.now() / 1000);
    let t = now - MAX_POINTS * 60;

    for (let i = 0; i < MAX_POINTS; i++) {
        risk *= 1 + (Math.random() - 0.5) * 0.002;
        safety *= 1 + (Math.random() - 0.5) * 0.001;

        riskData.push({ time: t, value: risk });
        safetyData.push({ time: t, value: safety });

        t += 60;
    }

    riskSeries.setData(riskData);
    safetySeries.setData(safetyData);
})();

/* â”€â”€â”€â”€â”€ AtualizaÃ§Ã£o automÃ¡tica a cada 1 minuto â”€â”€â”€â”€â”€ */
setInterval(update, 60000);

/* â”€â”€â”€â”€â”€ Resize â”€â”€â”€â”€â”€ */
window.addEventListener('resize', () => {
    chart.resize(container.clientWidth, container.clientHeight);
});
</script>

</body>
</html>
