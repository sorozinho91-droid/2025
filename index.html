
<!DOCTYPE html>
<html>
<head>
    <title>Indicador Risco x Segurança</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
<h2>Indicador Risco x Segurança (Atualização Automática)</h2>

<label>Selecionar Time Frame: </label>
<select id="timeframe" onchange="updateInterval()">
    <option value="30000">30 segundos</option>
    <option value="60000">1 minuto</option>
</select>

<div id="grafico" style="width:100%;height:600px;"></div>

<script>
    // Valores iniciais simulados para Risco e Segurança
    let valorRisco = 1000;
    let valorSeguranca = 1000;

    let data = [
        {x:[new Date()], y:[valorRisco], name:"Risco", mode:'lines', line:{color:'red', dash:'dash'}},
        {x:[new Date()], y:[valorSeguranca], name:"Segurança", mode:'lines', line:{color:'blue'}}
    ];

    const layout = {title:'Indicador Risco x Segurança', xaxis:{title:'Data/Hora'}, yaxis:{title:'Valor'}, legend:{orientation:"h"}};
    Plotly.newPlot('grafico', data, layout);

    let intervalTime = 30000;
    let intervalID = setInterval(updateData, intervalTime);

    function updateData(){
        const now = new Date();

        // Atualiza valores simulando variação percentual pequena (+-0.5%)
        valorRisco = valorRisco * (1 + (Math.random()-0.5)/100);
        valorSeguranca = valorSeguranca * (1 + (Math.random()-0.5)/100);

        data[0].x.push(now);
        data[0].y.push(valorRisco);

        data[1].x.push(now);
        data[1].y.push(valorSeguranca);

        // Mantém últimos 20 pontos
        data.forEach(trace => {
            if(trace.x.length > 20){ trace.x.shift(); trace.y.shift(); }
        });

        Plotly.update('grafico', data);
    }

    function updateInterval(){
        clearInterval(intervalID);
        intervalTime = parseInt(document.getElementById("timeframe").value);
        intervalID = setInterval(updateData, intervalTime);
    }
</script>
</body>
</html>
