<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Diagnóstico Financeiro Real - Completo</title>
    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; }
        .dashboard-container { max-width: 800px; margin: auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        header h1 { text-align: left; color: #000; border-bottom: 2px solid #eee; padding-bottom: 10px; font-size: 1.2rem; }
        .indicator-grid { display: flex; gap: 20px; flex-wrap: wrap; }
        .indicator-section { flex: 1; min-width: 200px; padding: 15px; border-radius: 5px; background-color: #fafafa; }
        .indicator-section h2 { font-size: 1.1rem; font-weight: 700; }
        .value { font-size: 1.5rem; font-weight: bold; margin-top: 5px; }
        .change { font-size: 0.9rem; margin-top: 5px; }
        .positive { color: green; }
        .negative { color: red; }
        .neutral { color: gray; }
        #diagnostico-consolidado { margin-top: 20px; padding: 15px; border-radius: 5px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header>
            <h1>PAINEL DE INDICADORES - DIAGNÓSTICO DO MOMENTO</h1>
        </header>

        <main class="indicator-grid">
            <!-- Indicador Ibovespa -->
            <section class="indicator-section">
                <h2>Ibovespa (^BVSP)</h2>
                <div class="value" id="ibov-value">Buscando...</div>
                <div class="change" id="ibov-change"></div>
            </section>
            <!-- Indicador Dólar -->
            <section class="indicator-section">
                <h2>Dólar (USD/BRL)</h2>
                <div class="value" id="usd-value">Buscando...</div>
                <div class="change" id="usd-change"></div>
            </section>
            <!-- Indicador IPCA (Inflação) -->
            <section class="indicator-section">
                <h2>IPCA (Acum. 12m)</h2>
                <div class="value" id="ipca-value">Buscando...</div>
                <div class="change" id="ipca-date"></div>
            </section>
        </main>

        <!-- Diagnóstico Consolidado -->
        <div id="diagnostico-consolidado">Aguardando dados para diagnóstico...</div>
    </div>

    <script>
        // APIs utilizadas:
        const API_IBOV = 'brapi.dev^BVSP';
        const API_USD = 'brapi.dev';
        // API BCB para IPCA acumulado em 12 meses (código 433)
        const API_IPCA = 'api.bcb.gov.br';

        async function fetchData() {
            try {
                // Fetch Ibovespa e Dólar (brapi)
                const [resIbov, resUsd] = await Promise.all([fetch(API_IBOV), fetch(API_USD)]);
                const dataIbov = await resIbov.json();
                const dataUsd = await resUsd.json();

                // Fetch IPCA (BCB)
                const resIpca = await fetch(API_IPCA);
                const dataIpca = await resIpca.json();

                const ibov = dataIbov.results;
                const usd = dataUsd.currencies.find(item => item.currency === 'USD');
                const ipca = dataIpca[0]; // Último dado disponível

                // Atualizar HTML dos indicadores
                updateIndicator('ibov', ibov.regularMarketPrice.toFixed(0), ibov.changePercent.toFixed(2), ibov.changePercent > 0);
                updateIndicator('usd', usd.buy.toFixed(4), usd.variation.toFixed(2), usd.variation < 0);
                updateIndicatorIPCA(ipca.valor, ipca.data);

                // Gerar Diagnóstico
                generateDiagnostic(ibov.changePercent, usd.variation, parseFloat(ipca.valor));

            } catch (error) {
                console.error('Erro ao buscar dados:', error);
                document.getElementById('diagnostico-consolidado').innerHTML = 'Erro ao carregar dados financeiros.';
            }
        }

        function updateIndicator(id, value, change, isPositive) {
            document.getElementById(id + '-value').textContent = (id === 'usd' ? 'R$ ' : '') + value;
            document.getElementById(id + '-change').textContent = change + '%';
            const changeElement = document.getElementById(id + '-change');
            changeElement.className = isPositive ? 'change positive' : 'change negative';
        }

        function updateIndicatorIPCA(value, date) {
            document.getElementById('ipca-value').textContent = value + '%';
            document.getElementById('ipca-date').textContent = 'Ref: ' + date;
            // Inflação alta (>5%) é geralmente vista como negativa
            document.getElementById('ipca-value').className = parseFloat(value) > 5.0 ? 'value negative' : 'value positive';
        }

        function generateDiagnostic(ibovChange, usdChange, ipcaValue) {
            const diagnosticElement = document.getElementById('diagnostico-consolidado');
            let message = '';
            let className = '';

            // Lógica de diagnóstico:
            const isIbovPositive = ibovChange > 0.5;
            const isUsdPositive = usdChange < -0.5; // Dólar caindo é positivo
            const isIpcaHigh = ipcaValue > 5.0; // IPCA acima de 5% a.a. é sinal de alerta

            if (isIbovPositive && isUsdPositive && !isIpcaHigh) {
                message = 'Momento **Altamente Positivo**: Ibovespa em alta, Dólar em queda e Inflação controlada. Disciplina fiscal e fatores externos positivos prevalecem.';
                className = 'positive';
            } else if (!isIbovPositive && !isUsdPositive && isIpcaHigh) {
                message = 'Momento **Negativo**: Ibovespa em queda, Dólar em alta e Inflação alta. Pressões internas (Selic/Inflação) e externas (Juros EUA, Choques Globais) dominantes.';
                className = 'negative';
            } else {
                message = 'Momento **Misto/Neutro**: Indicadores mostram movimentos conflitantes ou moderados. O mercado aguarda por definições políticas ou externas para tomar um rumo claro.';
                className = 'neutral';
            }
            
            diagnosticElement.innerHTML = message;
            diagnosticElement.className = className;
        }

        fetchData();
        setInterval(fetchData, 60000); // Atualiza a cada minuto

        /* Isenção de Responsabilidade Financeira: Este painel utiliza dados públicos e serve apenas para fins ilustrativos e educacionais. Ele não constitui aconselhamento financeiro ou recomendação de investimento. Consulte um profissional certificado antes de tomar decisões financeiras. */
    </script>
</body>
</html>
