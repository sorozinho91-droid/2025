<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dire√ß√£o Macro ‚Äì Mini √çndice B3</title>

<style>
body{
  font-family:Arial;
  margin:0;
  background:#f3f4f6;
  display:flex;
}

/* ================= NOT√çCIAS ESQUERDA ================= */
#newsPanel{
  width:360px;
  background:#0f172a;
  color:#fff;
  height:100vh;
  overflow-y:auto;
}
#newsPanel h3{
  margin:0;
  padding:14px;
  text-align:center;
  background:#020617;
}
.newsRow{
  padding:12px;
  border-bottom:1px solid #1e293b;
  font-size:13px;
}
.newsRow b{color:#facc15}
.newsRow a{color:#93c5fd;text-decoration:none}

/* ================= √ÅREA CENTRAL + DIREITA ================= */
#centerArea{
  flex:1;
  display:flex;
  gap:20px;
  padding:20px;
  align-items:flex-start;
}

/* ================= CONTE√öDO CENTRAL ================= */
#main{
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
}

header{
  width:100%;
  background:#020617;
  color:#fff;
  padding:12px;
  text-align:center;
  border-radius:8px;
}

/* ================= REL√ìGIO ================= */
#relogioCentral{
  margin:22px 0 14px;
  font-size:18px;
  font-weight:bold;
  background:#e5e7eb;
  padding:10px 24px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
}

/* ================= BOX DIRE√á√ÉO MACRO ================= */
.box{
  width:650px;
  background:linear-gradient(135deg,#ffffff,#f1f5f9);
  padding:24px;
  border-radius:12px;
  box-shadow:0 8px 18px rgba(0,0,0,.18);
  text-align:center;
}
.box .titulo{
  font-size:14px;
  letter-spacing:1px;
  text-transform:uppercase;
  opacity:.7;
}
.box .direcao{
  font-size:42px;
  font-weight:bold;
  margin:14px 0;
}
.box .acao{
  font-size:17px;
  font-weight:bold;
}
.verde{border-left:10px solid #16a34a;color:#065f46}
.vermelho{border-left:10px solid #dc2626;color:#7f1d1d}
.amarelo{border-left:10px solid #ca8a04;color:#713f12}
.piscar{animation:pisc 1s infinite}
@keyframes pisc{
  0%{transform:scale(1)}
  50%{transform:scale(1.02)}
  100%{transform:scale(1)}
}

/* ================= BREAKING NEWS DIREITA ================= */
#breakingPanel{
  width:360px;
  background:#111827;
  color:#fff;
  border-radius:8px;
  box-shadow:0 6px 14px rgba(0,0,0,.4);
}
#breakingHeader{
  background:#7f1d1d;
  padding:12px;
  text-align:center;
  font-weight:bold;
}
#breakingList{
  max-height:520px;
  overflow-y:auto;
  font-size:13px;
}
.breakRow{
  padding:12px;
  border-bottom:1px solid #374151;
}
.breakRow a{color:#93c5fd;text-decoration:none}
.blink{animation:blink 1s infinite}
@keyframes blink{0%{opacity:1}50%{opacity:.4}100%{opacity:1}}
</style>
</head>

<body>

<!-- NOT√çCIAS ESQUERDA -->
<div id="newsPanel">
  <h3>üì∞ Not√≠cias Macro</h3>
  <div id="newsTable">
    <div class="newsRow">Aguardando not√≠cias...</div>
  </div>
</div>

<!-- √ÅREA CENTRAL + DIREITA -->
<div id="centerArea">

  <!-- CENTRO -->
  <div id="main">
    <header>
      <h2>Dire√ß√£o Macro ‚Äì Mini √çndice (WIN)</h2>
    </header>

    <div id="relogioCentral">Carregando hor√°rio...</div>

    <div id="macroBox" class="box amarelo">
      Carregando dire√ß√£o macro...
    </div>
  </div>

  <!-- BREAKING NEWS DIREITA -->
  <div id="breakingPanel">
    <div id="breakingHeader">üö® BREAKING NEWS</div>
    <div id="breakingList">
      <div class="breakRow">Aguardando eventos cr√≠ticos...</div>
    </div>
  </div>

</div>

<audio id="soundBreak" src="https://assets.mixkit.co/sfx/preview/mixkit-alert-alarm-1005.mp3"></audio>
<audio id="soundTrend" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>

<script>
// ================= REL√ìGIO BRAS√çLIA =================
setInterval(()=>{
 const d=new Date(),u=d.getTime()+d.getTimezoneOffset()*60000;
 document.getElementById("relogioCentral").innerText=
 "‚è∞ Hor√°rio de Bras√≠lia: "+new Date(u-3*3600000).toLocaleTimeString("pt-BR");
},1000);

// ================= ATIVOS MACRO =================
const riskOn=["INDEX:SPX","INDEX:NDX","INDEX:DAX","NYMEX:CL1!"];
const riskOff=["CBOE:VIX","FOREXCOM:DX1!","COMEX:GC1!"];

async function preco(s){
 try{
  const r=await fetch("https://api.allorigins.win/raw?url=https://s3.tradingview.com/symbols/"+s.replace(":","_")+".json");
  const j=await r.json();
  return j.last_price||j.close||0;
 }catch{return 0}
}

let hist=[],estado="";

// ================= DIRE√á√ÉO MACRO =================
async function atualizarMacro(){
 let on=0,off=0;
 for(const a of riskOn) on+=await preco(a);
 for(const a of riskOff) off+=await preco(a);

 hist.push(on-off);
 if(hist.length>8) hist.shift();

 const m=hist.reduce((a,b)=>a+b,0)/hist.length;

 let cor="amarelo",status="NEUTRO",icone="‚è∏",acao="Reduzir risco / aguardar";

 if(m>0){
  cor="verde"; status="ALTA"; icone="‚Üë";
  acao="Operar COMPRAS no Mini √çndice (WIN)";
 }
 if(m<0){
  cor="vermelho"; status="BAIXA"; icone="‚Üì";
  acao="Operar VENDAS no Mini √çndice (WIN)";
 }

 if(estado && estado!==status){
  soundTrend.play().catch(()=>{});
  macroBox.classList.add("piscar");
  setTimeout(()=>macroBox.classList.remove("piscar"),12000);
 }
 estado=status;

 macroBox.className="box "+cor;
 macroBox.innerHTML=`
  <div class="titulo">Dire√ß√£o Macro do Mercado</div>
  <div class="direcao">${icone} ${status}</div>
  <div class="acao">${acao}</div>
 `;
}
setInterval(atualizarMacro,60000);
atualizarMacro();

// ================= BREAKING NEWS =================
const breakWords=["fed","juros","rate","war","guerra","crise","emergency"];
const breakCache={};

async function breaking(){
 const rss="https://news.google.com/rss/search?q="+encodeURIComponent(breakWords.join(" OR "))+"&hl=pt-BR&gl=BR&ceid=BR:pt";
 const url="https://api.allorigins.win/raw?url="+encodeURIComponent(rss);
 try{
  const r=await fetch(url),t=await r.text();
  const xml=new DOMParser().parseFromString(t,"text/xml");
  xml.querySelectorAll("item").forEach(i=>{
    const title=i.querySelector("title").textContent;
    const link=i.querySelector("link").textContent;
    if(breakCache[link])return;
    breakCache[link]=true;

    const d=document.createElement("div");
    d.className="breakRow";
    d.innerHTML=`<b>${title}</b><br><a href="${link}" target="_blank">Abrir</a>`;
    breakingList.prepend(d);

    breakingPanel.classList.add("blink");
    soundBreak.play().catch(()=>{});
    setTimeout(()=>breakingPanel.classList.remove("blink"),12000);
  });
 }catch{}
}
setInterval(breaking,30000);
breaking();

// ================= NOT√çCIAS CONTEXTO =================
const ctxWords=["juros","infla√ß√£o","fiscal","economia","d√≠vida"];
const ctxCache={};

async function contexto(){
 const rss="https://news.google.com/rss/search?q="+encodeURIComponent(ctxWords.join(" OR "))+"&hl=pt-BR&gl=BR&ceid=BR:pt";
 const url="https://api.allorigins.win/raw?url="+encodeURIComponent(rss);
 try{
  const r=await fetch(url),t=await r.text();
  const xml=new DOMParser().parseFromString(t,"text/xml");
  xml.querySelectorAll("item").forEach(i=>{
    const title=i.querySelector("title").textContent;
    const link=i.querySelector("link").textContent;
    if(ctxCache[link])return;
    ctxCache[link]=true;

    const d=document.createElement("div");
    d.className="newsRow";
    d.innerHTML=`<b>${title}</b><br><a href="${link}" target="_blank">Abrir</a>`;
    newsTable.prepend(d);
  });
 }catch{}
}
setInterval(contexto,60000);
contexto();
</script>

</body>
</html>
