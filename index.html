<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dire√ß√£o Macro ‚Äì Mini √çndice B3</title>

<style>
body{
  font-family:Arial;
  margin:0;
  background:#f3f4f6;
  display:flex;
}

/* ================= BREAKING NEWS ================= */
#breakingPanel{
  position:fixed;
  top:10px;
  right:10px;
  width:360px;
  background:#111827;
  color:#fff;
  border-radius:6px;
  box-shadow:0 4px 10px rgba(0,0,0,.4);
  z-index:9999;
}
#breakingHeader{
  background:#7f1d1d;
  padding:8px;
  text-align:center;
  font-weight:bold;
}
#breakingList{
  max-height:260px;
  overflow-y:auto;
  font-size:13px;
}
.breakRow{
  padding:8px;
  border-bottom:1px solid #374151;
}
.breakRow a{color:#93c5fd;text-decoration:none}
.blink{animation:blink 1s infinite}
@keyframes blink{0%{opacity:1}50%{opacity:.4}100%{opacity:1}}

/* ================= NOT√çCIAS LADO ESQUERDO ================= */
#newsPanel{
  width:360px;
  background:#0f172a;
  color:#fff;
  height:100vh;
  overflow-y:auto;
}
#newsPanel h3{
  margin:0;
  padding:12px;
  text-align:center;
  background:#020617;
}
.newsRow{
  padding:10px;
  border-bottom:1px solid #1e293b;
  font-size:13px;
}
.newsRow b{color:#facc15}
.newsRow a{color:#93c5fd;text-decoration:none}

/* ================= CONTE√öDO CENTRAL ================= */
#main{
  flex:1;
  padding:20px;
  display:flex;
  flex-direction:column;
  align-items:center;
}

header{
  width:100%;
  background:#020617;
  color:#fff;
  padding:10px;
  text-align:center;
  border-radius:6px;
}

/* REL√ìGIO */
#relogioCentral{
  margin:20px 0 10px;
  font-size:18px;
  font-weight:bold;
  background:#e5e7eb;
  padding:8px 20px;
  border-radius:6px;
}

/* BOX MACRO */
.box{
  width:650px;
  background:#fff;
  padding:18px;
  margin-top:10px;
  border-radius:6px;
  box-shadow:0 2px 6px rgba(0,0,0,.2);
  font-size:16px;
}
.verde{border-left:6px solid #16a34a}
.vermelho{border-left:6px solid #dc2626}
.amarelo{border-left:6px solid #ca8a04}
.piscar{animation:blink 1s infinite}
</style>
</head>

<body>

<!-- BREAKING NEWS -->
<div id="breakingPanel">
  <div id="breakingHeader">üö® BREAKING NEWS ‚Äì MERCADO</div>
  <div id="breakingList">
    <div class="breakRow">Aguardando eventos cr√≠ticos...</div>
  </div>
</div>

<!-- NOT√çCIAS MACRO -->
<div id="newsPanel">
  <h3>üì∞ Not√≠cias Macro (Contexto)</h3>
  <div id="newsTable">
    <div class="newsRow">Aguardando not√≠cias...</div>
  </div>
</div>

<!-- CONTE√öDO -->
<div id="main">
<header>
  <h2>Dire√ß√£o Macro ‚Äì Mini √çndice (WIN)</h2>
</header>

<div id="relogioCentral">Carregando hor√°rio...</div>

<div id="macroBox" class="box amarelo">
  Calculando tend√™ncia macro...
</div>
</div>

<audio id="soundBreak" src="https://assets.mixkit.co/sfx/preview/mixkit-alert-alarm-1005.mp3"></audio>
<audio id="soundTrend" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>

<script>
// REL√ìGIO BRAS√çLIA
setInterval(()=>{
 const d=new Date(),u=d.getTime()+d.getTimezoneOffset()*60000;
 document.getElementById("relogioCentral").innerText=
 "‚è∞ Hor√°rio de Bras√≠lia: "+new Date(u-3*3600000).toLocaleTimeString("pt-BR");
},1000);

// ATIVOS MACRO
const riskOn=["INDEX:SPX","INDEX:NDX","INDEX:DAX","NYMEX:CL1!"];
const riskOff=["CBOE:VIX","FOREXCOM:DX1!","COMEX:GC1!"];
async function preco(s){
 try{
  const r=await fetch("https://api.allorigins.win/raw?url=https://s3.tradingview.com/symbols/"+s.replace(":","_")+".json");
  const j=await r.json(); return j.last_price||j.close||0;
 }catch{return 0}
}

let hist=[],estado="";
async function atualizarMacro(){
 let on=0,off=0;
 for(const a of riskOn) on+=await preco(a);
 for(const a of riskOff) off+=await preco(a);
 hist.push(on-off); if(hist.length>8) hist.shift();
 const m=hist.reduce((a,b)=>a+b,0)/hist.length;
 let cor="amarelo",txt="‚ö†Ô∏è Mercado indefinido";
 if(m>0){cor="verde";txt="üìà TEND√äNCIA DE ALTA ‚Äì Priorizar COMPRAS"}
 if(m<0){cor="vermelho";txt="üìâ TEND√äNCIA DE BAIXA ‚Äì Priorizar VENDAS"}
 if(estado && estado!==txt){soundTrend.play().catch(()=>{});macroBox.classList.add("piscar");setTimeout(()=>macroBox.classList.remove("piscar"),12000);}
 estado=txt; macroBox.className="box "+cor; macroBox.innerHTML="<b>üß≠ DIRE√á√ÉO MACRO</b><br><br>"+txt;
}
setInterval(atualizarMacro,60000); atualizarMacro();

// BREAKING NEWS (CR√çTICAS)
const breakWords=["fed","juros","rate","war","guerra","default","emergency","crise"];
const breakCache={};
async function breaking(){
 const rss="https://news.google.com/rss/search?q="+encodeURIComponent(breakWords.join(" OR "))+"&hl=pt-BR&gl=BR&ceid=BR:pt";
 const url="https://api.allorigins.win/raw?url="+encodeURIComponent(rss);
 try{
  const r=await fetch(url); const t=await r.text();
  const xml=new DOMParser().parseFromString(t,"text/xml");
  xml.querySelectorAll("item").forEach(i=>{
    const title=i.querySelector("title").textContent;
    const link=i.querySelector("link").textContent;
    if(breakCache[link])return;
    breakCache[link]=true;
    const d=document.createElement("div");
    d.className="breakRow";
    d.innerHTML="<b>"+title+"</b><br><a href='"+link+"' target='_blank'>Abrir</a>";
    breakingList.prepend(d);
    breakingPanel.classList.add("blink");
    soundBreak.play().catch(()=>{});
    setTimeout(()=>breakingPanel.classList.remove("blink"),12000);
  });
 }catch{}
}
setInterval(breaking,30000); breaking();

// NOT√çCIAS CONTEXTO
const ctxWords=["juros","infla√ß√£o","fiscal","d√≠vida","economia"];
const ctxCache={};
async function contexto(){
 const rss="https://news.google.com/rss/search?q="+encodeURIComponent(ctxWords.join(" OR "))+"&hl=pt-BR&gl=BR&ceid=BR:pt";
 const url="https://api.allorigins.win/raw?url="+encodeURIComponent(rss);
 try{
  const r=await fetch(url); const t=await r.text();
  const xml=new DOMParser().parseFromString(t,"text/xml");
  xml.querySelectorAll("item").forEach(i=>{
    const title=i.querySelector("title").textContent;
    const link=i.querySelector("link").textContent;
    if(ctxCache[link])return;
    ctxCache[link]=true;
    const d=document.createElement("div");
    d.className="newsRow";
    d.innerHTML="<b>"+title+"</b><br><a href='"+link+"' target='_blank'>Abrir</a>";
    newsTable.prepend(d);
  });
 }catch{}
}
setInterval(contexto,60000); contexto();
</script>

</body>
</html>
