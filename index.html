<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>GPS Macro Profissional ‚Äì Mini √çndice</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#f3f4f6;
}
header{
  background:#111827;
  color:#fff;
  padding:10px;
  text-align:center;
  font-size:18px;
  font-weight:bold;
}
#relogio{
  text-align:center;
  font-size:18px;
  font-weight:bold;
  padding:6px;
  margin:10px auto;
  width:360px;
  color:#fff;
  background:#1f2937;
  border-radius:6px;
}
#grafico-container{
  width:95%;
  max-width:1200px;
  margin:20px auto;
  background:#fff;
  padding:15px;
  border-radius:8px;
  box-shadow:0 2px 8px rgba(0,0,0,.15);
}
</style>
</head>

<body>

<header>üìä GPS Macro Profissional ‚Äì Mini √çndice</header>
<div id="relogio">‚è∞ --:--:--</div>

<div id="grafico-container">
  <canvas id="grafico"></canvas>
</div>

<script>
// ===== REL√ìGIO =====
setInterval(()=>{
  document.getElementById("relogio").innerText =
    "‚è∞ Hor√°rio de Bras√≠lia: " + new Date().toLocaleTimeString("pt-BR");
},1000);

// ===== LISTA DE ATIVOS =====

// RISCO (risk-on)
const ativosRisco = [
  "^GSPC",   // S&P 500
  "^IXIC",   // Nasdaq
  "^DJI",    // Dow Jones
  "^BVSP",   // Ibovespa
  "BTC-USD", // Bitcoin
  "CL=F",    // Petr√≥leo
  "HG=F"     // Cobre
];

// SEGURAN√áA (risk-off)
const ativosSeguranca = [
  "^VIX",      // Volatilidade
  "DX-Y.NYB",  // DXY
  "BRL=X",    // USD/BRL
  "GC=F",     // Ouro
  "^TNX"      // Treasury 10Y
];

// ===== FUN√á√ÉO DE PRE√áO (Yahoo via proxy) =====
async function buscarPreco(symbol){
  const url = "https://api.allorigins.win/raw?url=" +
    encodeURIComponent(
      `https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbol}`
    );
  const res = await fetch(url);
  const json = await res.json();
  return json.quoteResponse.result[0].regularMarketPrice;
}

// ===== M√âDIA DO GRUPO =====
async function mediaGrupo(grupo){
  let soma = 0;
  let qtd = 0;

  for(const ativo of grupo){
    try{
      soma += await buscarPreco(ativo);
      qtd++;
    }catch(e){
      console.log("Erro ativo:", ativo);
    }
  }
  return qtd ? soma / qtd : 0;
}

// ===== GR√ÅFICO =====
const ctx = document.getElementById("grafico").getContext("2d");

const grafico = new Chart(ctx,{
  type:"line",
  data:{
    labels:[],
    datasets:[
      {
        label:"Ativos de Risco (m√©dia %)",
        data:[],
        borderColor:"#16a34a",
        backgroundColor:"rgba(22,163,74,0.1)",
        tension:0.4,
        fill:true
      },
      {
        label:"Ativos de Seguran√ßa (m√©dia %)",
        data:[],
        borderColor:"#dc2626",
        backgroundColor:"rgba(220,38,38,0.1)",
        tension:0.4,
        fill:true
      }
    ]
  },
  options:{
    responsive:true,
    interaction:{mode:"index",intersect:false},
    scales:{
      y:{title:{display:true,text:"Varia√ß√£o (%)"}},
      x:{title:{display:true,text:"Hor√°rio"}}
    }
  }
});

// ===== BASE PARA % =====
let baseRisco = null;
let baseSeg = null;

// ===== ATUALIZA A CADA 1 MINUTO =====
async function atualizarGrafico(){
  try{
    const mediaRisco = await mediaGrupo(ativosRisco);
    const mediaSeg = await mediaGrupo(ativosSeguranca);

    if(baseRisco === null){
      baseRisco = mediaRisco;
      baseSeg = mediaSeg;
    }

    const percRisco = ((mediaRisco - baseRisco) / baseRisco) * 100;
    const percSeg = ((mediaSeg - baseSeg) / baseSeg) * 100;

    grafico.data.labels.push(new Date().toLocaleTimeString("pt-BR"));
    grafico.data.datasets[0].data.push(Number(percRisco.toFixed(2)));
    grafico.data.datasets[1].data.push(Number(percSeg.toFixed(2)));

    grafico.update();
  }catch(err){
    console.log("Erro atualiza√ß√£o:", err);
  }
}

// ===== INICIALIZA =====
atualizarGrafico();
setInterval(atualizarGrafico, 60000); // 1 minuto
</script>

</body>
</html>
