<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard – Histórico de 2 Dias em Tempo Real</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
body { font-family: Arial, sans-serif; margin: 0; background: #f4f6f8; }
header { background: #1f2937; color: white; padding: 15px; text-align: center; }
#controls { text-align: center; padding: 10px; }
button { margin: 5px; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; background: #e5e7eb; }
button.active { background: #2563eb; color: white; }
#grafico { width: 100%; height: 600px; }
</style>
</head>
<body>

<header>
<h2>Ativos de Risco x Seguros – Histórico de 2 Dias em Tempo Real</h2>
</header>

<div id="controls">
<button onclick="setTimeframe(0.5, this)">30s</button>
<button onclick="setTimeframe(1, this)" class="active">1m</button>
<button onclick="setTimeframe(5, this)">5m</button>
<button onclick="setTimeframe(15, this)">15m</button>
<button onclick="setTimeframe(60, this)">1h</button>
</div>

<div id="grafico"></div>

<script>
let timeframe = 1; // minutos
let timer = null;

let datas = [], risco = [], seguro = [];
let valorRisco = 100, valorSeguro = 100;

// Função para gerar valores aleatórios
function atualizarValores(valor, vol){
    return Math.max(0, valor + (Math.random()-0.5)*vol);
}

// Gera histórico inicial de 2 dias (1 ponto a cada 1 minuto)
function gerarHistorico2Dias(){
    const agora = new Date();
    const start = new Date(agora.getTime() - 2*24*60*60*1000); // 2 dias atrás
    let valR = 100, valS = 100;
    datas = []; risco = []; seguro = [];
    for(let d = new Date(start); d <= agora; d.setMinutes(d.getMinutes()+1)){
        valR = atualizarValores(valR,2);
        valS = atualizarValores(valS,0.5);
        datas.push(new Date(d));
        risco.push(valR);
        seguro.push(valS);
    }
    valorRisco = valR;
    valorSeguro = valS;
}

// Atualização em tempo real
function atualizarGrafico(){
    const agora = new Date();
    valorRisco = atualizarValores(valorRisco,2);
    valorSeguro = atualizarValores(valorSeguro,0.5);
    datas.push(agora);
    risco.push(valorRisco);
    seguro.push(valorSeguro);
    Plotly.extendTraces('grafico', {x:[[agora],[agora]], y:[[valorRisco],[valorSeguro]]}, [0,1]);
}

// Mudar timeframe
function setTimeframe(minutos, botao){
    timeframe = minutos;
    document.querySelectorAll('#controls button').forEach(b=>b.classList.remove('active'));
    botao.classList.add('active');
    if(timer) clearInterval(timer);
    timer = setInterval(atualizarGrafico, timeframe*60000);
}

/* Inicialização */
gerarHistorico2Dias();

const layout = {
    title:'Ativos em Tempo Real',
    xaxis:{title:'Data', type:'date'},
    yaxis:{title:'Valor'},
    margin:{t:50},
    legend: {
        title: { text: '<b>Ativos</b>' },
        x: 1,
        xanchor: 'right',
        y: 1,
        font: {size:14},
        bgcolor: '#f4f6f8',
        bordercolor: '#888',
        borderwidth: 1
    }
};

const traceRisco = {
    x: datas,
    y: risco,
    mode: 'lines+markers',
    name: 'Ativos de Risco',
    line:{color:'red', width:2},
    marker:{size:4, symbol:'circle'},
    hovertemplate: 'Data: %{x|%d/%m/%Y %H:%M}<br>Valor: %{y:.2f}<extra></extra>'
};

const traceSeguro = {
    x: datas,
    y: seguro,
    mode: 'lines+markers',
    name: 'Ativos Seguros',
    line:{color:'green', width:2},
    marker:{size:4, symbol:'square'},
    hovertemplate: 'Data: %{x|%d/%m/%Y %H:%M}<br>Valor: %{y:.2f}<extra></extra>'
};

Plotly.newPlot('grafico',[traceRisco, traceSeguro], layout, {responsive:true});

// Atualização em tempo real
timer = setInterval(atualizarGrafico, timeframe*60000);

window.addEventListener('resize',()=>{Plotly.Plots.resize('grafico');});
</script>

</body>
</html>
