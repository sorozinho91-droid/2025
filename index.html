<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sentimento de Mercado â€“ Risco x SeguranÃ§a</title>

<!-- Lightweight Charts -->
<script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>

<style>
    html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background: #0e0e0e;
        color: #e0e0e0;
        font-family: Arial, sans-serif;
    }
    #wrapper {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
    }
    h2 {
        margin: 0;
        padding: 10px;
    }
    #chart {
        flex: 1;
    }
</style>
</head>

<body>

<div id="wrapper">
    <h2>ğŸ“Š Sentimento de Mercado â€“ DireÃ§Ã£o do Dia</h2>
    <div id="chart"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

    const container = document.getElementById("chart");

    /* â”€â”€â”€â”€â”€ CRIA GRÃFICO â”€â”€â”€â”€â”€ */
    const chart = LightweightCharts.createChart(container, {
        layout: {
            background: { color: "#0e0e0e" },
            textColor: "#cccccc"
        },
        grid: {
            vertLines: { color: "#222" },
            horzLines: { color: "#222" }
        },
        timeScale: {
            timeVisible: true,
            secondsVisible: false
        },
        rightPriceScale: {
            borderColor: "#555"
        }
    });

    /* â”€â”€â”€â”€â”€ SÃ‰RIES â”€â”€â”€â”€â”€ */
    const riskSeries = chart.addLineSeries({
        color: "#00ff88",
        lineWidth: 3
    });

    const safetySeries = chart.addLineSeries({
        color: "#ff4444",
        lineWidth: 3
    });

    /* â”€â”€â”€â”€â”€ ESTADO â”€â”€â”€â”€â”€ */
    const MINUTES = 390;
    let risk = 100;
    let safety = 100;

    const riskData = [];
    const safetyData = [];

    function step(v, vol) {
        return v * (1 + (Math.random() - 0.5) * vol);
    }

    /* â”€â”€â”€â”€â”€ HISTÃ“RICO DO DIA â”€â”€â”€â”€â”€ */
    let t = Math.floor(Date.now() / 1000) - MINUTES * 60;

    for (let i = 0; i < MINUTES; i++) {
        risk = step(risk, 0.0025);
        safety = step(safety, 0.0015);

        riskData.push({ time: t, value: risk });
        safetyData.push({ time: t, value: safety });

        t += 60;
    }

    riskSeries.setData(riskData);
    safetySeries.setData(safetyData);

    /* â”€â”€â”€â”€â”€ ATUALIZA 1x POR MINUTO â”€â”€â”€â”€â”€ */
    setInterval(() => {
        const now = Math.floor(Date.now() / 1000);

        risk = step(risk, 0.003);
        safety = step(safety, 0.0015);

        riskData.push({ time: now, value: risk });
        safetyData.push({ time: now, value: safety });

        if (riskData.length > MINUTES) {
            riskData.shift();
            safetyData.shift();
        }

        riskSeries.setData(riskData);
        safetySeries.setData(safetyData);
    }, 60000);

    /* â”€â”€â”€â”€â”€ RESIZE â”€â”€â”€â”€â”€ */
    window.addEventListener("resize", () => {
        chart.resize(container.clientWidth, container.clientHeight);
    });

});
</script>

</body>
</html>
