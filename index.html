<script>
let valorRisco = 100;
let valorSeguro = 100;
let intervalo = 2000;
let timer;

function atualizar(valor) {
    return Math.max(0, valor + (Math.random() - 0.5) * 2);
}

const traceRisco = {
    x: [],
    y: [],
    type: 'scatter',
    mode: 'lines',
    name: 'ðŸ”´ Risco â€” Ativos de Risco',
    line: { color: 'red', width: 2 }
};

const traceSeguro = {
    x: [],
    y: [],
    type: 'scatter',
    mode: 'lines',
    name: 'ðŸŸ¢ SeguranÃ§a â€” Ativos Seguros',
    line: { color: 'green', width: 2 }
};

const layout = {
    xaxis: { title: 'Tempo', automargin: true },
    yaxis: { title: 'Valor', automargin: true },
    margin: { t: 10, l: 50, r: 20, b: 40 },
    legend: {
        orientation: 'h',
        x: 0.5,
        xanchor: 'center',
        y: -0.2
    },
    transition: {
        duration: 800,
        easing: 'linear'
    }
};

Plotly.newPlot('grafico', [traceRisco, traceSeguro], layout, {
    responsive: true,
    displayModeBar: false
});

function iniciarGrafico() {
    clearInterval(timer);

    timer = setInterval(() => {
        const agora = new Date().toLocaleTimeString();

        valorRisco = atualizar(valorRisco);
        valorSeguro = atualizar(valorSeguro);

        Plotly.extendTraces(
            'grafico',
            {
                x: [[agora], [agora]],
                y: [[valorRisco], [valorSeguro]]
            },
            [0, 1],
            30
        );
    }, intervalo);
}

// Slider de velocidade
const slider = document.getElementById('velocidade');
const texto = document.getElementById('velocidadeValor');

slider.addEventListener('input', () => {
    intervalo = Number(slider.value);
    texto.textContent = (intervalo / 1000).toFixed(1) + 's';
    iniciarGrafico();
});

// Inicia pela primeira vez
iniciarGrafico();

window.addEventListener('resize', () => {
    Plotly.Plots.resize('grafico');
});
</script>
