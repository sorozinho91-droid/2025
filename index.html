<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard Macro ‚Äì Risco x Seguran√ßa</title>

<!-- Plotly -->
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
body { margin:0; font-family:Arial,sans-serif; background:#f4f6f8; }

/* ===== TOPO ===== */
#painel-cotacoes{
  position:fixed; top:0; left:0;
  width:100%; height:28px;
  background:#fff; border-bottom:1px solid #ccc;
  z-index:9999;
}

/* ===== HEADER ===== */
header{
  margin-top:28px;
  background:#1f2937;
  color:#fff;
  padding:12px;
  text-align:center;
}

/* ===== CONTROLES ===== */
#controls,#compareDates{
  text-align:center;
  padding:10px;
}

button{
  padding:6px 14px;
  margin:4px;
  border:none;
  border-radius:4px;
  cursor:pointer;
}
button.active{ background:#2563eb; color:#fff; }

/* ===== GRAFICO ===== */
#grafico{
  width:92%;
  max-width:1200px;
  height:420px;
  margin:20px auto;
  background:#fff;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
}

/* ===== TABELAS ===== */
table{
  width:92%;
  max-width:1200px;
  margin:20px auto;
  border-collapse:collapse;
  background:#fff;
}
th,td{
  border:1px solid #ccc;
  padding:7px;
  font-size:13px;
  text-align:center;
}
thead th{
  background:#2563eb;
  color:#fff;
}

.risco{ color:green; }
.seguro{ color:red; }
.positivo{ color:green; }
.negativo{ color:red; }

/* ===== BREAKING NEWS ===== */
#painel-news{
  position:fixed;
  top:36px;
  right:10px;
  width:360px;
  background:#111827;
  color:#fff;
  border-radius:6px;
  z-index:9998;
}
.news-header{
  background:#1f2937;
  padding:8px;
  text-align:center;
  font-weight:bold;
}
#newsList{
  max-height:260px;
  overflow-y:auto;
  font-size:13px;
}
.news-item{
  padding:8px;
  border-bottom:1px solid #374151;
}
.news-item a{ color:#93c5fd; }

/* ===== ALERTA MERCADO ===== */
#alerta-mercado{
  position:fixed;
  top:36px;
  left:8px;
  width:280px;
  background:#fff;
  border-left:5px solid #c00000;
  box-shadow:0 2px 8px rgba(0,0,0,.3);
  font-size:12px;
  z-index:9998;
}
.alerta-header{
  background:#c00000;
  color:#fff;
  padding:6px;
  text-align:center;
  font-weight:bold;
}
#alerta-conteudo{ padding:8px; }
.piscar{ animation:pisca 1s infinite; }
@keyframes pisca{
  0%{background:#fff;}
  50%{background:#ffe5e5;}
  100%{background:#fff;}
}
</style>
</head>

<body>

<!-- ===== TOPO COTA√á√ïES ===== -->
<div id="painel-cotacoes">
<script src="https://s3.tradingview.com/external-embedding/embed-widget-tickers.js">
{
  "symbols":[
    {"title":"Brent","proName":"ICE:BRN1!"},
    {"title":"WTI","proName":"NYMEX:CL1!"},
    {"title":"DXY","proName":"FOREXCOM:DX1!"},
    {"title":"S&P 500","proName":"INDEX:SPX"},
    {"title":"Dow Jones","proName":"INDEX:DJI"}
  ],
  "colorTheme":"light",
  "isTransparent":true,
  "locale":"pt",
  "width":"100%",
  "height":"28"
}
</script>
</div>

<header>
<h2>Risco x Seguran√ßa ‚Äì Tempo Real (Hist√≥rico Di√°rio)</h2>
</header>

<div id="controls">
<button onclick="setTimeframe(60,this)" class="active">1 min</button>
<button onclick="setTimeframe(300,this)">5 min</button>
</div>

<div id="grafico"></div>

<table id="tabelaRisco">
<thead><tr><th>Ativo de Risco</th><th>Valor</th><th>Var %</th></tr></thead>
<tbody></tbody>
</table>

<table id="tabelaSeguro">
<thead><tr><th>Ativo de Seguran√ßa</th><th>Valor</th><th>Var %</th></tr></thead>
<tbody></tbody>
</table>

<!-- ===== BREAKING NEWS ===== -->
<div id="painel-news">
  <div class="news-header">üö® BREAKING NEWS ‚Äì Macro</div>
  <div id="newsList"><div class="news-item">Aguardando not√≠cias...</div></div>
</div>

<!-- ===== ALERTA ===== -->
<div id="alerta-mercado">
  <div class="alerta-header">‚ö†Ô∏è ALERTA MERCADO</div>
  <div id="alerta-conteudo">Aguardando not√≠cias...</div>
</div>

<audio id="alertSound" src="https://assets.mixkit.co/sfx/preview/mixkit-alert-alarm-1005.mp3"></audio>
<audio id="alerta-som" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
// =================== GRAFICO ===================
let datas=[], risco=[], seguro=[];
let valorR=100, valorS=100;
let timer=null, timeframe=60000;

// hist√≥rico do DIA
function initDia(){
  const inicio=new Date();
  inicio.setHours(0,0,0,0);
  datas.push(inicio);
  risco.push(valorR);
  seguro.push(valorS);
}

function plot(){
  Plotly.react("grafico",[
    {x:datas,y:risco,name:"Risco",mode:"lines",line:{color:"green"}},
    {x:datas,y:seguro,name:"Seguran√ßa",mode:"lines",line:{color:"red"}}
  ],{
    margin:{t:40,l:50,r:40,b:50},
    xaxis:{type:"date"},
    yaxis:{title:"√çndice"}
  });
}

function atualizar(){
  const agora=new Date();
  valorR+= (Math.random()-0.5)*2;
  valorS+= (Math.random()-0.5)*1;

  datas.push(agora);
  risco.push(valorR);
  seguro.push(valorS);

  plot();
}

function setTimeframe(ms,btn){
  document.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  clearInterval(timer);
  timer=setInterval(atualizar,ms);
}

initDia();
plot();
timer=setInterval(atualizar,timeframe);

// =================== TABELAS ===================
const riscoAtivos=[
  {n:"Ouro",v:2766},{n:"WTI",v:73},{n:"Dow Jones",v:44900}
];
const segAtivos=[
  {n:"DXY",v:107},{n:"VIX",v:17.6}
];

function atualizarTabelas(){
  const tr=document.querySelector("#tabelaRisco tbody");
  const ts=document.querySelector("#tabelaSeguro tbody");
  tr.innerHTML=""; ts.innerHTML="";
  riscoAtivos.forEach(a=>{
    let nv=a.v+(Math.random()-0.5);
    let varp=((nv-a.v)/a.v*100).toFixed(2);
    a.v=nv;
    tr.innerHTML+=`<tr><td class="risco">${a.n}</td><td>${a.v.toFixed(2)}</td><td class="${varp>=0?'positivo':'negativo'}">${varp}%</td></tr>`;
  });
  segAtivos.forEach(a=>{
    let nv=a.v+(Math.random()-0.5);
    let varp=((nv-a.v)/a.v*100).toFixed(2);
    a.v=nv;
    ts.innerHTML+=`<tr><td class="seguro">${a.n}</td><td>${a.v.toFixed(2)}</td><td class="${varp>=0?'positivo':'negativo'}">${varp}%</td></tr>`;
  });
}
setInterval(atualizarTabelas,60000);
atualizarTabelas();

// =================== NEWS ===================
const palavras=["fed","juros","infla√ß√£o","war","cpi"];
async function news(){
  const q=palavras.join(" OR ");
  const rss="https://news.google.com/rss/search?q="+encodeURIComponent(q)+"&hl=pt-BR&gl=BR&ceid=BR:pt";
  const url="https://api.allorigins.win/raw?url="+encodeURIComponent(rss);
  const r=await fetch(url); const t=await r.text();
  const xml=new DOMParser().parseFromString(t,"text/xml");
  const item=xml.querySelector("item");
  if(!item)return;
  document.getElementById("newsList").innerHTML=
    `<div class="news-item"><strong>${item.querySelector("title").textContent}</strong></div>`;
}
news(); setInterval(news,30000);

// =================== ALERTA ===================
async function alerta(){
  const rss="https://news.google.com/rss/search?q=presidente+EUA+Brasil+mercado";
  const url="https://api.allorigins.win/raw?url="+encodeURIComponent(rss);
  const r=await fetch(url); const t=await r.text();
  const xml=new DOMParser().parseFromString(t,"text/xml");
  const item=xml.querySelector("item");
  if(!item)return;
  document.getElementById("alerta-conteudo").innerHTML=item.querySelector("title").textContent;
}
alerta(); setInterval(alerta,60000);
</script>

</body>
</html>
