<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard Macro + Sentimento IBOV</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#f2f4f7;
  --mod:#ffffff;
  --card:#f7f7f7;
  --line:#dcdcdc;
  --text:#000;
  --muted:#333;
  --blue:#0d47a1;
  --red:#c62828;
  --green:#2e7d32;
}

html,body{
  margin:0;
  height:100%;
  font-family:Arial,Helvetica,sans-serif;
  background:var(--bg);
}

.dashboard{
  display:grid;
  grid-template-rows:auto 1fr;
  height:100%;
  gap:12px;
  padding:12px;
}

/* ===== BREAKING ===== */
.section.breaking{
  background:#fff5f5;
  border:2px solid var(--red);
  border-radius:10px;
  padding:10px;
  max-height:22vh;
  overflow-y:auto;
}

.section{
  background:var(--mod);
  border-radius:10px;
  border:1px solid var(--line);
  padding:10px;
  overflow:hidden;
}

.section h2{
  margin:0 0 6px;
  font-size:14px;
  border-bottom:1px solid var(--line);
  padding-bottom:4px;
}

.list{
  overflow-y:auto;
  font-size:12px;
}

.news-item{
  background:var(--card);
  border-radius:6px;
  padding:6px;
  margin-bottom:6px;
}

.news-item a{
  color:var(--blue);
  text-decoration:none;
  font-weight:bold;
}

.main{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
  height:100%;
}

/* ===== SENTIMENTO ===== */
#ibovScore{
  font-size:26px;
  font-weight:bold;
}

#ibovStatus{
  font-size:12px;
  margin-bottom:6px;
  color:#555;
}
</style>
</head>

<body>

<div class="dashboard">

<!-- BREAKING NEWS -->
<div class="section breaking" id="breaking">
  <h2>ğŸš¨ Breaking News â€” Impacto Imediato</h2>
  <div class="list"></div>
</div>

<div class="main">

  <!-- NOTÃCIAS -->
  <div class="section" id="mercado"><h2>ğŸ“° Mercado Financeiro</h2><div class="list"></div></div>
  <div class="section" id="minerio"><h2>ğŸª¨ MinÃ©rio de Ferro</h2><div class="list"></div></div>
  <div class="section" id="petroleo"><h2>ğŸ›¢ï¸ PetrÃ³leo</h2><div class="list"></div></div>
  <div class="section" id="dxy"><h2>ğŸ’µ DÃ³lar & DXY</h2><div class="list"></div></div>
  <div class="section" id="juros"><h2>ğŸ“ˆ Juros EUA</h2><div class="list"></div></div>
  <div class="section" id="bancos"><h2>ğŸ¦ Bancos</h2><div class="list"></div></div>
  <div class="section" id="bolsasUSA"><h2>ğŸ‡ºğŸ‡¸ Bolsas EUA</h2><div class="list"></div></div>
  <div class="section" id="bolsasGlobal"><h2>ğŸŒ Bolsas Europa & Ãsia</h2><div class="list"></div></div>

  <!-- SENTIMENTO IBOV -->
  <div class="section" id="sentimentoIbov">
    <h2>ğŸ‡§ğŸ‡· Sentimento IBOV â€” Tempo Real</h2>
    <div id="ibovScore">0</div>
    <div id="ibovStatus">NEUTRO</div>
    <canvas id="ibovChart"></canvas>
  </div>

</div>
</div>

<script>
/* =========================
   RSS NOTÃCIAS
   ========================= */

const feedsMercado=[
 "https://valor.globo.com/rss/mercados/",
 "https://www.infomoney.com.br/feed/"
];

const feedsBreaking=[
 "https://g1.globo.com/rss/g1/ultimas-noticias.rss"
];

const temas={
 mercado:null,
 minerio:["minÃ©rio","iron","vale","aÃ§o"],
 petroleo:["petrÃ³leo","oil","brent","wti"],
 dxy:["dxy","dÃ³lar","usd","fed"],
 juros:["juros","yield","fomc"],
 bancos:["banco","bank","itaÃº","bradesco","jpmorgan"],
 bolsasUSA:["dow","nasdaq","s&p","wall street"],
 bolsasGlobal:["china","asia","europa","hang seng","nikkei","dax"]
};

async function buscarRSS(url){
 try{
  const r=await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`);
  const t=await r.text();
  const xml=new DOMParser().parseFromString(t,"text/xml");
  return [...xml.querySelectorAll("item")].map(i=>({
    title:i.querySelector("title")?.textContent||"",
    link:i.querySelector("link")?.textContent||"",
    desc:i.querySelector("description")?.textContent||""
  }));
 }catch{return []}
}

function filtrar(n,p){
 if(!p) return true;
 const t=(n.title+n.desc).toLowerCase();
 return p.some(x=>t.includes(x));
}

async function atualizarSecao(id,feeds,filtro){
 const box=document.querySelector(`#${id} .list`);
 box.innerHTML="";
 const dados=(await Promise.all(feeds.map(f=>buscarRSS(f)))).flat();
 dados.filter(n=>filtrar(n,filtro)).slice(0,6).forEach(n=>{
  box.innerHTML+=`<div class="news-item">
    <a href="${n.link}" target="_blank">${n.title}</a>
  </div>`;
 });
}

async function atualizarNoticias(){
 await atualizarSecao("breaking",feedsBreaking);
 for(const t in temas){
  await atualizarSecao(t,feedsMercado,temas[t]);
 }
}

atualizarNoticias();
setInterval(atualizarNoticias,60000);

/* =========================
   SENTIMENTO IBOV
   ========================= */

const PESOS={
 china:0.25, commodities:0.25, petroleo:0.15,
 dolar:0.15, vix:0.10, bolsas:0.10
};

const ATIVOS={
 china:"FXI",
 commodities:"BHP",
 petroleo:"CL=F",
 dolar:"DX-Y.NYB",
 vix:"^VIX",
 bolsas:"^GSPC"
};

let dados={}, hist=[], labels=[], chart;

async function cotacao(s){
 const r=await fetch(`https://query1.finance.yahoo.com/v7/finance/quote?symbols=${s}`);
 const j=await r.json();
 return j.quoteResponse.result[0]?.regularMarketChangePercent||0;
}

async function atualizarDados(){
 for(const k in ATIVOS) dados[k]=await cotacao(ATIVOS[k]);
}

function scoreIBOV(){
 return Math.round((
  dados.china*PESOS.china +
  dados.commodities*PESOS.commodities +
  dados.petroleo*PESOS.petroleo +
  (-dados.dolar)*PESOS.dolar +
  (-dados.vix)*PESOS.vix +
  dados.bolsas*PESOS.bolsas
 )*10);
}

function status(score){
 if(score>40) return "RISK-ON FORTE";
 if(score>15) return "RISK-ON";
 if(score<-40) return "RISK-OFF FORTE";
 if(score<-15) return "RISK-OFF";
 return "NEUTRO";
}

function iniciarGrafico(){
 chart=new Chart(document.getElementById("ibovChart"),{
  type:"line",
  data:{labels,datasets:[{data:hist,borderWidth:2,tension:.3}]},
  options:{animation:false,scales:{y:{min:-100,max:100}},plugins:{legend:{display:false}}}
 });
}

async function loopIbov(){
 await atualizarDados();
 const s=scoreIBOV();
 const h=new Date().toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});
 hist.push(s); labels.push(h);
 if(hist.length>90){hist.shift();labels.shift();}
 document.getElementById("ibovScore").textContent=s;
 document.getElementById("ibovScore").style.color=s>0?"#2e7d32":s<0?"#c62828":"#555";
 document.getElementById("ibovStatus").textContent=status(s);
 chart.update();
}

iniciarGrafico();
loopIbov();
setInterval(loopIbov,30000);
</script>

</body>
</html>
