<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Risk On x Risk Off — Multiativos</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        #grafico {
            width: 100%;
            height: 85vh;
        }
    </style>
</head>
<body>

<h2>Ativos de Risco x Segurança (Dados Reais)</h2>
<div id="grafico"></div>

<script>
    const ativosRisco = {
        "^GSPC": "S&P 500",
        "^IXIC": "Nasdaq",
        "^BVSP": "Ibovespa",
        "BTC-USD": "Bitcoin",
        "EEM": "Emergentes"
    };

    const ativosSeguro = {
        "TLT": "Treasury 20Y",
        "DX-Y.NYB": "Dólar",
        "GC=F": "Ouro",
        "JPY=X": "Iene",
        "CHF=X": "Franco Suíço"
    };

    async function buscarDados(simbolo) {
        const url = `https://query1.finance.yahoo.com/v8/finance/chart/${encodeURIComponent(simbolo)}?range=1d&interval=5m`;
        const r = await fetch(url);
        const j = await r.json();

        const res = j.chart.result[0];
        const x = res.timestamp.map(t => new Date(t * 1000).toLocaleTimeString());
        const y = res.indicators.quote[0].close;

        return { x, y };
    }

    async function montarTraces(ativos, corBase) {
        const traces = [];

        for (const simbolo in ativos) {
            const dados = await buscarDados(simbolo);

            traces.push({
                x: dados.x,
                y: dados.y,
                type: 'scatter',
                mode: 'lines',
                name: ativos[simbolo],
                line: { width: 2 },
                opacity: 0.7
            });
        }
        return traces;
    }

    async function carregarGrafico() {
        const tracesRisco = await montarTraces(ativosRisco);
        const tracesSeguro = await montarTraces(ativosSeguro);

        const layout = {
            title: 'Risk On (Risco) x Risk Off (Segurança)',
            xaxis: { title: 'Tempo', automargin: true },
            yaxis: { title: 'Preço', automargin: true },
            margin: { t: 50, l: 50, r: 30, b: 50 },
            legend: { orientation: 'h' }
        };

        Plotly.newPlot(
            'grafico',
            [...tracesRisco, ...tracesSeguro],
            layout,
            { responsive: true }
        );
    }

    carregarGrafico();
    setInterval(carregarGrafico, 300000); // atualiza a cada 5 minutos
</script>

</body>
</html>
