<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Risco x Segurança</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; }
    canvas { max-width: 900px; }
  </style>
</head>
<body>

<h2>Ativos de Risco x Segurança</h2>
<canvas id="grafico"></canvas>

<script>
/* =========================
   DADOS REAIS (Var%)
   ========================= */

// ATIVOS DE RISCO (Var%)
const riscoVars = [
  0.0101, 0.0042, -0.0001, 0.0036, 0,
  0.0024, -0.001, -0.0131, -0.0022, 0.0039,
  -0.0007, -0.0106, -0.0125, 0.0002, 0.0002,
  -0.0017, 0.0071, -0.0062, -0.0024, 0,
  -0.0133, -0.0006
];

// ATIVOS DE SEGURANÇA (Var%)
const segurancaVars = [
  0.0056, -0.0405, -0.0052, 0.0049, 0.0052,
  0.0071, 0.0098, 0, -0.0103
];

/* =========================
   FUNÇÕES
   ========================= */

function media(arr) {
  return arr.reduce((s, v) => s + v, 0) / arr.length;
}

/* =========================
   GRÁFICO
   ========================= */

const ctx = document.getElementById("grafico");
let labels = [];
let riscoSerie = [];
let segurancaSerie = [];
let chart;

function atualizar() {
  const hora = new Date().toLocaleTimeString();

  const riscoMedia = media(riscoVars);
  const segurancaMedia = media(segurancaVars);

  labels.push(hora);
  riscoSerie.push(riscoMedia);
  segurancaSerie.push(segurancaMedia);

  // limita histórico
  if (labels.length > 30) {
    labels.shift();
    riscoSerie.shift();
    segurancaSerie.shift();
  }

  if (!chart) {
    chart = new Chart(ctx, {
      type: "line",
      data: {
        labels,
        datasets: [
          {
            label: "Risco",
            data: riscoSerie,
            borderWidth: 2
          },
          {
            label: "Segurança",
            data: segurancaSerie,
            borderWidth: 2
          }
        ]
      },
      options: {
        responsive: true,
        interaction: { mode: "index", intersect: false },
        scales: {
          y: {
            ticks: {
              callback: v => (v * 100).toFixed(2) + "%"
            }
          }
        }
      }
    });
  } else {
    chart.update();
  }
}

// executa agora e a cada 60s
atualizar();
setInterval(atualizar, 60000);
</script>

</body>
</html>
