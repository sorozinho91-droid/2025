function monitorarMercadoIntraday() {
  var agora = new Date();
  // Horário de funcionamento da B3 (Exemplo: 10:00 às 18:00 no fuso de SP)
  var horaInicio = 10;
  var horaFim = 18;
  
  // Verifica se a hora atual está dentro do intraday
  if (agora.getHours() >= horaInicio && agora.getHours() < horaFim) {
    // Código para armazenar os dados (o mesmo do exemplo anterior)
    var ss = SpreadsheetApp.getActiveSpreadsheet();
    var painel = ss.getSheetByName("Painel");
    var hist = ss.getSheetByName("Historico");
    
    // Adicione os tickers desejados na sua aba "Painel"
    var tickers = ["NASDAQ:AAPL", "GOLD", "CURRENCY:USDBRL", "INDEXSP:.INX"];
    var linha = [agora];
    
    tickers.forEach(function(t) {
      // Supondo que o ticker esteja na coluna A e o preço na coluna B da aba Painel
      var preco = painel.getRange("B" + (tickers.indexOf(t) + 1)).getValue(); 
      linha.push(preco);
    });
    
    hist.appendRow(linha);
    
    // Limpeza automática: Mantém apenas dados do dia atual
    var dados = hist.getDataRange().getValues();
    var hoje = agora.toLocaleDateString();
    
    for (var i = dados.length - 1; i >= 1; i--) {
      // Verifica se a data do registro é diferente de hoje
      if (new Date(dados[i][0]).toLocaleDateString() !== hoje) {
        hist.deleteRow(i + 1);
      }
    }

  } else {
    // Opcional: Registrar que o mercado está fechado, se necessário
    Logger.log("Mercado fechado. Pulando o armazenamento.");
  }
}
