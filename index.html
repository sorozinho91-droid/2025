<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Risk On x Risk Off — Tempo Real</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    text-align: center;
}
#grafico {
    width: 100%;
    height: 85vh;
}
</style>
</head>
<body>

<h2>Risk On x Risk Off — Tempo Real</h2>
<div id="grafico"></div>

<script>
const ativos = [
    { simbolo: "^GSPC", nome: "S&P 500" },
    { simbolo: "^IXIC", nome: "Nasdaq" },
    { simbolo: "TLT", nome: "Treasury 20Y" },
    { simbolo: "GC=F", nome: "Ouro" }
];

async function ultimoPreco(simbolo) {
    const url = `https://corsproxy.io/?https://query1.finance.yahoo.com/v8/finance/chart/${encodeURIComponent(simbolo)}?range=1d&interval=1m`;
    const r = await fetch(url);
    const j = await r.json();

    const res = j.chart.result[0];
    const timestamps = res.timestamp;
    const closes = res.indicators.quote[0].close;

    return {
        tempo: new Date(timestamps[timestamps.length - 1] * 1000).toLocaleTimeString(),
        preco: closes[closes.length - 1]
    };
}

const traces = ativos.map(a => ({
    x: [],
    y: [],
    type: 'scatter',
    mode: 'lines',
    name: a.nome
}));

Plotly.newPlot(
    'grafico',
    traces,
    {
        title: 'Ativos de Risco x Segurança (Tempo Real)',
        xaxis: { title: 'Hora', automargin: true },
        yaxis: { title: 'Preço', automargin: true },
        margin: { t: 50 }
    },
    { responsive: true }
);

async function atualizarGrafico() {
    const xData = [];
    const yData = [];

    for (const ativo of ativos) {
        const dado = await ultimoPreco(ativo.simbolo);
        xData.push([dado.tempo]);
        yData.push([dado.preco]);
    }

    Plotly.extendTraces(
        'grafico',
        { x: xData, y: yData },
        ativos.map((_, i) => i),
        60 // mantém últimos 60 pontos
    );
}

// primeira carga
atualizarGrafico();

// atualiza a cada 60 segundos
setInterval(atualizarGrafico, 60000);
</script>

</body>
</html>
