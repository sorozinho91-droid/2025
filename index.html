<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard – Ativos de Risco e Segurança</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
body { font-family: Arial, sans-serif; margin: 0; background: #f4f6f8; }
header { background: #1f2937; color: white; padding: 15px; text-align: center; }
#controls, #filtro { text-align: center; padding: 10px; }
button { margin: 5px; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; background: #e5e7eb; }
button.active { background: #2563eb; color: white; }
#grafico { width: 100%; height: 600px; }
</style>
</head>
<body>

<header>
<h2>Ativos de Risco x Segurança – Tempo Real</h2>
</header>

<div id="controls">
<button onclick="setTimeframe(0.5, this)">30s</button>
<button onclick="setTimeframe(1, this)" class="active">1m</button>
<button onclick="setTimeframe(5, this)">5m</button>
<button onclick="setTimeframe(15, this)">15m</button>
<button onclick="setTimeframe(60, this)">1h</button>
</div>

<div id="filtro">
<button onclick="filtrar('todos', this)" class="active">Todos</button>
<button onclick="filtrar('seguranca', this)">Segurança</button>
<button onclick="filtrar('risco', this)">Risco</button>
</div>

<div id="grafico"></div>

<script>
// Configurações
let timeframe = 1; // minutos
let timer = null;

let datas = [];
let ativos = {
    "DXY": [], "VIX": [], "Ouro": [],
    "S&P 500": [], "NASDAQ": [], "Nikkei": [], "DAX": []
};

let valores = {
    "DXY": 100, "VIX": 20, "Ouro": 1800,
    "S&P 500": 4000, "NASDAQ": 12000, "Nikkei": 30000, "DAX": 15000
};

let vol = {
    "DXY": 0.2, "VIX": 0.3, "Ouro": 0.5,
    "S&P 500": 2, "NASDAQ": 3, "Nikkei": 2.5, "DAX": 2
};

let ativosSeguranca = ["DXY","VIX","Ouro"];
let ativosRisco = ["S&P 500","NASDAQ","Nikkei","DAX"];

// Função para gerar valores aleatórios
function atualizarValor(valor, volatilidade){
    return Math.max(0, valor + (Math.random()-0.5)*volatilidade);
}

// Gerar histórico de 2 dias (1 ponto/minuto)
function gerarHistorico2Dias(){
    const agora = new Date();
    const start = new Date(agora.getTime() - 2*24*60*60*1000);
    datas = [];
    for(let d = new Date(start); d <= agora; d.setMinutes(d.getMinutes()+1)){
        datas.push(new Date(d));
        for(const ativo in ativos){
            valores[ativo] = atualizarValor(valores[ativo], vol[ativo]);
            ativos[ativo].push(valores[ativo]);
        }
    }
}

// Atualização em tempo real
function atualizarGrafico(){
    const agora = new Date();
    datas.push(agora);
    for(const ativo in ativos){
        valores[ativo] = atualizarValor(valores[ativo], vol[ativo]);
        ativos[ativo].push(valores[ativo]);
    }
    Plotly.extendTraces('grafico',{
        x: Object.values(ativos).map((_,i)=>[agora]),
        y: Object.values(ativos).map(a=>[a[a.length-1]])
    }, [...Array(Object.keys(ativos).length).keys()]);
}

// Alterar timeframe
function setTimeframe(minutos, botao){
    timeframe = minutos;
    document.querySelectorAll('#controls button').forEach(b=>b.classList.remove('active'));
    botao.classList.add('active');
    if(timer) clearInterval(timer);
    timer = setInterval(atualizarGrafico, timeframe*60000);
}

// Filtrar ativos
function filtrar(tipo, botao){
    document.querySelectorAll('#filtro button').forEach(b=>b.classList.remove('active'));
    botao.classList.add('active');

    let tracesVisiveis = [];
    if(tipo==="todos") tracesVisiveis = Object.keys(ativos);
    if(tipo==="seguranca") tracesVisiveis = ativosSeguranca;
    if(tipo==="risco") tracesVisiveis = ativosRisco;

    const update = { visible: Object.keys(ativos).map(a => tracesVisiveis.includes(a)) };
    Plotly.restyle('grafico', update);
}

/* Inicialização */
gerarHistorico2Dias();

// Criar traces
const cores = {
    "DXY": "blue", "VIX": "purple", "Ouro": "gold",
    "S&P 500": "red", "NASDAQ": "orange", "Nikkei": "pink", "DAX": "brown"
};

const traces = [];
for(const ativo in ativos){
    traces.push({
        x: datas,
        y: ativos[ativo],
        mode: 'lines+markers',
        name: ativo,
        line:{color:cores[ativo], width:2},
        marker:{size:4},
        hovertemplate: 'Ativo: '+ativo+'<br>Data: %{x|%d/%m/%Y %H:%M}<br>Valor: %{y:.2f}<extra></extra>'
    });
}

const layout = {
    title: 'Ativos de Risco e Segurança – Tempo Real',
    xaxis:{title:'Data', type:'date'},
    yaxis:{title:'Valor'},
    margin:{t:50},
    legend:{x:1,xanchor:'right',y:1,font:{size:12},bgcolor:'#f4f6f8',bordercolor:'#888',borderwidth:1}
};

Plotly.newPlot('grafico', traces, layout, {responsive:true});

// Atualização em tempo real
timer = setInterval(atualizarGrafico, timeframe*60000);
window.addEventListener('resize',()=>{Plotly.Plots.resize('grafico');});
</script>

</body>
</html>
