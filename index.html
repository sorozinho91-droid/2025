<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dire√ß√£o Macro ‚Äì Mini √çndice (WIN)</title>
<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#f3f4f6;
}
header{
  background:#111827;
  color:#fff;
  padding:10px;
  text-align:center;
  font-size:18px;
  font-weight:bold;
}
#relogio{
  text-align:center;
  font-size:18px;
  font-weight:bold;
  padding:6px;
  margin-bottom:10px;
  color:#fff;
  background:#1f2937;
  border-radius:6px;
}
#layout{
  display:flex;
  justify-content:center;
  gap:15px;
  padding:10px;
}
#macro{
  width:420px;
  background:#fff;
  border-radius:8px;
  box-shadow:0 2px 8px rgba(0,0,0,.15);
  padding:12px;
  text-align:center;
}
#ativos-risco{
  width:100%;
  border-collapse:collapse;
  margin-bottom:12px;
  font-size:14px;
}
#ativos-risco th{
  background:#1f2937;
  color:#fff;
  padding:8px;
}
#ativos-risco td{
  padding:6px;
  border-bottom:1px solid #e5e7eb;
  text-align:center;
  font-weight:bold;
}
.alta{ background:#dcfce7; color:#065f46; }
.baixa{ background:#fee2e2; color:#7f1d1d; }
.neutra{ background:#fef9c3; color:#78350f; }
#direcao{
  font-size:20px;
  font-weight:bold;
  padding:12px;
  margin-top:10px;
  border-radius:6px;
  transition: background 0.5s, color 0.5s;
}
#iconeDirecao svg{
  width:60px;
  height:60px;
  margin-top:10px;
  transition: transform 0.5s;
}
.pulsar{
  animation: pulseZoom 0.8s ease;
}
@keyframes pulseZoom{
  0% {transform: scale(1);}
  50% {transform: scale(1.5);}
  100% {transform: scale(1);}
}
#painel-direito{
  width:360px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
#breaking{
  background:#111827;
  color:#fff;
  border-radius:8px;
  box-shadow:0 4px 12px rgba(0,0,0,.3);
  overflow:hidden;
}
.breaking-header{
  background:#b91c1c;
  padding:10px;
  font-weight:bold;
  text-align:center;
  font-size:16px;
}
#breaking-list{
  max-height:220px;
  overflow-y:auto;
  font-size:14px;
  padding:6px;
}
.breaking-item{
  background:#1f2937;
  margin:6px 0;
  padding:10px;
  border-radius:6px;
  transition: transform 0.2s, background 0.3s;
}
.breaking-item:hover{
  transform:translateX(5px);
  background:#374151;
}
.breaking-item a{
  color:#60a5fa;
  text-decoration:none;
  font-weight:500;
}
.breaking-item.alerta{
  border-left:4px solid #f87171;
  background:#7f1d1d;
  animation:pulse 1.5s infinite;
}
@keyframes pulse{
  0%,100%{opacity:1;}
  50%{opacity:0.7;}
}
#mercado{
  background:#ffffff;
  border-radius:6px;
  box-shadow:0 2px 8px rgba(0,0,0,.2);
}
.mercado-header{
  background:#1f2937;
  color:#fff;
  padding:8px;
  font-weight:bold;
  text-align:center;
}
#mercado-list{
  max-height:220px;
  overflow-y:auto;
  font-size:13px;
}
.mercado-item{
  padding:8px;
  border-bottom:1px solid #e5e7eb;
}
.mercado-item a{
  color:#1d4ed8;
  text-decoration:none;
}
.alerta-contrario{
  animation:pulse 1s infinite;
}
#grafico-container{
  width:90%;
  max-width:900px;
  margin:20px auto;
  background:#fff;
  padding:12px;
  border-radius:8px;
  box-shadow:0 2px 8px rgba(0,0,0,.15);
}
</style>
</head>
<body>

<header>üìä Dire√ß√£o Macro do Mercado ‚Äì Mini √çndice (WIN)</header>
<div id="relogio">‚è∞ --:--:--</div>

<div id="layout">
  <div id="macro">
    <table id="ativos-risco">
      <thead>
        <tr><th>Ativo</th><th>Leitura</th></tr>
      </thead>
      <tbody>
        <tr><td>S&P 500</td><td id="sp500" class="neutra">NEUTRO</td></tr>
        <tr><td>VIX</td><td id="vix" class="neutra">NEUTRO</td></tr>
        <tr><td>DXY</td><td id="dxy" class="neutra">NEUTRO</td></tr>
        <tr><td>DI Futuro</td><td id="di" class="neutra">NEUTRO</td></tr>
      </tbody>
    </table>
    <div id="direcao" data-macro="NEUTRO">üü° NEUTRO</div>
    <div id="iconeDirecao"></div>
    <div id="variacao" style="margin-top:8px;font-weight:bold;font-size:16px;"></div>
  </div>

  <div id="painel-direito">
    <div id="mercado">
      <div class="mercado-header">üì∞ Not√≠cias de Mercado</div>
      <div id="mercado-list">
        <div class="mercado-item">Aguardando not√≠cias...</div>
      </div>
    </div>
    <div id="breaking">
      <div class="breaking-header">üö® BREAKING NEWS</div>
      <div id="breaking-list">
        <div class="breaking-item">Aguardando not√≠cias...</div>
      </div>
    </div>
  </div>
</div>

<div id="grafico-container">
  <canvas id="graficoAtivos"></canvas>
</div>

<audio id="somAlerta" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// REL√ìGIO
function atualizarRelogio(){
  const agora = new Date();
  const utc = agora.getTime() + agora.getTimezoneOffset()*60000;
  const br = new Date(utc - 3*3600000);
  document.getElementById("relogio").innerHTML = "‚è∞ Hor√°rio de Bras√≠lia: " + br.toLocaleTimeString("pt-BR");
}
setInterval(atualizarRelogio,1000);
atualizarRelogio();

// DIRE√á√ÉO SCORE
const svgTouro = `<svg viewBox="0 0 64 64" fill="#16a34a"><path d="M32 2l6 12 12 2-9 9 2 12-11-6-11 6 2-12-9-9 12-2z"/></svg>`;
const svgUrso  = `<svg viewBox="0 0 64 64" fill="#dc2626"><path d="M32 2l-6 12-12 2 9 9-2 12 11-6 11 6-2-12 9-9-12-2z"/></svg>`;
function atualizarDirecaoScore(price, open, ativos){
  let score = 0;
  ativos.forEach(a=>{
    if(a.tipo==="risco" && a.status==="ALTA") score++;
    if(a.tipo==="seguranca" && a.status==="ALTA") score--;
  });
  const bloco = document.getElementById("direcao");
  const icone = document.getElementById("iconeDirecao");
  const variacao = document.getElementById("variacao");
  icone.innerHTML = "";
  const pct = ((price - open)/open*100).toFixed(2);
  variacao.innerHTML = `Varia√ß√£o: ${pct}%`;
  if(score>0){
    bloco.style.background="#dcfce7";
    bloco.style.color="#065f46";
    bloco.innerHTML = `üü¢ ALTA - Score: ${score}`;
    icone.innerHTML = `<span class="pulsar">${svgTouro}</span>`;
  } else if(score<0){
    bloco.style.background="#fee2e2";
    bloco.style.color="#7f1d1d";
    bloco.innerHTML = `üî¥ BAIXA - Score: ${score}`;
    icone.innerHTML = `<span class="pulsar">${svgUrso}</span>`;
  } else{
    bloco.style.background="#fef9c3";
    bloco.style.color="#78350f";
    bloco.innerHTML = "üü° NEUTRO";
  }
}

// ATUALIZA ATIVOS E SCORE
async function atualizarAtivosScore(){
  const chave = "d58a789r01qptoar8c7gd58a789r01qptoar8c80";
  const ativos = [
    {id:"sp500", symbol:"^GSPC", tipo:"risco"},
    {id:"vix", symbol:"^VIX", tipo:"seguranca"},
    {id:"dxy", symbol:"DX-Y.NYB", tipo:"seguranca"},
    {id:"di", symbol:"DI1!", tipo:"seguranca"}
  ];
  for(let a of ativos){
    try{
      const res = await fetch(`https://api.hgbrasil.com/finance/quote?key=${chave}&symbol=${a.symbol}`);
      const data = await res.json();
      const price = data.results[a.symbol].price;
      const open  = data.results[a.symbol].open_price;
      const td = document.getElementById(a.id);
      if(price>open){ td.className="alta"; td.textContent="ALTA"; a.status="ALTA"; }
      else if(price<open){ td.className="baixa"; td.textContent="BAIXA"; a.status="BAIXA"; }
      else{ td.className="neutra"; td.textContent="NEUTRO"; a.status="NEUTRO"; }
    }catch(err){ console.log("Erro ativo:", a.symbol, err);}
  }
  try{
    const res = await fetch(`https://api.hgbrasil.com/finance/quote?key=${chave}&symbol=WIN`);
    const data = await res.json();
    const price = data.results.WIN.price;
    const open  = data.results.WIN.open_price;
    atualizarDirecaoScore(price, open, ativos);
  }catch(err){console.log("Erro Mini:", err);}
}
atualizarAtivosScore();
setInterval(atualizarAtivosScore,5000);

// BREAKING NEWS
const palavrasImpacto = ["b3","ibovespa","juros","selic","bolsa","infla√ß√£o","recess√£o","economia brasil","crise","investimento"];
const breakingList = document.getElementById("breaking-list");
const som = document.getElementById("somAlerta");
async function buscarBreaking(){
  const rss="https://news.google.com/rss/search?q=b3+OR+ibovespa+OR+economia+brasil+OR+infla√ß√£o+OR+juros&hl=pt-BR&gl=BR&ceid=BR:pt";
  const url="https://api.allorigins.win/raw?url="+encodeURIComponent(rss);
  const res = await fetch(url);
  const text = await res.text();
  const xml = new DOMParser().parseFromString(text,"text/xml");
  const items = xml.querySelectorAll("item");
  breakingList.innerHTML="";
  let count=0;
  items.forEach(item=>{
    if(count>=5) return;
    const titulo=item.querySelector("title").textContent;
    const link=item.querySelector("link").textContent;
    if(palavrasImpacto.some(p=>titulo.toLowerCase().includes(p))){
      const div=document.createElement("div");
      div.className="breaking-item";
      if(["queda","crise","recess√£o","alta de juros","infla√ß√£o"].some(n=>titulo.toLowerCase().includes(n))){
        div.classList.add("alerta");
        som.play().catch(()=>{});
      }
      div.innerHTML=`<strong>${titulo}</strong><br><a href="${link}" target="_blank">Ler</a>`;
      breakingList.appendChild(div);
      count++;
    }
  });
  if(breakingList.children.length===0){
    breakingList.innerHTML='<div class="breaking-item">Nenhuma not√≠cia relevante no momento...</div>';
  }
}
buscarBreaking();
setInterval(buscarBreaking,30000);

// NOT√çCIAS MERCADO
const mercadoList = document.getElementById("mercado-list");
async function buscarMercado(){
  const rss="https://news.google.com/rss/search?q=mercado+financeiro+OR+b3+OR+economia+brasil&hl=pt-BR&gl=BR&ceid=BR:pt";
  const url="https://api.allorigins.win/raw?url="+encodeURIComponent(rss);
  const res = await fetch(url);
  const text = await res.text();
  const xml = new DOMParser().parseFromString(text,"text/xml");
  const items = xml.querySelectorAll("item");
  mercadoList.innerHTML="";
  items.forEach((item,i)=>{
    if(i>4) return;
    const t=item.querySelector("title").textContent;
    const l=item.querySelector("link").textContent;
    const div=document.createElement("div");
    div.className="mercado-item";
    div.innerHTML=`${t}<br><a href="${l}" target="_blank">Ler</a>`;
    mercadoList.appendChild(div);
  });
}
buscarMercado();
setInterval(buscarMercado,60000);

// GR√ÅFICO INTRADAY: 2 LINHAS (Risco x Seguran√ßa)
const ctx = document.getElementById('graficoAtivos').getContext('2d');
const grafico = new Chart(ctx,{
    type:'line',
    data:{labels:[], datasets:[
        {label:'Ativos de Risco', data:[], borderColor:'#dc2626', backgroundColor:'rgba(220,38,38,0.1)', tension:0.2},
        {label:'Ativos de Seguran√ßa', data:[], borderColor:'#16a34a', backgroundColor:'rgba(22,163,70,0.1)', tension:0.2}
    ]},
    options:{
        responsive:true,
        interaction:{mode:'index', intersect:false},
        plugins:{legend:{position:'top'}},
        scales:{x:{title:{display:true,text:'Hor√°rio'}}, y:{title:{display:true,text:'Pre√ßo'}, beginAtZero:false}}
    }
});

async function atualizarGrafico(){
    const chave="d58a789r01qptoar8c7gd58a789r01qptoar8c80";
    const risco=["^GSPC"];
    const seguranca=["^VIX","DX-Y.NYB","DI1!"];
    const agora = new Date();
    const horario = agora.toLocaleTimeString('pt-BR',{hour12:false});
    grafico.data.labels.push(horario);
    if(grafico.data.labels.length>120) grafico.data.labels.shift(); // √öltimas 2h aprox (1min ponto)
    async function mediaGrupo(grupo){
        let soma=0, cont=0;
        for(let s of grupo){
            try{
                const res = await fetch(`https://api.hgbrasil.com/finance/quote?key=${chave}&symbol=${s}`);
                const data = await res.json();
                const price = data.results[s].price;
                soma+=price;
                cont++;
            }catch(err){console.log("Erro:",s);}
        }
        return cont>0 ? soma/cont : null;
    }
    const mediaRisco = await mediaGrupo(risco);
    const mediaSeg = await mediaGrupo(seguranca);
    grafico.data.datasets[0].data.push(mediaRisco);
    grafico.data.datasets[1].data.push(mediaSeg);
    if(grafico.data.datasets[0].data.length>120){grafico.data.datasets[0].data.shift(); grafico.data.datasets[1].data.shift();}
    grafico.update();
}
atualizarGrafico();
setInterval(atualizarGrafico,60000);
</script>
</body>
</html>
