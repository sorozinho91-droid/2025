<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Tendência Intraday do Dólar</title>

<script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>

<style>
body {
  background:#0e0e0e;
  color:#e0e0e0;
  font-family: Arial, Helvetica, sans-serif;
  margin:20px;
}
#grafico {
  width:100%;
  height:520px;
  background:#111;
  border-radius:8px;
}
h2 { margin-bottom:5px; }
p { color:#aaa; margin-top:0; }
</style>
</head>

<body>

<h2>Tendência Intraday do Dólar</h2>
<p>Dados reais • Atualização automática a cada 60 segundos</p>

<div id="grafico"></div>

<script>
/* =========================
   CONFIGURAÇÃO
========================= */
const API_KEY = "d58a789r01qptoar8c7gd58a789r01qptoar8c80";
const INTERVALO = "1min";

/* =========================
   ATIVOS (NENHUM DE FORA)
========================= */
const ativos = [
  // ATIVOS DE RISCO (se sobem, dólar tende a cair)
  {symbol:"XAU/USD", tipo:"risco"},   // Ouro
  {symbol:"HG", tipo:"risco"},        // Cobre
  {symbol:"CL", tipo:"risco"},        // Petróleo
  {symbol:"EWZ", tipo:"risco"},       // Brasil ETF
  {symbol:"VALE", tipo:"risco"},
  {symbol:"PBR", tipo:"risco"},
  {symbol:"XLF", tipo:"risco"},
  {symbol:"XLP", tipo:"risco"},
  {symbol:"XLE", tipo:"risco"},
  {symbol:"XME", tipo:"risco"},
  {symbol:"EEM", tipo:"risco"},
  {symbol:"SOXX", tipo:"risco"},

  // ATIVOS DE SEGURANÇA (se sobem, dólar tende a subir)
  {symbol:"DXY", tipo:"seguranca"},
  {symbol:"USD/NOK", tipo:"seguranca"},
  {symbol:"USD/AUD", tipo:"seguranca"},
  {symbol:"USD/NZD", tipo:"seguranca"},
  {symbol:"USD/KRW", tipo:"seguranca"},
  {symbol:"USD/CNY", tipo:"seguranca"},
  {symbol:"EUR/BRL", tipo:"seguranca"}
];

/* =========================
   BUSCA DADO REAL
========================= */
async function getDirecao(symbol) {
  const url = `https://api.twelvedata.com/time_series?symbol=${symbol}&interval=${INTERVALO}&outputsize=2&apikey=${API_KEY}`;
  try {
    const r = await fetch(url);
    const d = await r.json();
    if (!d.values || d.values.length < 2) return 0;

    const atual = parseFloat(d.values[0].close);
    const anterior = parseFloat(d.values[1].close);

    return atual > anterior ? 1 : atual < anterior ? -1 : 0;
  } catch {
    return 0;
  }
}

/* =========================
   SCORE DO DÓLAR
========================= */
async function calcularScore() {
  let score = 0;
  let total = 0;

  for (let a of ativos) {
    const dir = await getDirecao(a.symbol);
    if (dir !== 0) {
      total++;
      score += a.tipo === "seguranca" ? dir : -dir;
    }
  }
  return total ? +(score / total).toFixed(2) : 0;
}

/* =========================
   GRÁFICO
========================= */
const chart = echarts.init(document.getElementById("grafico"));
let historico = [];

async function atualizar() {
  const hora = new Date().toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});
  const score = await calcularScore();

  historico.push({hora, score});
  if (historico.length > 120) historico.shift();

  chart.setOption({
    backgroundColor:"#111",
    xAxis:{
      type:"category",
      data:historico.map(h=>h.hora),
      axisLabel:{color:"#aaa"}
    },
    yAxis:{
      min:-1,
      max:1,
      axisLabel:{color:"#aaa"},
      splitLine:{lineStyle:{color:"#222"}}
    },
    visualMap:{
      show:false,
      pieces:[
        {gt:0.25, color:"#00c853"},     // Alta do dólar
        {gte:-0.25, lte:0.25, color:"#9e9e9e"}, // Neutro
        {lt:-0.25, color:"#d50000"}     // Baixa do dólar
      ]
    },
    series:[{
      type:"line",
      smooth:true,
      data:historico.map(h=>h.score),
      symbolSize:6,
      lineStyle:{width:2}
    }]
  });
}

/* =========================
   LOOP AUTOMÁTICO
========================= */
atualizar();
setInterval(atualizar, 60000);
</script>

</body>
</html>
