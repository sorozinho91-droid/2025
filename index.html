<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard Tempo Real</title>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
}

#grafico {
    width: 100%;
    height: 100%;
}
</style>
</head>

<body>

<div id="grafico"></div>

<script>
/* =========================
   HORÁRIO INICIAL FIXO
========================= */
const inicio = new Date();

/* =========================
   VALORES
========================= */
let valorRisco = 100;
let valorSeguro = 100;

/* =========================
   FUNÇÃO DE ATUALIZAÇÃO
========================= */
function atualizar(valor) {
    return Math.max(0, valor + (Math.random() - 0.5) * 2);
}

/* =========================
   TRACES
========================= */
const traceRisco = {
    x: [],
    y: [],
    type: 'scatter',
    mode: 'lines',
    name: 'Risco',
    line: { color: 'red' }
};

const traceSeguro = {
    x: [],
    y: [],
    type: 'scatter',
    mode: 'lines',
    name: 'Seguro',
    line: { color: 'green' }
};

/* =========================
   LAYOUT (X FIXO NO INÍCIO)
========================= */
const layout = {
    autosize: true,
    xaxis: {
        type: 'date',
        title: 'Horário',
        range: [inicio, inicio],
        tickformat: '%H:%M:%S'
    },
    yaxis: {
        title: 'Valor'
    },
    margin: { t: 30, l: 50, r: 20, b: 50 }
};

/* =========================
   CRIA O GRÁFICO
========================= */
Plotly.newPlot(
    'grafico',
    [traceRisco, traceSeguro],
    layout,
    { responsive: true }
);

/* =========================
   LOOP EM TEMPO REAL
========================= */
setInterval(() => {
    const agora = new Date();

    valorRisco = atualizar(valorRisco);
    valorSeguro = atualizar(valorSeguro);

    Plotly.extendTraces(
        'grafico',
        {
            x: [[agora], [agora]],
            y: [[valorRisco], [valorSeguro]]
        },
        [0, 1],
        60
    );

    /* início FIXO, final avança */
    Plotly.relayout('grafico', {
        'xaxis.range': [inicio, agora]
    });

}, 3000);
</script>

</body>
</html>
