<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Monitor Risco x Segurança (Intraday)</title>
    <script src="cdn.jsdelivr.net"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        .container { max-width: 1200px; margin: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; background-color: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .grid-container { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .asset-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .asset-table th, .asset-table td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        .asset-table th { background-color: #007bff; color: white; }
        .price { font-weight: bold; }
        .change-pct.positive { color: #28a745; }
        .change-pct.negative { color: #dc3545; }
        .risk-header { background-color: #e65c5c !important; }
        .safety-header { background-color: #4CAF50 !important; }
        #direction-indicator { font-size: 20px; font-weight: bold; padding: 10px; border-radius: 5px; text-align: center; margin-top: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Monitor Financeiro Risco x Segurança</h1>
            <p>Última atualização: <span id="last-updated">--:--:--</span></p>
        </div>

        <div class="grid-container">
            <div class="card">
                <h2>Gráfico de Direção (Intraday)</h2>
                <canvas id="riskSafetyChart"></canvas>
                <div id="direction-indicator"></div>
            </div>

            <div>
                <div class="card">
                    <h2>Ativos de Risco</h2>
                    <table class="asset-table">
                        <thead>
                            <tr><th>Ativo</th><th>Preço</th><th>Var. (%)</th></tr>
                        </thead>
                        <tbody id="risk-assets-body"></tbody>
                    </table>
                </div>
                <div class="card" style="margin-top: 20px;">
                    <h2>Ativos de Segurança</h2>
                    <table class="asset-table">
                        <thead>
                            <tr class="safety-header"><th>Ativo</th><th>Preço</th><th>Var. (%)</th></tr>
                        </thead>
                        <tbody id="safety-assets-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Use uma API Key real de um serviço como brapi.dev, Finage, Alpha Vantage ou IEX Cloud
        const API_KEY = "SUA_API_KEY"; 
        // Note que tickers para futuros (FUT) e commodities podem variar por API. 
        // Os ADRs (VALE, PBR) e ETFs (EWZ) geralmente funcionam em APIs globais.
        const ASSETS = {
            'Risco': ['VALE', 'PBR', 'EWZ', 'GLD', '^DJI'], // Exemplo com VALE ADR, Petrobras ADR, iShares Brazil ETF, Ouro spot, Dow Jones Futuro
            'Segurança': ['DXY', 'EURUSD', 'USDJPY'] // Índice Dólar Futuros (DXY), Pares Forex
        };
        const UPDATE_INTERVAL = 60000; // 60 segundos
        const accumulatedData = { labels: [], riskAvg: [], safetyAvg: [] };
        let chart;

        async function fetchQuotes(assetList) {
            // Este é um exemplo CONCEITUAL de como chamar uma API
            // APIs reais para commodities (minério de ferro, cobre) e futuros específicos
            // geralmente exigem serviços pagos ou endpoints específicos.
            const apiUrl = `https://api.example.com/quotes?symbols=${assetList.join(',')}&apiKey=${API_KEY}`;
            
            try {
                // Em um cenário real, você faria várias chamadas de API ou usaria uma WebSocket para tempo real.
                // Esta função mock simula uma resposta:
                const mockData = {
                    'VALE': { price: 13.50, change: 1.2 }, 'PBR': { price: 15.00, change: 0.8 }, 
                    'EWZ': { price: 30.00, change: 1.5 }, 'GLD': { price: 2100, change: 0.5 },
                    '^DJI': { price: 40000, change: 0.3 }, 
                    'DXY': { price: 105.00, change: -0.2 }, 'EURUSD': { price: 1.08, change: -0.1 },
                    'USDJPY': { price: 150.00, change: -0.3 }
                };
                return mockData;
                
            } catch (error) {
                console.error("Erro ao buscar cotações:", error);
                return null;
            }
        }

        function updateUI(quotes) {
            if (!quotes) return;

            // Update Tables
            for (const type in ASSETS) {
                const tbody = document.getElementById(`${type.toLowerCase()}-assets-body`);
                tbody.innerHTML = '';
                ASSETS[type].forEach(symbol => {
                    const asset = quotes[symbol];
                    if (asset) {
                        const row = document.createElement('tr');
                        const changeClass = asset.change >= 0 ? 'positive' : 'negative';
                        row.innerHTML = `
                            <td>${symbol}</td>
                            <td class="price">${asset.price.toFixed(2)}</td>
                            <td class="change-pct ${changeClass}">${asset.change.toFixed(2)}%</td>
                        `;
                        tbody.appendChild(row);
                    }
                });
            }
            document.getElementById('last-updated').textContent = new Date().toLocaleTimeString();

            // Update Chart Data
            const riskChanges = ASSETS['Risco'].map(s => quotes[s]?.change || 0);
            const safetyChanges = ASSETS['Segurança'].map(s => quotes[s]?.change || 0);

            const avgRisk = riskChanges.reduce((a, b) => a + b, 0) / riskChanges.length;
            const avgSafety = safetyChanges.reduce((a, b) => a + b, 0) / safetyChanges.length;

            accumulatedData.labels.push(new Date().toLocaleTimeString());
            accumulatedData.riskAvg.push(avgRisk);
            accumulatedData.safetyAvg.push(avgSafety);

            // Keep only the last 30 data points for performance
            if (accumulatedData.labels.length > 30) {
                accumulatedData.labels.shift();
                accumulatedData.riskAvg.shift();
                accumulatedData.safetyAvg.shift();
            }

            if (chart) {
                chart.update();
                updateDirectionIndicator(avgRisk, avgSafety);
            }
        }

        function updateDirectionIndicator(risk, safety) {
            const indicator = document.getElementById('direction-indicator');
            if (risk > 0 && safety < 0) {
                indicator.textContent = 'Modo: Risco Ligado (Risk-On)';
                indicator.style.backgroundColor = '#d4edda';
                indicator.style.color = '#155724';
            } else if (risk < 0 && safety > 0) {
                indicator.textContent = 'Modo: Fuga para Segurança (Risk-Off)';
                indicator.style.backgroundColor = '#f8d7da';
                indicator.style.color = '#721c24';
            } else {
                indicator.textContent = 'Modo: Indefinido/Lateral';
                indicator.style.backgroundColor = '#fff3cd';
                indicator.style.color = '#856404';
            }
        }

        function initializeChart() {
            const ctx = document.getElementById('riskSafetyChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: accumulatedData.labels,
                    datasets: [{
                        label: 'Variação Média Risco (%)',
                        data: accumulatedData.riskAvg,
                        borderColor: '#e65c5c',
                        backgroundColor: 'rgba(230, 92, 92, 0.2)',
                        fill: false,
                        tension: 0.1
                    }, {
                        label: 'Variação Média Segurança (%)',
                        data: accumulatedData.safetyAvg,
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.2)',
                        fill: false,
                        tension: 0.1
                    }]
                },
                options: { responsive: true, scales: { y: { beginAtZero: false, title: { display: true, text: 'Variação (%)' } } } }
            });
        }

        async function main() {
            initializeChart();
            const allAssets = [...ASSETS['Risco'], ...ASSETS['Segurança']];
            const quotes = await fetchQuotes(allAssets);
            updateUI(quotes);
            setInterval(async () => {
                const quotes = await fetchQuotes(allAssets);
                updateUI(quotes);
            }, UPDATE_INTERVAL);
        }

        main();
    </script>
</body>
</html>
