<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sentimento e Tend√™ncia do Mercado Global</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f4f6f8; display:flex; flex-direction:column; align-items:center; min-height:100vh; }
header { background:#1f2937; color:white; padding:10px; text-align:center; width:100%; }
#relogio { text-align:center; font-size:16px; margin:10px 0; font-weight:bold; }

#tabelaSentimento { width:600px; font-size:14px; background:#fff; border-collapse:collapse; box-shadow:0 2px 6px rgba(0,0,0,0.1); margin-top:20px; }
#tabelaSentimento th, #tabelaSentimento td { padding:6px; border:1px solid #ccc; text-align:center; }
#tabelaSentimento thead th { background:#2563eb; color:white; }
td.variacao { color:white; font-weight:bold; }

/* Tooltip colorido */
td[title]{ position:relative; cursor:pointer; }
td[title]:hover::after{
  content:attr(title);
  position:absolute; bottom:100%; left:50%; transform:translateX(-50%);
  padding:5px 8px; border-radius:4px; white-space:nowrap; font-size:12px; z-index:10;
  color:#fff; background: linear-gradient(to right, red, green);
}

/* Barra de Sentimento */
#sentimentoBarContainer { width:600px; height:30px; background:#e5e7eb; border-radius:6px; margin:20px 0; overflow:hidden; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
#sentimentoBar { height:100%; width:50%; text-align:center; line-height:30px; color:white; font-weight:bold; transition: width 0.5s, background 0.5s; border-radius:6px; }
#sentimentoBar.risco { background:green; }
#sentimentoBar.seguro { background:red; }
#sentimentoBar.pisca { animation: piscarBarra 1s infinite; }
@keyframes piscarBarra { 0% { opacity:1;} 50%{opacity:0.5;} 100%{opacity:1;} }

/* BREAKING NEWS */
#painel-news{ position:fixed; top:28px; right:10px; width:360px; background:#111827; color:white; border-radius:6px; box-shadow:0 4px 8px rgba(0,0,0,0.3); z-index:9998; }
.news-header{ text-align:center; font-weight:bold; padding:8px; background:#1f2937; border-radius:6px 6px 0 0; }
#newsList{ max-height:260px; overflow-y:auto; font-size:13px; }
.news-item{ padding:8px; border-bottom:1px solid #374151; }
.news-item a{ color:#93c5fd; text-decoration:none; }
.breaking{ animation:piscar 1s infinite; }

/* ALERTA MERCADO */
#alerta-mercado { position: fixed; top:32px; left:10px; width:280px; background: #ffffff; border-left: 5px solid #c00000; box-shadow: 0 2px 8px rgba(0,0,0,0.2); font-family: Arial, sans-serif; font-size: 12px; z-index:9999; }
.alerta-header { background: #c00000; color: #fff; font-weight: bold; text-align: center; padding: 6px; font-size: 11px; }
#alerta-conteudo { padding: 8px; line-height: 1.3; }
.piscar { animation:pisca 1s infinite; }
@keyframes pisca { 0% { background: #ffffff; } 50% { background: #ffe5e5; } 100% { background: #ffffff; }
}
</style>
</head>
<body>

<header>
<h2>Sentimento e Tend√™ncia do Mercado Global</h2>
</header>

<div id="relogio"></div>

<table id="tabelaSentimento">
<thead>
<tr><th>Ativo</th><th>Sentimento</th><th>Varia√ß√£o (%)</th></tr>
</thead>
<tbody>
<tr id="loading"><td colspan="3">Carregando dados reais...</td></tr>
</tbody>
</table>

<div id="sentimentoBarContainer">
    <div id="sentimentoBar">50% Apetite ao Risco</div>
</div>

<div id="painel-news">
  <div class="news-header">üö® BREAKING NEWS ‚Äì Macro</div>
  <div id="newsList"><div id="aguardando" class="news-item">Aguardando not√≠cias...</div></div>
</div>
<audio id="alertSound" src="https://assets.mixkit.co/sfx/preview/mixkit-alert-alarm-1005.mp3"></audio>

<div id="alerta-mercado">
  <div class="alerta-header">‚ö†Ô∏è ALERTA MERCADO</div>
  <div id="alerta-conteudo">Aguardando not√≠cias...</div>
</div>
<audio id="alerta-som" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
<audio id="alerta-tendencia" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
// ===== Hor√°rio de Bras√≠lia =====
function agoraBrasilia(){
    const agora = new Date();
    const offset = -3;
    const utc = agora.getTime() + (agora.getTimezoneOffset()*60000);
    return new Date(utc + (3600000*offset));
}
function atualizarRelogio(){
    const agora = agoraBrasilia();
    const h = String(agora.getHours()).padStart(2,'0');
    const m = String(agora.getMinutes()).padStart(2,'0');
    const s = String(agora.getSeconds()).padStart(2,'0');
    document.getElementById('relogio').textContent = `Hor√°rio de Bras√≠lia: ${h}:${m}:${s}`;
}
setInterval(atualizarRelogio,1000); atualizarRelogio();

// ===== Ativos =====
const ativosRisco = [
  {nome:"S&P 500"}, {nome:"Nasdaq"}, {nome:"Dow Jones"}
];
const ativosSeguro = [
  {nome:"DXY - √çndice D√≥lar"}, {nome:"VIX - Volatilidade"}, {nome:"Ouro F√≠sico"}
];

let historicoRisco = [], historicoSeguro = [], ultimaTendencia="";

// Fun√ß√£o simulada de pre√ßo
async function fetchTradingViewPrice(symbol){ return Math.random()*100+100; }

// ===== Atualizar Sentimento =====
async function atualizarSentimento(){
    const tbody = document.querySelector("#tabelaSentimento tbody"); tbody.innerHTML="";
    let somaRisco=0, somaSeguro=0;
    function variacaoSafe(novo, antigo){ return (!novo||!antigo)?0:((novo-antigo)/antigo*100).toFixed(2); }

    function acaoAtivo(tipo){ return tipo=="Risco"?"Compra de Bolsa":"Compra de D√≥lar/Ouro"; }
    function corVariacao(vari){ const v = Math.max(-5, Math.min(5, parseFloat(vari))); return `background: linear-gradient(to right, red ${50-v*10}%, green ${50+v*10}%);`; }

    for(const a of ativosRisco){
        const valor = await fetchTradingViewPrice(a.nome) || a.ultimoValor || 0;
        const variacao = variacaoSafe(valor,a.ultimoValor||valor); a.ultimoValor=valor; somaRisco+=parseFloat(variacao);
        const tr = document.createElement("tr");
        tr.innerHTML=`<td title="Pre√ßo: ${valor.toFixed(2)}\nA√ß√£o: ${acaoAtivo('Risco')}">${a.nome}</td>
                      <td class="risco">Risco</td>
                      <td class="variacao" style="${corVariacao(variacao)}">${variacao}</td>`;
        tbody.appendChild(tr);
    }
    for(const a of ativosSeguro){
        const valor = await fetchTradingViewPrice(a.nome) || a.ultimoValor || 0;
        const variacao = variacaoSafe(valor,a.ultimoValor||valor); a.ultimoValor=valor; somaSeguro+=parseFloat(variacao);
        const tr = document.createElement("tr");
        tr.innerHTML=`<td title="Pre√ßo: ${valor.toFixed(2)}\nA√ß√£o: ${acaoAtivo('Seguro')}">${a.nome}</td>
                      <td class="seguro">Seguran√ßa</td>
                      <td class="variacao" style="${corVariacao(variacao)}">${variacao}</td>`;
        tbody.appendChild(tr);
    }

    historicoRisco.push(somaRisco); historicoSeguro.push(somaSeguro);
    if(historicoRisco.length>5){ historicoRisco.shift(); historicoSeguro.shift(); }
    const mediaRisco = historicoRisco.reduce((a,b)=>a+b,0)/historicoRisco.length;
    const mediaSeguro = historicoSeguro.reduce((a,b)=>a+b,0)/historicoSeguro.length;

    const bar = document.getElementById("sentimentoBar");
    if(mediaRisco>mediaSeguro){
        bar.textContent = `üìà ${Math.round(mediaRisco)}% Mercado em Tend√™ncia de Alta ‚Üí compra de Bolsa`;
        bar.className="risco";
    }else{
        bar.textContent = `üìâ ${Math.round(mediaSeguro)}% Mercado em Tend√™ncia de Baixa ‚Üí venda de Bolsa / compra de D√≥lar`;
        bar.className="seguro";
    }
    if(ultimaTendencia && ultimaTendencia!==bar.textContent){ bar.classList.add("pisca"); setTimeout(()=>bar.classList.remove("pisca"),12000); }
    ultimaTendencia = bar.textContent;
}

atualizarSentimento();
setInterval(atualizarSentimento,60000);
</script>
</body>
</html>
