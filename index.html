<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Risco x Segurança – Tempo Real</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f4f6f8; }
header { background:#1f2937; color:white; padding:15px; text-align:center; }
#controls { text-align:center; padding:10px; }
button { margin:5px; padding:8px 16px; border:none; border-radius:4px; cursor:pointer; background:#e5e7eb; }
button.active { background:#2563eb; color:white; }
#grafico { width:90%; max-width:1200px; height:400px; margin:20px auto; background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
table { width:90%; max-width:1200px; margin:20px auto; border-collapse: collapse; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.05);}
th, td { padding:8px; border:1px solid #ccc; text-align:center; font-size:14px;}
thead th { background:#2563eb; color:white;}
.risco { color:green; }
.seguro { color:red; }
.positivo { color:green; }
.negativo { color:red; }
</style>
</head>
<body>

<header>
<h2>Risco x Segurança – Linha do Tempo (Tempo Real)</h2>
</header>

<div id="controls">
<button onclick="setTimeframe(15,this)" class="active">15s</button>
<button onclick="setTimeframe(60,this)">60s</button>
<button onclick="setTimeframe(300,this)">5m</button>
</div>

<div id="grafico"></div>

<table id="tabelaRisco">
<thead>
<tr><th>Ativo de Risco</th><th>Valor Atual</th><th>Variação (%)</th></tr>
</thead>
<tbody></tbody>
</table>

<table id="tabelaSeguro">
<thead>
<tr><th>Ativo de Segurança</th><th>Valor Atual</th><th>Variação (%)</th></tr>
</thead>
<tbody></tbody>
</table>

<script>
// Dados iniciais
let datas = [], risco = [], seguro = [];
let valorRisco = 100, valorSeguro = 100;
let timeframe = 15; // atualizar a cada 15s
let timer = null;

// Ativos de Risco e Segurança (exemplo)
let ativosRisco = [
    {nome:"Ouro Futuros", valor:2766.2},
    {nome:"Petróleo WTI", valor:73.17},
    {nome:"Vale SA ADR", valor:9.16}
];
let ativosSeguranca = [
    {nome:"DXY - Índice Dólar", valor:107.16},
    {nome:"EUR/BRL", valor:6.18},
    {nome:"USD/NZD", valor:1.75}
];

// Gerar histórico inicial (últimas 24 horas)
function gerarHistorico(){
    const agora = new Date();
    datas = []; risco = []; seguro = [];
    let valR = valorRisco, valS = valorSeguro;
    for(let i=24; i>0; i--){
        const d = new Date(agora.getTime() - i*60*60*1000);
        valR += (Math.random()-0.5)*2;
        valS += (Math.random()-0.5)*1;
        datas.push(d);
        risco.push(valR);
        seguro.push(valS);
    }
}

// Plotar gráfico
function plotGrafico(){
    Plotly.react('grafico', [
        {x: datas, y: risco, mode:'lines+markers', name:'Risco', line:{color:'green'}},
        {x: datas, y: seguro, mode:'lines+markers', name:'Segurança', line:{color:'red'}}
    ], {
        title:'Linha do Tempo Risco x Segurança',
        xaxis:{title:'Data', type:'date'},
        yaxis:{title:'Valor'},
        margin:{t:40,l:50,r:50,b:50},
        legend:{x:1,xanchor:'right',y:1}
    });
}

// Atualizar tabelas
function atualizarTabelas(){
    const tbodyR = document.querySelector("#tabelaRisco tbody");
    tbodyR.innerHTML="";
    ativosRisco.forEach(a=>{
        let variacao = a.variacao?.toFixed(2) ?? 0;
        tbodyR.innerHTML += `<tr>
            <td class="risco">${a.nome}</td>
            <td>${a.valor.toFixed(2)}</td>
            <td class="${variacao>=0?'positivo':'negativo'}">${variacao}%</td>
        </tr>`;
    });
    const tbodyS = document.querySelector("#tabelaSeguro tbody");
    tbodyS.innerHTML="";
    ativosSeguranca.forEach(a=>{
        let variacao = a.variacao?.toFixed(2) ?? 0;
        tbodyS.innerHTML += `<tr>
            <td class="seguro">${a.nome}</td>
            <td>${a.valor.toFixed(2)}</td>
            <td class="${variacao>=0?'positivo':'negativo'}">${variacao}%</td>
        </tr>`;
    });
}

// Atualização automática
function atualizarGrafico(){
    const agora = new Date();
    valorRisco += (Math.random()-0.5)*2;
    valorSeguro += (Math.random()-0.5)*1;
    datas.push(agora);
    risco.push(valorRisco);
    seguro.push(valorSeguro);
    if(datas.length>100) { datas.shift(); risco.shift(); seguro.shift(); }

    // Atualiza ativos simulados
    ativosRisco.forEach(a=>{
        let novo = a.valor + (Math.random()-0.5)*2;
        a.variacao = ((novo - a.valor)/a.valor)*100;
        a.valor = novo;
    });
    ativosSeguranca.forEach(a=>{
        let novo = a.valor + (Math.random()-0.5)*1;
        a.variacao = ((novo - a.valor)/a.valor)*100;
        a.valor = novo;
    });

    plotGrafico();
    atualizarTabelas();
}

// Alterar intervalo
function setTimeframe(segundos, botao){
    timeframe = segundos;
    document.querySelectorAll('#controls button').forEach(b=>b.classList.remove('active'));
    botao.classList.add('active');
    if(timer) clearInterval(timer);
    timer = setInterval(atualizarGrafico, timeframe*1000);
}

// Inicialização
gerarHistorico();
plotGrafico();
atualizarTabelas();
timer = setInterval(atualizarGrafico, timeframe*1000);
window.addEventListener('resize', ()=>{ Plotly.Plots.resize('grafico'); });
</script>

</body>
</html>
