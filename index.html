<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel + Curva Acumulada Intraday</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
<style>
  body {
    font-family: 'Segoe UI', Arial, sans-serif;
    margin: 20px;
    background-color: #f0f2f5;
  }
  .panel {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
  }
  .panel div {
    flex: 1;
    padding: 12px;
    border-radius: 10px;
    background: #fff;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    text-align: center;
  }
  .panel h3 { margin: 0 0 6px; font-size: 16px; }
  .value { font-size: 24px; font-weight: bold; }
  .change { font-size: 14px; }
  #intradayChart {
    width: 1400px;
    height: 600px;
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
  }
</style>
</head>
<body>

<!-- PAINEL DE COTAÇÕES -->
<div class="panel">
  <div id="oilPanel">
    <h3>Petróleo (WTI)</h3>
    <div class="value" id="oilPrice">--</div>
    <div class="change" id="oilChange">--</div>
  </div>
  <div id="dxyPanel">
    <h3>Índice DXY</h3>
    <div class="value" id="dxyPrice">--</div>
    <div class="change" id="dxyChange">--</div>
  </div>
  <div id="ironPanel">
    <h3>Minério de Ferro</h3>
    <div class="value" id="ironPrice">--</div>
    <div class="change" id="ironChange">--</div>
  </div>
</div>

<!-- GRÁFICO INTRADAY -->
<canvas id="intradayChart"></canvas>

<script>
const ctx = document.getElementById('intradayChart').getContext('2d');
const startTime = new Date();

const data = {
    labels: [],
    datasets: [
        {
            label: 'Risco',
            borderColor: 'rgba(255,99,132,1)',
            backgroundColor: ctx.createLinearGradient(0,0,0,600),
            data: [],
            fill: true,
            tension: 0.2,
            pointRadius: 0,
            borderWidth: 2
        },
        {
            label: 'Segurança',
            borderColor: 'rgba(54,162,235,1)',
            backgroundColor: ctx.createLinearGradient(0,0,0,600),
            data: [],
            fill: true,
            tension: 0.2,
            pointRadius: 0,
            borderWidth: 2
        }
    ]
};

// Gradientes
const riscoGradient = ctx.createLinearGradient(0,0,0,600);
riscoGradient.addColorStop(0, 'rgba(255,99,132,0.4)');
riscoGradient.addColorStop(1, 'rgba(255,99,132,0.05)');
data.datasets[0].backgroundColor = riscoGradient;

const segurancaGradient = ctx.createLinearGradient(0,0,0,600);
segurancaGradient.addColorStop(0, 'rgba(54,162,235,0.4)');
segurancaGradient.addColorStop(1, 'rgba(54,162,235,0.05)');
data.datasets[1].backgroundColor = segurancaGradient;

const config = {
    type: 'line',
    data: data,
    options: {
        responsive: false,
        animation: false,
        maintainAspectRatio: false,
        parsing: false,
        normalized: true,
        plugins: {
            legend: { labels: { font: { size: 14 } } },
            tooltip: { mode: 'index', intersect: false },
            zoom: {
                pan: { enabled: true, mode: 'x', modifierKey: 'ctrl' },
                zoom: { wheel: { enabled: true }, pinch: { enabled: true }, mode: 'x' }
            }
        },
        scales: {
            x: {
                title: { display: true, text: 'Tempo desde abertura (HH:MM:SS)' },
                ticks: { maxTicksLimit: 20 },
                grid: { color: 'rgba(0,0,0,0.05)' }
            },
            y: {
                beginAtZero: true,
                max: 100,
                title: { display: true, text: 'Valor' },
                grid: { color: 'rgba(0,0,0,0.05)' }
            }
        }
    },
    plugins: [Chart.registry.getPlugin('zoom')]
};

const intradayChart = new Chart(ctx, config);

// Função para adicionar ponto ao gráfico
function addIntradayData(risco, seguranca) {
    const now = new Date();
    const timeLabel = now.toLocaleTimeString('pt-BR', {hour12:false});
    data.labels.push(timeLabel);
    data.datasets[0].data.push(risco);
    data.datasets[1].data.push(seguranca);

    const maxPoints = 5000;
    if(data.labels.length > maxPoints){
        data.labels.shift();
        data.datasets[0].data.shift();
        data.datasets[1].data.shift();
    }

    intradayChart.update();
}

// Atualização automática a cada 60 segundos
setInterval(() => {
    const risco = Math.floor(Math.random() * 100);
    const seguranca = Math.floor(Math.random() * 100);
    addIntradayData(risco, seguranca);
}, 60000);

// --------------------
// PAINEL DE COTAÇÕES
// --------------------
async function fetchOilData() {
    // Substitua pelo seu endpoint real
    const price = (70 + Math.random()*5).toFixed(2);
    const pct = ((Math.random()*2-1).toFixed(2));
    document.getElementById('oilPrice').innerText = `$${price}`;
    document.getElementById('oilChange').innerText = `${pct}%`;
}

async function fetchDXY() {
    const price = (104 + Math.random()*1.5).toFixed(2);
    const pct = ((Math.random()*0.5-0.25).toFixed(2));
    document.getElementById('dxyPrice').innerText = price;
    document.getElementById('dxyChange').innerText = `${pct}%`;
}

async function fetchIronOre() {
    const price = (130 + Math.random()*5).toFixed(2);
    const pct = ((Math.random()*1.5-0.75).toFixed(2));
    document.getElementById('ironPrice').innerText = price;
    document.getElementById('ironChange').innerText = `${pct}%`;
}

function refreshQuotes() {
    fetchOilData();
    fetchDXY();
    fetchIronOre();
}

// Atualiza a cada 60 segundos
refreshQuotes();
setInterval(refreshQuotes, 60000);
</script>
</body>
</html>
