<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Macro TendÃªncia Dashboard</title>
    <!-- Inclui a biblioteca Chart.js -->
    <script src="https://cdn.jsdelivr.net"></script>
    <!-- Inclui o plugin financeiro do Chart.js para grÃ¡ficos de candlestick/OHLC (opcional, para o grÃ¡fico de linha inferior) -->
    <!-- <script src="https://cdn.jsdelivr.net"></script> -->
    <style>
        .dashboard-container { font-family: sans-serif; padding: 20px; background-color: #f9f9f9; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
        .card-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px; }
        .card { background: white; padding: 15px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .chart-container { height: 200px; margin-top: 10px; }
        .full-width-chart-container { margin-top: 20px; height: 300px; }
        #last-updated { font-weight: bold; color: #007bff; }
    </style>
</head>
<body>

<div class="dashboard-container">
    <div class="header">
        <h1>ğŸ“Š Macro TendÃªncia</h1>
        <div>HistÃ³rico | Online | Sair</div>
    </div>
    <p>Ãšltima atualizaÃ§Ã£o: <span id="last-updated">Conectando...</span></p>

    <div class="card-grid">
        <!-- ForÃ§a da TendÃªncia - DÃ³lar -->
        <div class="card">
            <h2>ğŸ“ˆ ForÃ§a da TendÃªncia - DÃ³lar</h2>
            <div class="chart-container"><canvas id="trendChart"></canvas></div>
        </div>

        <!-- MÃ©tricas de Risco -->
        <div class="card">
            <h2>âš ï¸ MÃ©tricas de Risco</h2>
            <div class="chart-container"><canvas id="riskChart"></canvas></div>
        </div>

        <!-- MÃ©tricas de SeguranÃ§a -->
        <div class="card">
            <h2>ğŸ”’ MÃ©tricas de SeguranÃ§a</h2>
            <div class="chart-container"><canvas id="securityChart"></canvas></div>
        </div>

        <!-- DistribuiÃ§Ã£o de Risco (Pizza) -->
        <div class="card">
            <h2>DistribuiÃ§Ã£o de Risco</h2>
            <div class="chart-container"><canvas id="riskPieChart"></canvas></div>
        </div>

        <!-- DistribuiÃ§Ã£o de SeguranÃ§a (Pizza) -->
        <div class="card">
            <h2>DistribuiÃ§Ã£o de SeguranÃ§a</h2>
            <div class="chart-container"><canvas id="securityPieChart"></canvas></div>
        </div>
        
        <!-- Resumo do PerÃ­odo -->
        <div class="card">
            <h2>Resumo do PerÃ­odo</h2>
            <p><small>Este indicador tem carÃ¡ter exclusivamente informativo e nÃ£o constitui recomendaÃ§Ã£o de compra ou venda de ativos financeiros. As decisÃµes tomadas com base nas informaÃ§Ãµes fornecidas sÃ£o de inteira responsabilidade do usuÃ¡rio.</small></p>
        </div>
    </div>
    
    <!-- GrÃ¡fico de Linhas Full Width -->
    <div class="full-width-chart-container">
        <h2>ForÃ§a da TendÃªncia do DÃ³lar no Mundo (HistÃ³rico)</h2>
        <canvas id="historyChart"></canvas>
    </div>
</div>

<script>
    // --- 1. ConfiguraÃ§Ã£o Inicial dos GrÃ¡ficos (Chart.js) ---
    const trendChartCtx = document.getElementById('trendChart').getContext('2d');
    const riskChartCtx = document.getElementById('riskChart').getContext('2d');
    const securityChartCtx = document.getElementById('securityChart').getContext('2d');
    const riskPieChartCtx = document.getElementById('riskPieChart').getContext('2d');
    const securityPieChartCtx = document.getElementById('securityPieChart').getContext('2d');
    const historyChartCtx = document.getElementById('historyChart').getContext('2d');

    const trendChart = new Chart(trendChartCtx, { type: 'bar', data: { labels: ['Alta', 'Neutra', 'Baixa'], datasets: [{ label: '% de Ativos', data: [0, 0, 0], backgroundColor: ['#28a745', '#ffc107', '#dc3545'] }] }, options: { scales: { y: { beginAtZero: true, max: 100 } } } });
    const riskChart = new Chart(riskChartCtx, { type: 'bar', data: { labels: ['Alta', 'Neutra', 'Baixa'], datasets: [{ label: '% de Risco', data: [0, 0, 0], backgroundColor: ['#dc3545', '#ffc107', '#28a745'] }] }, options: { scales: { y: { beginAtZero: true, max: 100 } } } });
    const securityChart = new Chart(securityChartCtx, { type: 'bar', data: { labels: ['Alta', 'Neutra', 'Baixa'], datasets: [{ label: '% de SeguranÃ§a', data: [0, 0, 0], backgroundColor: ['#28a745', '#ffc107', '#dc3545'] }] }, options: { scales: { y: { beginAtZero: true, max: 100 } } } });
    
    const riskPieChart = new Chart(riskPieChartCtx, { type: 'pie', data: { labels: ['Alta (16)', 'Neutro (4)', 'Baixa (2)'], datasets: [{ data: [16, 4, 2], backgroundColor: ['#dc3545', '#ffc107', '#28a745'] }] } });
    const securityPieChart = new Chart(securityPieChartCtx, { type: 'pie', data: { labels: ['Alta (1)', 'Neutro (3)', 'Baixa (7)'], datasets: [{ data: [1, 3, 7], backgroundColor: ['#28a745', '#ffc107', '#dc3545'] }] } });

    const historyChart = new Chart(historyChartCtx, { type: 'line', data: { labels: [], datasets: [{ label: 'PreÃ§o USD/BRL', borderColor: '#007bff', data: [], fill: false }] }, options: { responsive: true, maintainAspectRatio: false } });

    // --- 2. LÃ³gica de ConexÃ£o em Tempo Real (WebSockets) ---
    // VocÃª PRECISARÃ de um servidor backend rodando e enviando dados para esta URL
    const socket = new WebSocket('ws://localhost:8080'); // Mude para o endereÃ§o do seu servidor!

    socket.addEventListener('open', (event) => {
        console.log('ConexÃ£o WebSocket estabelecida com sucesso!');
        document.getElementById('last-updated').textContent = 'Conectado e aguardando dados...';
    });

    socket.addEventListener('message', (event) => {
        // Assume-se que o servidor envia um objeto JSON com os novos dados
        const data = JSON.parse(event.data); 
        console.log('Dados em tempo real recebidos:', data);

        // Atualiza a hora da Ãºltima atualizaÃ§Ã£o
        document.getElementById('last-updated').textContent = new Date().toLocaleTimeString();

        // Exemplo de como vocÃª atualizaria um grÃ¡fico (Trend Chart)
        if (data.trendData) {
            trendChart.data.datasets[0].data = [data.trendData.alta, data.trendData.neutra, data.trendData.baixa];
            trendChart.update();
        }

        // Exemplo de como vocÃª adicionaria um novo ponto ao grÃ¡fico de histÃ³rico (Linha)
        if (data.historyPoint) {
            historyChart.data.labels.push(new Date().toLocaleTimeString());
            historyChart.data.datasets[0].data.push(data.historyPoint.price);
            // Limita o nÃºmero de pontos visÃ­veis no grÃ¡fico
            if (historyChart.data.labels.length > 50) {
                historyChart.data.labels.shift();
                historyChart.data.datasets[0].data.shift();
            }
            historyChart.update();
        }
    });

    socket.addEventListener('error', (error) => {
        console.error('Erro no WebSocket:', error);
        document.getElementById('last-updated').textContent = 'Erro na conexÃ£o';
    });

    socket.addEventListener('close', (event) => {
        console.log('ConexÃ£o WebSocket fechada. CÃ³digo:', event.code);
        document.getElementById('last-updated').textContent = 'Desconectado';
    });

</script>

</body>
</html>
