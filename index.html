<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard Premium de Not√≠cias Financeiras</title>
<style>
body {
  background:#0e0e0e;
  color:#e0e0e0;
  font-family:Arial, Helvetica, sans-serif;
  margin:20px;
}
h2 { color:#fff; }
.section {
  background:#111;
  padding:15px;
  border-radius:8px;
  margin-bottom:20px;
  max-height: 500px;
  overflow-y: auto;
}
.news-item {
  border-bottom:1px solid #222;
  padding:8px 0;
  transition: all 0.3s;
  position: relative;
}
.news-item:last-child { border-bottom:none; }
.news-item a { color:#03a9f4; text-decoration:none; }
.news-item a:hover { text-decoration:underline; }
.news-title { font-weight:bold; font-size:16px; }
.news-desc { font-size:14px; color:#ccc; }

/* Classes de urg√™ncia */
.urgente-vermelho { background:#b71c1c; color:#fff; padding:5px 8px; border-radius:4px; }
.urgente-laranja { background:#ff6f00; color:#fff; padding:5px 8px; border-radius:4px; }
.urgente-amarelo { background:#fbc02d; color:#000; padding:5px 8px; border-radius:4px; }

/* Pulsar para novas not√≠cias cr√≠ticas */
.pulsar {
  animation: pulse 1s infinite;
}
@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(255,0,0,0.7); }
  70% { box-shadow: 0 0 15px 15px rgba(255,0,0,0); }
  100% { box-shadow: 0 0 0 0 rgba(255,0,0,0); }
}

/* Pulsar especial para Breaking News cr√≠ticas */
.breaking-critica {
  background:#ff1744 !important; /* vermelho mais chamativo */
  color:#fff;
  animation: pulseBreaking 1s infinite;
}
@keyframes pulseBreaking {
  0% { box-shadow: 0 0 0 0 rgba(255,23,68,0.8); }
  50% { box-shadow: 0 0 20px 20px rgba(255,23,68,0); }
  100% { box-shadow: 0 0 0 0 rgba(255,23,68,0); }
}
</style>
</head>
<body>

<h2>üì∞ Not√≠cias de Mercado Financeiro</h2>
<div class="section" id="finance-news">Carregando...</div>

<h2>üö® Breaking News</h2>
<div class="section" id="breaking-news">Carregando...</div>

<script>
// Palavras-chave urgentes e cores
const palavrasUrgentes = [
  {palavra: 'guerra', classe:'urgente-vermelho'},
  {palavra: 'desastre naturais', classe:'urgente-vermelho'},
  {palavra: 'crise', classe:'urgente-laranja'},
  {palavra: 'queda', classe:'urgente-laranja'},
  {palavra: 'fal√™ncia', classe:'urgente-laranja'},
  {palavra: 'volatilidade', classe:'urgente-laranja'},
  {palavra: 'alta', classe:'urgente-amarelo'},
  {palavra: 'poli', classe:'urgente-amarelo'}
];

// Feeds confi√°veis
const feedsFinance = [
  'https://valor.globo.com/rss/mercados/',
  'https://www.infomoney.com.br/feed/'
];
const feedsBreaking = [
  'https://g1.globo.com/rss/g1/ultimas-noticias.rss'
];

// Hist√≥rico local de not√≠cias cr√≠ticas
let noticiasCriticasHistorico = new Set(JSON.parse(localStorage.getItem('noticiasCriticas') || '[]'));

// Limpar HTML
function stripHTML(html){
  const div = document.createElement('div');
  div.innerHTML = html;
  return div.textContent || '';
}

// Busca RSS via AllOrigins
async function buscarRSS(url, max=5){
    try{
        const res = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`);
        const xmlText = await res.text();
        const parser = new DOMParser();
        const xml = parser.parseFromString(xmlText, "text/xml");
        const items = Array.from(xml.querySelectorAll("item")).slice(0, max);
        return items.map(item => ({
            title: item.querySelector("title")?.textContent || "",
            link: item.querySelector("link")?.textContent || "",
            desc: item.querySelector("description")?.textContent || ""
        }));
    }catch(err){
        console.error("Erro RSS:", err);
        return [];
    }
}

// Classe de urg√™ncia
function getUrgencia(article){
    const texto = (article.title + " " + article.desc).toLowerCase();
    for(const p of palavrasUrgentes){
        if(texto.includes(p.palavra.toLowerCase())){
            return p.classe;
        }
    }
    return '';
}

// Valor num√©rico da urg√™ncia
function urgenciaValor(article){
    const classe = getUrgencia(article);
    if(classe === 'urgente-vermelho') return 3;
    if(classe === 'urgente-laranja') return 2;
    if(classe === 'urgente-amarelo') return 1;
    return 0;
}

// Atualiza se√ß√£o de not√≠cias
async function atualizarSecao(feeds, containerId, isBreaking=false){
    const container = document.getElementById(containerId);
    container.innerHTML = 'Carregando...';

    let todasNoticias = [];
    const resultados = await Promise.all(feeds.map(feed => buscarRSS(feed, 5)));
    todasNoticias = resultados.flat();

    todasNoticias.sort((a,b) => urgenciaValor(b) - urgenciaValor(a));

    container.innerHTML = '';
    todasNoticias.forEach(article => {
        const item = document.createElement('div');
        item.className = 'news-item';
        const classeUrgente = getUrgencia(article);

        if(classeUrgente){
            // Para Breaking News cr√≠ticas, use destaque especial
            if(isBreaking && classeUrgente === 'urgente-vermelho'){
                item.classList.add('breaking-critica');
            } else {
                item.classList.add(classeUrgente);
            }

            // Pulsar se not√≠cia nova cr√≠tica
            const idUnique = article.title + article.link;
            if(!noticiasCriticasHistorico.has(idUnique)){
                item.classList.add('pulsar');
                noticiasCriticasHistorico.add(idUnique);
                localStorage.setItem('noticiasCriticas', JSON.stringify([...noticiasCriticasHistorico]));
            }
        }

        item.innerHTML = `
            <div class="news-title"><a href="${article.link}" target="_blank">${article.title}</a></div>
            <div class="news-desc">${stripHTML(article.desc)}</div>
        `;
        container.appendChild(item);
    });

    if(container.innerHTML === '') container.innerHTML = 'Nenhuma not√≠cia no momento.';
}

// Atualiza todas as not√≠cias
async function atualizarNoticias(){
    await atualizarSecao(feedsFinance, 'finance-news');
    await atualizarSecao(feedsBreaking, 'breaking-news', true);
}

// Inicializa e atualiza a cada 60s
atualizarNoticias();
setInterval(atualizarNoticias, 60000);
</script>

</body>
</html>
