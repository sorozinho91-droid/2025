<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Macro Real Global + Brasil | WIN</title>

<style>
body{font-family:Arial;margin:0;background:#f4f6f8;display:flex;flex-direction:column;align-items:center}
header{width:100%;background:#1f2937;color:#fff;text-align:center;padding:10px}
#relogio{margin:10px;font-weight:bold}

.box{width:650px;background:#fff;padding:14px;margin:8px 0;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,.15)}
.verde{border-left:6px solid #16a34a}
.vermelho{border-left:6px solid #dc2626}
.amarelo{border-left:6px solid #ca8a04}

.piscar{animation:pisc 1s infinite}
@keyframes pisc{0%{opacity:1}50%{opacity:.4}100%{opacity:1}}

#sentimentoBarContainer{width:650px;height:30px;background:#e5e7eb;border-radius:6px;overflow:hidden}
#sentimentoBar{height:100%;width:50%;line-height:30px;text-align:center;font-weight:bold;color:#fff;background:linear-gradient(to right, red, green);transition:.4s}

/* BREAKING NEWS INALTERADO */
#painel-news{position:fixed;top:30px;right:10px;width:360px;background:#111827;color:#fff;border-radius:6px;z-index:999}
.news-header{background:#1f2937;padding:8px;text-align:center;font-weight:bold}
#newsList{max-height:260px;overflow-y:auto;font-size:13px}
.news-item{padding:8px;border-bottom:1px solid #374151}
.news-item a{color:#93c5fd;text-decoration:none}
</style>
</head>

<body>

<header><h2>Dire√ß√£o Macro Real | Mini √çndice (WIN)</h2></header>
<div id="relogio"></div>

<div id="macroTrend" class="box">üß≠ Calculando tend√™ncia macro...</div>
<div id="macroScalp" class="box">‚ö° Calculando scalp macro...</div>

<div id="sentimentoBarContainer">
  <div id="sentimentoBar">Aguardando...</div>
</div>

<!-- BREAKING NEWS -->
<div id="painel-news">
  <div class="news-header">üö® BREAKING NEWS ‚Äì Macro</div>
  <div id="newsList"><div class="news-item">Aguardando not√≠cias...</div></div>
</div>

<audio id="alerta-trend" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>
<audio id="alerta-scalp" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
// ===== REL√ìGIO BR =====
setInterval(()=>{
 const d=new Date(),u=d.getTime()+d.getTimezoneOffset()*60000;
 document.getElementById("relogio").innerText=
 "Hor√°rio de Bras√≠lia: "+new Date(u-3*3600000).toLocaleTimeString("pt-BR");
},1000);

// ===== ATIVOS REAIS (TradingView proxy p√∫blico) =====
const ativosRiskOn=[
 "INDEX:SPX","INDEX:NDX","INDEX:DJI","INDEX:DAX",
 "INDEX:N225","NYMEX:CL1!","COMEX:HG1!"
];
const ativosRiskOff=[
 "CBOE:VIX","FOREXCOM:DX1!","COMEX:GC1!",
 "CURRENCY:US10Y","FOREXCOM:JPYUSD"
];

async function preco(symbol){
 try{
  const r=await fetch("https://api.allorigins.win/raw?url=https://s3.tradingview.com/symbols/"+symbol.replace(":","_")+".json");
  const j=await r.json();
  return j.last_price||j.close||0;
 }catch{ return 0 }
}

let histTrend=[],histScalp=[];
let estadoTrend="",estadoScalp="";

async function atualizar(){
 let risk=0,off=0;

 for(const a of ativosRiskOn) risk+=await preco(a);
 for(const a of ativosRiskOff) off+=await preco(a);

 const diff=risk-off;

 histTrend.push(diff);
 histScalp.push(diff);

 if(histTrend.length>8) histTrend.shift();
 if(histScalp.length>3) histScalp.shift();

 analisar();
}

function analisar(){
 const t=histTrend.reduce((a,b)=>a+b,0)/histTrend.length;
 const s=histScalp.reduce((a,b)=>a+b,0)/histScalp.length;

 // TEND√äNCIA
 let nt="NEUTRO";
 if(t>0) nt="ALTA";
 if(t<0) nt="BAIXA";

 if(nt!==estadoTrend && estadoTrend!==""){
  document.getElementById("alerta-trend").play().catch(()=>{});
  macroTrend.classList.add("piscar");
  setTimeout(()=>macroTrend.classList.remove("piscar"),12000);
 }
 estadoTrend=nt;

 macroTrend.className="box "+(nt==="ALTA"?"verde":nt==="BAIXA"?"vermelho":"amarelo");
 macroTrend.innerHTML=`üß≠ <b>TEND√äNCIA</b><br>${nt==="ALTA"?"üìà Priorizar compra":nt==="BAIXA"?"üìâ Priorizar venda":"‚ö†Ô∏è Lateral"}`;

 // SCALP
 let ns="NEUTRO";
 if(s>0) ns="ALTA";
 if(s<0) ns="BAIXA";

 if(ns!==estadoScalp && estadoScalp!==""){
  document.getElementById("alerta-scalp").play().catch(()=>{});
  macroScalp.classList.add("piscar");
  setTimeout(()=>macroScalp.classList.remove("piscar"),8000);
 }
 estadoScalp=ns;

 macroScalp.className="box "+(ns==="ALTA"?"verde":ns==="BAIXA"?"vermelho":"amarelo");
 macroScalp.innerHTML=`‚ö° <b>SCALP</b><br>${ns==="ALTA"?"üìà Compra r√°pida":ns==="BAIXA"?"üìâ Venda r√°pida":"‚ö†Ô∏è Ru√≠do"}`;

 const bar=document.getElementById("sentimentoBar");
 bar.style.width=nt==="ALTA"?"80%":nt==="BAIXA"?"20%":"50%";
 bar.innerText=nt;
}

setInterval(atualizar,60000);
atualizar();
</script>

</body>
</html>
