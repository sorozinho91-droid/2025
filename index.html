<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Diagnóstico Financeiro Real</title>
    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; }
        .dashboard-container { max-width: 800px; margin: auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        header h1 { text-align: left; color: #000; border-bottom: 2px solid #eee; padding-bottom: 10px; font-size: 1.2rem; }
        .indicator-grid { display: flex; gap: 20px; }
        .indicator-section { flex: 1; padding: 15px; border-radius: 5px; background-color: #fafafa; }
        .indicator-section h2 { font-size: 1.1rem; font-weight: 700; }
        .value { font-size: 1.5rem; font-weight: bold; margin-top: 5px; }
        .change { font-size: 0.9rem; margin-top: 5px; }
        .positive { color: green; }
        .negative { color: red; }
        .neutral { color: gray; }
        #diagnostico-consolidado { margin-top: 20px; padding: 15px; border-radius: 5px; font-weight: bold; }
        /* Responsividade básica */
        @media (max-width: 600px) { .indicator-grid { flex-direction: column; } }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header>
            <h1>PAINEL DE INDICADORES - DIAGNÓSTICO DO MOMENTO</h1>
        </header>

        <main class="indicator-grid">
            <!-- Indicador Ibovespa -->
            <section class="indicator-section">
                <h2>Ibovespa (^BVSP)</h2>
                <div class="value" id="ibov-value">Buscando...</div>
                <div class="change" id="ibov-change"></div>
            </section>
            <!-- Indicador Dólar -->
            <section class="indicator-section">
                <h2>Dólar (USD/BRL)</h2>
                <div class="value" id="usd-value">Buscando...</div>
                <div class="change" id="usd-change"></div>
            </section>
        </main>

        <!-- Diagnóstico Consolidado -->
        <div id="diagnostico-consolidado">Aguardando dados para diagnóstico...</div>
    </div>

    <script>
        // Use a API pública brapi para dados financeiros (fonte confiável)
        const API_IBOV = 'https://brapi.dev/api/quote/^BVSP';
        const API_USD = 'brapi.dev';

        async function fetchData() {
            try {
                // Fetch Ibovespa
                const resIbov = await fetch(API_IBOV);
                const dataIbov = await resIbov.json();
                const ibov = dataIbov.results[0];

                // Fetch Dólar
                const resUsd = await fetch(API_USD);
                const dataUsd = await resUsd.json();
                const usd = dataUsd.currencies.find(item => item.currency === 'USD');

                // Atualizar HTML
                updateIndicator('ibov', ibov.regularMarketPrice.toFixed(0), ibov.changePercent.toFixed(2));
                updateIndicator('usd', usd.buy.toFixed(4), usd.variation.toFixed(2));

                // Gerar Diagnóstico
                generateDiagnostic(ibov.changePercent, usd.variation);

            } catch (error) {
                console.error('Erro ao buscar dados:', error);
                document.getElementById('diagnostico-consolidado').textContent = 'Erro ao carregar dados financeiros. Tente novamente mais tarde.';
                document.getElementById('diagnostico-consolidado').className = 'negative';
            }
        }

        function updateIndicator(id, value, change) {
            document.getElementById(id + '-value').textContent = (id === 'usd' ? 'R$ ' : '') + value;
            document.getElementById(id + '-change').textContent = change + '%';
            
            const changeElement = document.getElementById(id + '-change');
            if (change > 0) { changeElement.className = 'change positive'; }
            else if (change < 0) { changeElement.className = 'change negative'; }
            else { changeElement.className = 'change neutral'; }
        }

        function generateDiagnostic(ibovChange, usdChange) {
            const diagnosticElement = document.getElementById('diagnostico-consolidado');
            let message = '';
            let className = '';

            // Lógica de diagnóstico:
            if (ibovChange > 0.5 && usdChange < -0.5) {
                message = 'Momento **Positivo**: Ibovespa em forte alta e Dólar em queda. Fatores positivos prevalecem.';
                className = 'positive';
            } else if (ibovChange < -0.5 && usdChange > 0.5) {
                message = 'Momento **Negativo**: Ibovespa em forte queda e Dólar em alta. Fatores externos e internos pressionam.';
                className = 'negative';
            } else {
                message = 'Momento **Neutro/Misto**: Indicadores mostram movimentos moderados ou conflitantes. Depende do contexto global e local.';
                className = 'neutral';
            }
            
            diagnosticElement.innerHTML = message;
            diagnosticElement.className = className;
        }

        // Chama a função ao carregar a página e a cada minuto
        fetchData();
        setInterval(fetchData, 60000); 
    </script>
</body>
</html>
