<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard Completo</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f4f6f8; }
header { background:#1f2937; color:white; padding:15px; text-align:center; }
#controls, #compareDates { text-align:center; padding:10px; }
button { margin:5px; padding:8px 16px; border:none; border-radius:4px; cursor:pointer; background:#e5e7eb; }
button.active { background:#2563eb; color:white; }
#grafico { width:95%; height:500px; margin:20px auto; background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
table { width:95%; margin:20px auto; border-collapse: collapse; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.05);}
th, td { padding:8px; border:1px solid #ccc; text-align:center; font-size:14px;}
thead th { background:#2563eb; color:white;}
.risco { color:green; }
.seguro { color:red; }
.positivo { color:green; }
.negativo { color:red; }

/* BREAKING NEWS */
#painel-news{position:fixed;top:30px;right:10px;width:360px;background:#111827;color:white;border-radius:6px;box-shadow:0 4px 8px rgba(0,0,0,0.3);z-index:9998;}
.news-header{text-align:center;font-weight:bold;padding:8px;background:#1f2937;border-radius:6px 6px 0 0;}
#newsList{max-height:260px;overflow-y:auto;font-size:13px;}
.news-item{padding:8px;border-bottom:1px solid #374151;}
.news-item a{color:#93c5fd;text-decoration:none;}
.breaking{animation:piscar 1s infinite;}
@keyframes piscar{0%{background:#7f1d1d;}50%{background:#dc2626;}100%{background:#7f1d1d;}}

/* ALERTA POL√çTICO */
#alerta-mercado {position:fixed;top:300px;left:8px;width:280px;background:#fff;border-left:5px solid #c00000;box-shadow:0 2px 8px rgba(0,0,0,0.2);font-family:Arial,sans-serif;font-size:12px;z-index:9999;}
.alerta-header{background:#c00000;color:#fff;font-weight:bold;text-align:center;padding:6px;font-size:11px;}
#alerta-conteudo{padding:8px;line-height:1.3;}
.piscar{animation:pisca 1s infinite;}
@keyframes pisca{0%{background:#fff;}50%{background:#ffe5e5;}100%{background:#fff;}}
</style>
</head>
<body>

<!-- Cota√ß√µes TradingView -->
<div id="painel-cotacoes-topo" style="height:28px;">
<script src="https://s3.tradingview.com/external-embedding/embed-widget-tickers.js">
{
  "symbols":[{"title":"Brent","proName":"ICE:BRN1!"},{"title":"WTI","proName":"NYMEX:CL1!"},{"title":"DXY","proName":"FOREXCOM:DX1!"},{"title":"S&P 500","proName":"INDEX:SPX"},{"title":"Dow Jones","proName":"INDEX:DJI"}],
  "colorTheme":"light","isTransparent":true,"showSymbolLogo":false,"locale":"pt","width":"100%","height":"28"
}
</script>
</div>

<header><h2>Risco x Seguran√ßa ‚Äì Linha do Tempo (Tempo Real)</h2></header>

<div id="controls">
<button onclick="setTimeframe(60,this)" class="active">60s</button>
<button onclick="setTimeframe(1,this)">1m</button>
<button onclick="setTimeframe(5,this)">5m</button>
</div>

<div id="compareDates">
<label>In√≠cio: <input type="datetime-local" id="startDate"></label>
<label>Fim: <input type="datetime-local" id="endDate"></label>
<button onclick="filtrarPorData()">Comparar</button>
<button onclick="resetGrafico()">Resetar</button>
</div>

<!-- Gr√°fico -->
<div id="grafico"></div>

<!-- Tabelas -->
<table id="tabelaRisco">
<thead><tr><th>Ativo de Risco</th><th>Valor Atual</th><th>Varia√ß√£o (%)</th></tr></thead>
<tbody></tbody>
</table>

<table id="tabelaSeguro">
<thead><tr><th>Ativo de Seguran√ßa</th><th>Valor Atual</th><th>Varia√ß√£o (%)</th></tr></thead>
<tbody></tbody>
</table>

<!-- BREAKING NEWS -->
<div id="painel-news">
  <div class="news-header">üö® BREAKING NEWS ‚Äì Macro</div>
  <div id="newsList"><div id="aguardando" class="news-item">Aguardando not√≠cias...</div></div>
</div>
<audio id="alertSound"><source src="https://assets.mixkit.co/sfx/preview/mixkit-alert-alarm-1005.mp3" type="audio/mpeg"></audio>

<!-- ALERTA POL√çTICO -->
<div id="alerta-mercado"><div class="alerta-header">‚ö†Ô∏è ALERTA MERCADO</div><div id="alerta-conteudo">Aguardando not√≠cias...</div></div>
<audio id="alerta-som"><source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg"></audio>

<script>
// ==== GRAFICO ====
let datas=[], risco=[], seguro=[], valorRisco=100, valorSeguro=100, timer=null;
let filtered=false, filteredStart, filteredEnd, timeframe=60;
let ativosRisco=[{nome:"Ouro Futuros",valor:2766.2},{nome:"Cobre Futuros",valor:4.2315},{nome:"Petr√≥leo WTI",valor:73.17}];
let ativosSeguranca=[{nome:"DXY - √çndice D√≥lar",valor:107.16},{nome:"EUR/BRL",valor:6.1843},{nome:"S&P 500 VIX Futuros",valor:17.61}];

function agoraBR(){return new Date(new Date().toLocaleString("pt-BR",{timeZone:"America/Sao_Paulo"}));}
function gerarHistorico(){let agora=agoraBR(); datas=[]; risco=[]; seguro=[]; let valR=valorRisco; let valS=valorSeguro;
for(let d=new Date(agora.getTime()-30*24*60*60*1000); d<=agora; d.setHours(d.getHours()+1)){valR+=(Math.random()-0.5)*2; valS+=(Math.random()-0.5)*1; datas.push(new Date(d)); risco.push(valR); seguro.push(valS);}}

function plotGrafico(x,yR,yS){Plotly.react('grafico',[{x:x,y:yR,mode:'lines+markers',name:'Risco',line:{color:'green'}},{x:x,y:yS,mode:'lines+markers',name:'Seguran√ßa',line:{color:'red'}}],{title:'Linha do Tempo Risco x Seguran√ßa',xaxis:{title:'Data',type:'date'},yaxis:{title:'Valor'},margin:{t:40,l:50,r:50,b:50},legend:{x:1,xanchor:'right',y:1}});}

function atualizarTabelas(){const tbodyR=document.querySelector("#tabelaRisco tbody"); tbodyR.innerHTML=""; ativosRisco.forEach(a=>{let variacao=a.variacao?.toFixed(2)??0; let tr=document.createElement("tr"); tr.innerHTML=`<td class="risco">${a.nome}</td><td>${a.valor.toFixed(2)}</td><td class="${variacao>=0?'positivo':'negativo'}">${variacao}%</td>`; tbodyR.appendChild(tr);}); const tbodyS=document.querySelector("#tabelaSeguro tbody"); tbodyS.innerHTML=""; ativosSeguranca.forEach(a=>{let variacao=a.variacao?.toFixed(2)??0; let tr=document.createElement("tr"); tr.innerHTML=`<td class="seguro">${a.nome}</td><td>${a.valor.toFixed(2)}</td><td class="${variacao>=0?'positivo':'negativo'}">${variacao}%</td>`; tbodyS.appendChild(tr);});}

function atualizarGrafico(){
  const agora=agoraBR(); valorRisco+=(Math.random()-0.5)*2; valorSeguro+=(Math.random()-0.5)*1;
  datas.push(agora); risco.push(valorRisco); seguro.push(valorSeguro);
  if(datas.length>1000){datas.shift(); risco.shift(); seguro.shift();}
  let x=[],yR=[],yS=[]; if(filtered){for(let i=0;i<datas.length;i++){if(datas[i]>=filteredStart && datas[i]<=filteredEnd){x.push(datas[i]);yR.push(risco[i]);yS.push(seguro[i]);}}} else {x=datas; yR=risco; yS=seguro;}
  plotGrafico(x,yR,yS);
  ativosRisco.forEach(a=>{let novo=a.valor+(Math.random()-0.5)*2;a.variacao=((novo-a.valor)/a.valor)*100;a.valor=novo;});
  ativosSeguranca.forEach(a=>{let novo=a.valor+(Math.random()-0.5)*1;a.variacao=((novo-a.valor)/a.valor)*100;a.valor=novo;});
  atualizarTabelas();
}

function filtrarPorData(){filteredStart=new Date(document.getElementById('startDate').value); filteredEnd=new Date(document.getElementById('endDate').value); if(isNaN(filteredStart)||isNaN(filteredEnd)){alert("Selecione datas v√°lidas");return;} if(filteredStart>filteredEnd){alert("A data de in√≠cio deve ser anterior √† data de fim.");return;} filtered=true; atualizarGrafico();}
function resetGrafico(){filtered=false; plotGrafico(datas,risco,seguro);}
function setTimeframe(segundos,botao){timeframe=segundos; document.querySelectorAll('#controls button').forEach(b=>b.classList.remove('active')); botao.classList.add('active'); if(timer) clearInterval(timer); timer=setInterval(atualizarGrafico,timeframe*1000);}

gerarHistorico(); plotGrafico(datas,risco,seguro); atualizarTabelas(); timer=setInterval(atualizarGrafico,timeframe*1000); window.addEventListener('resize',()=>Plotly.Plots.resize('grafico'));

// ===== BREAKING NEWS =====
const palavras=["fed","cpi","juros","taxa","guerra","war","infla√ß√£o","inflation","banco central","central bank"];
const lista=document.getElementById("newsList"); const painel=document.getElementById("painel-news"); const header=document.querySelector(".news-header"); const som=document.getElementById("alertSound");
let cache={}, alertaAtivo=false;
async function buscarNoticias(){const query=palavras.join(" OR "); const rss="https://news.google.com/rss/search?q="+encodeURIComponent(query)+"&hl=pt-BR&gl=BR&ceid=BR:pt"; const url="https://api.allorigins.win/raw?url="+encodeURIComponent(rss);
try{const res=await fetch(url); const text=await res.text(); const xml=new DOMParser().parseFromString(text,"text/xml"); const items=xml.querySelectorAll("item");
items.forEach(item=>{const titulo=item.querySelector("title")?.textContent||""; const link=item.querySelector("link")?.textContent||""; if(!titulo||cache[link]) return; if(!palavras.some(p=>titulo.toLowerCase().includes(p))) return; cache[link]=true; document.getElementById("aguardando")?.remove();
const div=document.createElement("div"); div.className="news-item"; div.innerHTML=`<strong>üö® ${titulo}</strong><br><a href="${link}" target="_blank">Ler not√≠cia</a>`; lista.prepend(div);
if(!alertaAtivo){alertaAtivo=true; painel.classList.add("breaking"); header.classList.add("breaking"); som.play().catch(()=>{}); setTimeout(()=>{painel.classList.remove("breaking"); header.classList.remove("breaking"); alertaAtivo=false;},12000);}});}catch(e){console.error("Erro news:",e);}}
buscarNoticias(); setInterval(buscarNoticias,30000);

// ===== ALERTA POL√çTICO =====
const alertaConteudo=document.getElementById("alerta-conteudo"); const alertaBox=document.getElementById("alerta-mercado"); const somAlerta=document.getElementById("alerta-som");
const rssUrl="https://news.google.com/rss/search?q=presidente+EUA+OR+presidente+Brasil+juros+mercado+financeiro&hl=pt-BR&gl=BR&ceid=BR:pt";
const proxy="https://api.allorigins.win/raw?url="; let ultimaNoticia="";
async function buscarAlertas(){try{const res=await fetch(proxy+encodeURIComponent(rssUrl)); const texto=await res.text(); const xml=new DOMParser().parseFromString(texto,"text/xml"); const item=xml.querySelector("item"); if(!item) return;
const titulo=item.querySelector("title").textContent; const link=item.querySelector("link").textContent; if(titulo!==ultimaNoticia){ultimaNoticia=titulo; alertaConteudo.innerHTML='üì∞ <a href="'+link+'" target="_blank" style="color:#000;text-decoration:none;">'+titulo+'</a>'; alertaBox.classList.add("piscar"); somAlerta.play().catch(()=>{}); setTimeout(()=>alertaBox.classList.remove("piscar"),15000);}}catch(e){console.log("Erro ao buscar alertas");}}
buscarAlertas(); setInterval(buscarAlertas,60000);
</script>

</body>
</html>
