<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Dashboard com Controle de Velocidade</title>

    <!-- IMPORTANTE: Plotly -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

<div style="margin-bottom:10px;">
    <label>
        Velocidade do gr√°fico:
        <input
            type="range"
            id="velocidade"
            min="1000"
            max="6000"
            step="500"
            value="2000"
        >
        <span id="velocidadeValor">2.0s</span>
    </label>
</div>

<!-- DIV DO GR√ÅFICO (OBRIGAT√ìRIO) -->
<div id="grafico" style="width:100%;height:400px;"></div>

<script>
let valorRisco = 100;
let valorSeguro = 100;
let intervalo = 2000;
let timer;

function atualizar(valor) {
    return Math.max(0, valor + (Math.random() - 0.5) * 2);
}

const traceRisco = {
    x: [],
    y: [],
    type: 'scatter',
    mode: 'lines',
    name: 'üî¥ Risco',
    line: { color: 'red', width: 2 }
};

const traceSeguro = {
    x: [],
    y: [],
    type: 'scatter',
    mode: 'lines',
    name: 'üü¢ Seguran√ßa',
    line: { color: 'green', width: 2 }
};

const layout = {
    xaxis: { title: 'Tempo' },
    yaxis: { title: 'Valor' },
    transition: {
        duration: 800,
        easing: 'linear'
    }
};

Plotly.newPlot('grafico', [traceRisco, traceSeguro], layout);

function iniciarGrafico() {
    clearInterval(timer);

    timer = setInterval(() => {
        const agora = new Date().toLocaleTimeString();

        valorRisco = atualizar(valorRisco);
        valorSeguro = atualizar(valorSeguro);

        Plotly.extendTraces(
            'grafico',
            {
                x: [[agora], [agora]],
                y: [[valorRisco], [valorSeguro]]
            },
            [0, 1],
            30
        );
    }, intervalo);
}

// Slider
const slider = document.getElementById('velocidade');
const texto = document.getElementById('velocidadeValor');

slider.addEventListener('input', () => {
    intervalo = Number(slider.value);
    texto.textContent = (intervalo / 1000).toFixed(1) + 's';
    iniciarGrafico();
});

iniciarGrafico();
</script>

</body>
</html>
