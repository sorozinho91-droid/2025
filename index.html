<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dire√ß√£o Macro ‚Äì Mini √çndice (WIN)</title>
<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#f3f4f6;
}
header{
  background:#111827;
  color:#fff;
  padding:10px;
  text-align:center;
  font-size:18px;
  font-weight:bold;
}

/* REL√ìGIO NO TOPO */
#relogio{
  text-align:center;
  font-size:18px;
  font-weight:bold;
  padding:6px;
  margin-bottom:10px;
  color:#fff;
  background:#1f2937;
  border-radius:6px;
}

/* LAYOUT PRINCIPAL */
#layout{
  display:flex;
  justify-content:center;
  gap:15px;
  padding:10px;
}

/* TABELA CENTRAL */
#macro{
  width:420px;
  background:#fff;
  border-radius:8px;
  box-shadow:0 2px 8px rgba(0,0,0,.15);
  padding:12px;
  text-align:center;
}
#direcao{
  font-size:22px;
  font-weight:bold;
  padding:12px;
  margin-top:10px;
  border-radius:6px;
  transition: background 0.5s, color 0.5s;
}
#iconeDirecao svg{
  width:60px;
  height:60px;
  margin-top:10px;
  transition: transform 0.5s;
}
.pulsar{
  animation: pulseZoom 0.8s ease;
}
@keyframes pulseZoom{
  0% {transform: scale(1);}
  50% {transform: scale(1.5);}
  100% {transform: scale(1);}
}

/* PAINEL DIREITO */
#painel-direito{
  width:360px;
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* BREAKING NEWS */
#breaking{
  background:#111827;
  color:#fff;
  border-radius:6px;
  box-shadow:0 2px 8px rgba(0,0,0,.25);
}
.breaking-header{
  background:#7f1d1d;
  padding:8px;
  font-weight:bold;
  text-align:center;
}
#breaking-list{
  max-height:220px;
  overflow-y:auto;
  font-size:13px;
}
.breaking-item{
  padding:8px;
  border-bottom:1px solid #374151;
}
.breaking-item a{
  color:#93c5fd;
  text-decoration:none;
}

/* NOT√çCIAS MERCADO */
#mercado{
  background:#ffffff;
  border-radius:6px;
  box-shadow:0 2px 8px rgba(0,0,0,.2);
}
.mercado-header{
  background:#1f2937;
  color:#fff;
  padding:8px;
  font-weight:bold;
  text-align:center;
}
#mercado-list{
  max-height:220px;
  overflow-y:auto;
  font-size:13px;
}
.mercado-item{
  padding:8px;
  border-bottom:1px solid #e5e7eb;
}
.mercado-item a{
  color:#1d4ed8;
  text-decoration:none;
}

/* ALERTA VISUAL */
.alerta-contrario{
  animation:pulse 1s infinite;
}
@keyframes pulse{
  0%{background:#fee2e2;}
  50%{background:#fecaca;}
  100%{background:#fee2e2;}
}
</style>
</head>
<body>

<header>üìä Dire√ß√£o Macro do Mercado ‚Äì Mini √çndice (WIN)</header>
<div id="relogio">‚è∞ --:--:--</div>

<div id="layout">
  <!-- TABELA CENTRAL -->
  <div id="macro">
    <div id="direcao" data-macro="NEUTRO">üü° NEUTRO</div>
    <div id="iconeDirecao"></div>
  </div>

  <!-- PAINEL DIREITO -->
  <div id="painel-direito">
    <div id="mercado">
      <div class="mercado-header">üì∞ Not√≠cias de Mercado</div>
      <div id="mercado-list">
        <div class="mercado-item">Aguardando not√≠cias...</div>
      </div>
    </div>
    <div id="breaking">
      <div class="breaking-header">üö® BREAKING NEWS</div>
      <div id="breaking-list">
        <div class="breaking-item">Aguardando not√≠cias...</div>
      </div>
    </div>
  </div>
</div>

<audio id="somAlerta" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
// SVGs Touro e Urso
const svgTouro = `<svg viewBox="0 0 64 64" fill="#16a34a"><path d="M32 2l6 12 12 2-9 9 2 12-11-6-11 6 2-12-9-9 12-2z"/></svg>`;
const svgUrso  = `<svg viewBox="0 0 64 64" fill="#dc2626"><path d="M32 2l-6 12-12 2 9 9-2 12 11-6 11 6-2-12 9-9-12-2z"/></svg>`;

// FUN√á√ÉO REL√ìGIO BRAS√çLIA
function atualizarRelogio(){
  const agora = new Date();
  const utc = agora.getTime() + agora.getTimezoneOffset()*60000;
  const br = new Date(utc - 3*3600000);
  document.getElementById("relogio").innerHTML = "‚è∞ Hor√°rio de Bras√≠lia: " + br.toLocaleTimeString("pt-BR");
}
setInterval(atualizarRelogio,1000);
atualizarRelogio();

// ATUALIZA DIRE√á√ÉO
function atualizarDirecao(){
  const bloco = document.getElementById("direcao");
  const icone = document.getElementById("iconeDirecao");
  const direcao = bloco.dataset.macro;
  icone.innerHTML = "";
  if(direcao==="ALTA"){
    bloco.style.background="#dcfce7";
    bloco.style.color="#065f46";
    bloco.innerHTML = "üü¢ ALTA - Priorizar COMPRAS";
    icone.innerHTML = `<span class="pulsar">${svgTouro}</span>`;
  } else if(direcao==="BAIXA"){
    bloco.style.background="#fee2e2";
    bloco.style.color="#7f1d1d";
    bloco.innerHTML = "üî¥ BAIXA - Priorizar VENDAS";
    icone.innerHTML = `<span class="pulsar">${svgUrso}</span>`;
  } else{
    bloco.style.background="#fef9c3";
    bloco.style.color="#78350f";
    bloco.innerHTML = "üü° NEUTRO";
  }
}

// FUN√á√ÉO PARA BUSCAR DIRE√á√ÉO AUTOM√ÅTICA DO MINI √çNDICE
async function atualizarDirecaoMini(){
  const chave = "d58a789r01qptoar8c7gd58a789r01qptoar8c80";
  const url = `https://api.hgbrasil.com/finance/quote?key=${chave}&symbol=WIN`;
  try{
    const res = await fetch(url);
    const data = await res.json();
    const price = data.results.WIN.price;
    const open  = data.results.WIN.open_price;
    let direcao;
    if(price > open) direcao="ALTA";
    else if(price < open) direcao="BAIXA";
    else direcao="NEUTRO";
    document.getElementById("direcao").dataset.macro = direcao;
    atualizarDirecao();
  }catch(err){
    console.log("Erro ao buscar dados do Mini √çndice:", err);
  }
}
atualizarDirecaoMini();
setInterval(atualizarDirecaoMini,5000);

// BREAKING NEWS
const negativas = ["queda","crise","guerra","juros","alta de juros","inflation","recess√£o","risco"];
const breakingList = document.getElementById("breaking-list");
const som = document.getElementById("somAlerta");

async function buscarBreaking(){
  const rss="https://news.google.com/rss/search?q=fed+OR+juros+OR+guerra+OR+infla√ß√£o&hl=pt-BR&gl=BR&ceid=BR:pt";
  const url="https://api.allorigins.win/raw?url="+encodeURIComponent(rss);
  const res = await fetch(url);
  const text = await res.text();
  const xml = new DOMParser().parseFromString(text,"text/xml");
  const items = xml.querySelectorAll("item");
  breakingList.innerHTML="";
  items.forEach((item,i)=>{
    if(i>4) return;
    const titulo=item.querySelector("title").textContent;
    const link=item.querySelector("link").textContent;
    const div=document.createElement("div");
    div.className="breaking-item";
    div.innerHTML=`<strong>${titulo}</strong><br><a href="${link}" target="_blank">Ler</a>`;
    breakingList.appendChild(div);
    const macro = document.getElementById("direcao").dataset.macro;
    if(macro!=="NEUTRO" && negativas.some(p=>titulo.toLowerCase().includes(p))){
      document.getElementById("breaking").classList.add("alerta-contrario");
      som.play().catch(()=>{});
      setTimeout(()=>{document.getElementById("breaking").classList.remove("alerta-contrario");},15000);
    }
  });
}
buscarBreaking();
setInterval(buscarBreaking,30000);

// NOT√çCIAS MERCADO
const mercadoList = document.getElementById("mercado-list");
async function buscarMercado(){
  const rss="https://news.google.com/rss/search?q=mercado+financeiro+OR+b3+OR+economia+brasil&hl=pt-BR&gl=BR&ceid=BR:pt";
  const url="https://api.allorigins.win/raw?url="+encodeURIComponent(rss);
  const res = await fetch(url);
  const text = await res.text();
  const xml = new DOMParser().parseFromString(text,"text/xml");
  const items = xml.querySelectorAll("item");
  mercadoList.innerHTML="";
  items.forEach((item,i)=>{
    if(i>4) return;
    const t=item.querySelector("title").textContent;
    const l=item.querySelector("link").textContent;
    const div=document.createElement("div");
    div.className="mercado-item";
    div.innerHTML=`${t}<br><a href="${l}" target="_blank">Ler</a>`;
    mercadoList.appendChild(div);
  });
}
buscarMercado();
setInterval(buscarMercado,60000);
</script>

</body>
</html>
