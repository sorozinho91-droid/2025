<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Diagnóstico Financeiro Real - Commodities</title>
    <!-- Inclui a biblioteca Chart.js via CDN -->
    <script src="cdn.jsdelivr.net"></script>
    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; }
        .dashboard-container { max-width: 1200px; margin: auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        header h1 { text-align: left; color: #000; border-bottom: 2px solid #eee; padding-bottom: 10px; font-size: 1.2rem; }
        .indicator-grid { display: flex; gap: 20px; flex-wrap: wrap; }
        .indicator-section { flex: 1; min-width: 200px; padding: 15px; border-radius: 5px; background-color: #fafafa; }
        .chart-container { flex: 2; min-width: 400px; padding: 15px; background-color: #fafafa; border-radius: 5px; }
        .value { font-size: 1.5rem; font-weight: bold; margin-top: 5px; }
        .change { font-size: 0.9rem; margin-top: 5px; }
        .positive { color: green; }
        .negative { color: red; }
        .neutral { color: gray; }
        #diagnostico-consolidado { margin-top: 20px; padding: 15px; border-radius: 5px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header>
            <h1>PAINEL DE INDICADORES - DIAGNÓSTICO DO MOMENTO</h1>
        </header>

        <main class="indicator-grid">
            <section class="indicator-section"><h2>Ibovespa (^BVSP)</h2><div class="value" id="ibov-value">Buscando...</div><div class="change" id="ibov-change"></div></section>
            <section class="indicator-section"><h2>Dólar (USD/BRL)</h2><div class="value" id="usd-value">Buscando...</div><div class="change" id="usd-change"></div></section>
            <section class="indicator-section"><h2>Petróleo Brent</h2><div class="value" id="brent-value">Chave API?</div><div class="change" id="brent-change"></div></section>
            <section class="indicator-section"><h2>Minério de Ferro</h2><div class="value" id="iron-value">Chave API?</div><div class="change" id="iron-change"></div></section>
            <section class="chart-container"><h2>IPCA (Acumulado 12m)</h2><canvas id="ipcaChart"></canvas></section>
            <section class="chart-container"><h2>Selic (Meta a.a.)</h2><canvas id="selicChart"></canvas></section>
        </main>
        <div id="diagnostico-consolidado">Aguardando dados para diagnóstico...</div>
    </div>

    <script>
        const API_IBOV = 'brapi.dev^BVSP';
        const API_USD = 'brapi.dev';
        const API_IPCA_HIST = 'api.bcb.gov.br';
        const API_SELIC_HIST = 'api.bcb.gov.br';
        
        // !!! IMPORTANTE: Insira sua chave de API de commodities aqui. Ex: da Financial Modeling Prep
        const COMMODITIES_API_KEY = 'SUA_CHAVE_DE_API_AQUI'; 

        async function fetchData() {
            try {
                const [resIbov, resUsd, resIpca, resSelic] = await Promise.all([
                    fetch(API_IBOV), fetch(API_USD), fetch(API_IPCA_HIST), fetch(API_SELIC_HIST)
                ]);
                const dataIbov = await resIbov.json();
                const dataUsd = await resUsd.json();
                const dataIpca = await resIpca.json();
                const dataSelic = await resSelic.json();

                const ibov = dataIbov.results;
                const usd = dataUsd.currencies.find(item => item.currency === 'USD');
                const ultimoIpca = parseFloat(dataIpca[dataIpca.length - 1].valor);
                const ultimaSelic = parseFloat(dataSelic[dataSelic.length - 1].valor);

                updateIndicator('ibov', ibov.regularMarketPrice.toFixed(0), ibov.changePercent.toFixed(2), ibov.changePercent > 0);
                updateIndicator('usd', usd.buy.toFixed(4), usd.variation.toFixed(2), usd.variation < 0);
                renderChart('ipcaChart', 'IPCA (12 meses)', dataIpca);
                renderChart('selicChart', 'Selic (Meta a.a.)', dataSelic);
                generateDiagnostic(ibov.changePercent, usd.variation, ultimoIpca, ultimaSelic);

                if (COMMODITIES_API_KEY !== 'SUA_CHAVE_DE_API_AQUI') {
                     // Adicione aqui a lógica de fetch e update para commodities (Petróleo, Minério de Ferro)
                } else {
                    document.getElementById('brent-value').textContent = 'Chave Necessária';
                    document.getElementById('iron-value').textContent = 'Chave Necessária';
                }

            } catch (error) {
                console.error('Erro geral:', error);
            }
        }

        function updateIndicator(id, value, change, isPositive) { 
            document.getElementById(id + '-value').textContent = (id === 'usd' ? 'R$ ' : '') + value;
            document.getElementById(id + '-change').textContent = change + '%';
            document.getElementById(id + '-change').className = isPositive ? 'change positive' : 'change negative';
        }
        function renderChart(canvasId, labelText, historicalData) { 
             const ctx = document.getElementById(canvasId).getContext('2d');
            const dates = historicalData.map(item => item.data);
            const values = historicalData.map(item => parseFloat(item.valor));
            new Chart(ctx, {type: 'line', data: {labels: dates, datasets: [{label: labelText, data: values, borderColor: canvasId === 'ipcaChart' ? '#e74c3c' : '#3498db', borderWidth: 2, fill: false}]}, options: {responsive: true, scales: { y: { beginAtZero: false } }} });
        }
        function generateDiagnostic(ibovChange, usdChange, ipcaValue, selicValue) { 
            const diagnosticElement = document.getElementById('diagnostico-consolidado');
            let message = '';
            let className = '';
            const isIbovPositive = ibovChange > 0;
            const isUsdPositive = usdChange < 0; 
            const isIpcaOk = ipcaValue <= 5.0; 
            const isSelicOk = selicValue <= 13.0;

            if (isIbovPositive && isUsdPositive && isIpcaOk && isSelicOk) {
                message = 'Momento **Altamente Positivo**: Todos os indicadores principais apontam para um cenário favorável de crescimento e controle fiscal.';
                className = 'positive';
            } else if (!isIbovPositive && !isUsdPositive && !isIpcaOk && !isSelicOk) {
                message = 'Momento **Altamente Negativo**: Todos os indicadores principais apontam para um cenário de estresse, com inflação/juros altos, dólar subindo e bolsa caindo.';
                className = 'negative';
            } else {
                message = 'Momento **Misto/Neutro**: Indicadores mostram movimentos conflitantes. O mercado aguarda por definições políticas ou externas.';
                className = 'neutral';
            }
            diagnosticElement.innerHTML = message;
            diagnosticElement.className = className;
        }

        fetchData();
        setInterval(fetchData, 60000); 

        /* Isenção de Responsabilidade Financeira: Este painel utiliza dados públicos e serve apenas para fins ilustrativos e educacionais. Ele não constitui aconselhamento financeiro ou recomendação de investimento. Consulte um profissional certificado antes de tomar decisões financeiras. */
    </script>
</body>
</html>
