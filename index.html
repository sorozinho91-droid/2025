<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dire√ß√£o Macro ‚Äì Mini √çndice B3</title>

<style>
body{
  font-family:Arial;
  margin:0;
  background:#f3f4f6;
  display:flex;
}

/* ===== NOT√çCIAS (LADO ESQUERDO) ===== */
#newsPanel{
  width:360px;
  background:#0f172a;
  color:#fff;
  height:100vh;
  overflow-y:auto;
}
#newsPanel h3{
  margin:0;
  padding:12px;
  text-align:center;
  background:#020617;
  border-bottom:1px solid #1e293b;
}
.newsRow{
  padding:10px;
  border-bottom:1px solid #1e293b;
  font-size:13px;
}
.newsRow b{color:#facc15}
.newsRow a{
  color:#93c5fd;
  text-decoration:none;
}

/* ===== CONTE√öDO CENTRAL ===== */
#main{
  flex:1;
  padding:20px;
  display:flex;
  flex-direction:column;
  align-items:center;
}

header{
  width:100%;
  background:#020617;
  color:#fff;
  padding:10px;
  text-align:center;
  border-radius:6px;
}

/* ===== REL√ìGIO CENTRAL ===== */
#relogioCentral{
  margin:20px 0 10px 0;
  font-size:18px;
  font-weight:bold;
  text-align:center;
  color:#020617;
  background:#e5e7eb;
  padding:8px 20px;
  border-radius:6px;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
}

/* ===== BOX TEND√äNCIA ===== */
.box{
  width:650px;
  background:#fff;
  padding:18px;
  margin-top:10px;
  border-radius:6px;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
  font-size:16px;
}

.verde{border-left:6px solid #16a34a}
.vermelho{border-left:6px solid #dc2626}
.amarelo{border-left:6px solid #ca8a04}

.piscar{animation:pisc 1s infinite}
@keyframes pisc{0%{opacity:1}50%{opacity:.4}100%{opacity:1}}

#audioTrend{display:none}
</style>
</head>

<body>

<!-- ===== NOT√çCIAS IMPACTANTES ===== -->
<div id="newsPanel">
  <h3>üö® Not√≠cias que Impactam o Mercado</h3>
  <div id="newsTable">
    <div class="newsRow">Aguardando not√≠cias macro...</div>
  </div>
</div>

<!-- ===== CONTE√öDO CENTRAL ===== -->
<div id="main">
<header>
  <h2>Dire√ß√£o Macro ‚Äì Mini √çndice (WIN)</h2>
</header>

<!-- REL√ìGIO CENTRAL -->
<div id="relogioCentral">Carregando hor√°rio...</div>

<!-- BOX TEND√äNCIA -->
<div id="macroBox" class="box amarelo">
  Calculando tend√™ncia macro do mercado‚Ä¶
</div>
</div>

<audio id="audioTrend" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>

<script>
// ================= REL√ìGIO BRAS√çLIA =================
function atualizarRelogio(){
 const agora=new Date();
 const utc=agora.getTime()+agora.getTimezoneOffset()*60000;
 const br=new Date(utc-3*3600000);
 document.getElementById("relogioCentral").innerText =
 "‚è∞ Hor√°rio de Bras√≠lia: " + br.toLocaleTimeString("pt-BR");
}
setInterval(atualizarRelogio,1000);
atualizarRelogio();

// ================= ATIVOS MACRO REAIS =================
const riskOn=["INDEX:SPX","INDEX:NDX","INDEX:DAX","NYMEX:CL1!"];
const riskOff=["CBOE:VIX","FOREXCOM:DX1!","COMEX:GC1!"];

async function preco(symbol){
 try{
  const r=await fetch("https://api.allorigins.win/raw?url=https://s3.tradingview.com/symbols/"+symbol.replace(":","_")+".json");
  const j=await r.json();
  return j.last_price||j.close||0;
 }catch{return 0}
}

let hist=[],estado="";

// ================= C√ÅLCULO TEND√äNCIA MACRO =================
async function atualizarMacro(){
 let on=0,off=0;
 for(const a of riskOn) on+=await preco(a);
 for(const a of riskOff) off+=await preco(a);

 hist.push(on-off);
 if(hist.length>8) hist.shift();

 const media=hist.reduce((a,b)=>a+b,0)/hist.length;
 let novo="NEUTRO",cor="amarelo",texto="‚ö†Ô∏è Mercado indefinido / cautela";

 if(media>0){
  novo="ALTA";
  cor="verde";
  texto="üìà TEND√äNCIA DE ALTA<br><br><b>Priorizar COMPRAS no Mini √çndice (WIN)</b>";
 }
 if(media<0){
  novo="BAIXA";
  cor="vermelho";
  texto="üìâ TEND√äNCIA DE BAIXA<br><br><b>Priorizar VENDAS no Mini √çndice (WIN)</b>";
 }

 if(estado && estado!==novo){
  audioTrend.play().catch(()=>{});
  macroBox.classList.add("piscar");
  setTimeout(()=>macroBox.classList.remove("piscar"),12000);
 }

 estado=novo;
 macroBox.className="box "+cor;
 macroBox.innerHTML=`<b>üß≠ DIRE√á√ÉO MACRO DO MERCADO</b><br><br>${texto}`;
}

setInterval(atualizarMacro,60000);
atualizarMacro();

// ================= NOT√çCIAS MACRO =================
const keywords=["fed","juros","interest rate","cpi","inflation","infla√ß√£o","banco central","fiscal","d√≠vida","guerra","war","recess√£o"];
const cache={};

async function carregarNoticias(){
 const rss="https://news.google.com/rss/search?q="+encodeURIComponent(keywords.join(" OR "))+"&hl=pt-BR&gl=BR&ceid=BR:pt";
 const url="https://api.allorigins.win/raw?url="+encodeURIComponent(rss);

 try{
  const r=await fetch(url);
  const t=await r.text();
  const xml=new DOMParser().parseFromString(t,"text/xml");
  xml.querySelectorAll("item").forEach(i=>{
    const title=i.querySelector("title").textContent;
    const link=i.querySelector("link").textContent;
    if(cache[link]) return;
    cache[link]=true;

    const row=document.createElement("div");
    row.className="newsRow";
    row.innerHTML=`<b>‚ö†Ô∏è ${title}</b><br><a href="${link}" target="_blank">Abrir not√≠cia</a>`;
    newsTable.prepend(row);
  });
 }catch{}
}

carregarNoticias();
setInterval(carregarNoticias,30000);
</script>

</body>
</html>
