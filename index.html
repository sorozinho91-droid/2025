<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel + Curva Acumulada Intraday Responsivo</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
<style>
  body {
    font-family: 'Segoe UI', Arial, sans-serif;
    margin: 20px;
    background-color: #f0f2f5;
  }
  .panel {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 20px;
    justify-content: space-between;
  }
  .panel div {
    flex: 1 1 200px;
    padding: 12px;
    border-radius: 10px;
    background: #fff;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    text-align: center;
  }
  .panel h3 { margin: 0 0 6px; font-size: 16px; }
  .value { font-size: 24px; font-weight: bold; }
  .change { font-size: 14px; }
  #intradayChart {
    width: 100%;
    max-width: 1400px;
    height: 500px;
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
  }
</style>
</head>
<body>

<!-- PAINEL DE COTAÇÕES -->
<div class="panel">
  <div id="oilWTIPanel">
    <h3>Petróleo WTI</h3>
    <div class="value" id="oilWTIPrice">--</div>
    <div class="change" id="oilWTIChange">--</div>
  </div>
  <div id="oilBrentPanel">
    <h3>Petróleo Brent</h3>
    <div class="value" id="oilBrentPrice">--</div>
    <div class="change" id="oilBrentChange">--</div>
  </div>
  <div id="dxyPanel">
    <h3>Índice DXY</h3>
    <div class="value" id="dxyPrice">--</div>
    <div class="change" id="dxyChange">--</div>
  </div>
  <div id="ironPanel">
    <h3>Minério de Ferro</h3>
    <div class="value" id="ironPrice">--</div>
    <div class="change" id="ironChange">--</div>
  </div>
</div>

<!-- GRÁFICO INTRADAY -->
<canvas id="intradayChart"></canvas>

<script>
const ctx = document.getElementById('intradayChart').getContext('2d');
const startTime = new Date();

const data = {
    labels: [],
    datasets: [
        {
            label: 'Risco',
            borderColor: 'rgba(255,99,132,1)',
            backgroundColor: 'rgba(255,99,132,0.2)',
            data: [],
            fill: true,
            tension: 0.2,
            pointRadius: 3,
            borderWidth: 2
        },
        {
            label: 'Segurança',
            borderColor: 'rgba(54,162,235,1)',
            backgroundColor: 'rgba(54,162,235,0.2)',
            data: [],
            fill: true,
            tension: 0.2,
            pointRadius: 3,
            borderWidth: 2
        }
    ]
};

const config = {
    type: 'line',
    data: data,
    options: {
        responsive: true,
        maintainAspectRatio: false,
        animation: false,
        plugins: {
            legend: { labels: { font: { size: 14 } } },
            tooltip: { mode: 'index', intersect: false },
            zoom: {
                pan: { enabled: true, mode: 'x', modifierKey: 'ctrl' },
                zoom: { wheel: { enabled: true }, pinch: { enabled: true }, mode: 'x' }
            }
        },
        scales: {
            x: {
                title: { display: true, text: 'Tempo desde abertura (HH:MM:SS)' },
                ticks: { maxTicksLimit: 20 },
                grid: { color: 'rgba(0,0,0,0.05)' }
            },
            y: {
                beginAtZero: true,
                max: 100,
                title: { display: true, text: 'Valor' },
                grid: { color: 'rgba(0,0,0,0.05)' }
            }
        }
    },
    plugins: [Chart.registry.getPlugin('zoom')]
};

const intradayChart = new Chart(ctx, config);

// Atualiza o gráfico automaticamente
function addIntradayData(risco, seguranca){
    const now = new Date();
    const timeLabel = now.toLocaleTimeString('pt-BR', {hour12:false});
    data.labels.push(timeLabel);
    data.datasets[0].data.push(risco);
    data.datasets[1].data.push(seguranca);

    const maxPoints = 5000;
    if(data.labels.length > maxPoints){
        data.labels.shift();
        data.datasets[0].data.shift();
        data.datasets[1].data.shift();
    }

    intradayChart.update();
}

// --------------------
// PAINEL DE COTAÇÕES
// --------------------
function updateQuotes(oilWTI, oilBrent, dxy, iron){
    document.getElementById('oilWTIPrice').innerText = `$${oilWTI.price}`;
    document.getElementById('oilWTIChange').innerText = `${oilWTI.change}%`;
    document.getElementById('oilBrentPrice').innerText = `$${oilBrent.price}`;
    document.getElementById('oilBrentChange').innerText = `${oilBrent.change}%`;
    document.getElementById('dxyPrice').innerText = dxy.price;
    document.getElementById('dxyChange').innerText = `${dxy.change}%`;
    document.getElementById('ironPrice').innerText = iron.price;
    document.getElementById('ironChange').innerText = `${iron.change}%`;
}

function refreshAll(){
    // Simulação de dados aleatórios
    const risco = Math.floor(Math.random()*100);
    const seguranca = Math.floor(Math.random()*100);
    addIntradayData(risco, seguranca);

    const oilWTI = { price: (70+Math.random()*5).toFixed(2), change: (Math.random()*2-1).toFixed(2) };
    const oilBrent = { price: (72+Math.random()*5).toFixed(2), change: (Math.random()*2-1).toFixed(2) };
    const dxy = { price: (104+Math.random()*1.5).toFixed(2), change: (Math.random()*0.5-0.25).toFixed(2) };
    const iron = { price: (130+Math.random()*5).toFixed(2), change: (Math.random()*1.5-0.75).toFixed(2) };

    updateQuotes(oilWTI, oilBrent, dxy, iron);
}

// Atualiza painel e gráfico automaticamente a cada 60 segundos
