<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard ‚Äì Linha do Tempo Risco x Seguran√ßa</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f4f6f8; }
header { background:#1f2937; color:white; padding:15px; text-align:center; }
#controls, #compareDates { text-align:center; padding:10px; }
button { margin:5px; padding:8px 16px; border:none; border-radius:4px; cursor:pointer; background:#e5e7eb; }
button.active { background:#2563eb; color:white; }
#grafico { width:90%; max-width:1200px; height:400px; margin:20px auto; background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
table { width:90%; max-width:1200px; margin:20px auto; border-collapse: collapse; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.05);}
th, td { padding:8px; border:1px solid #ccc; text-align:center; font-size:14px;}
thead th { background:#2563eb; color:white;}
.risco { color:green; }        /* Risco verde */
.seguro { color:red; }         /* Seguran√ßa vermelho */
.positivo { color:green; }
.negativo { color:red; }
</style>
</head>
<body>

<header>
<h2>Risco x Seguran√ßa ‚Äì Linha do Tempo (Tempo Real)</h2>
</header>

<div id="controls">
<button onclick="setTimeframe(60,this)" class="active">60s</button>
<button onclick="setTimeframe(1,this)">1m</button>
<button onclick="setTimeframe(5,this)">5m</button>
</div>

<div id="compareDates">
<label>In√≠cio: <input type="datetime-local" id="startDate"></label>
<label>Fim: <input type="datetime-local" id="endDate"></label>
<button onclick="filtrarPorData()">Comparar</button>
<button onclick="resetGrafico()">Resetar</button>
</div>

<div id="grafico"></div>

<!-- Tabelas de Ativos -->
<table id="tabelaRisco">
<thead>
<tr><th>Ativo de Risco</th><th>Valor Atual</th><th>Varia√ß√£o (%)</th></tr>
</thead>
<tbody></tbody>
</table>

<table id="tabelaSeguro">
<thead>
<tr><th>Ativo de Seguran√ßa</th><th>Valor Atual</th><th>Varia√ß√£o (%)</th></tr>
</thead>
<tbody></tbody>
</table>

<script>
// ==== Vari√°veis ====
let datas = [];
let risco = [];
let seguro = [];
let valorRisco = 100;
let valorSeguro = 100;
let timer = null;
let filtered = false;
let filteredStart, filteredEnd;
let timeframe = 60; // segundos

// Ativos de Risco
let ativosRisco = [
    {nome:"Ouro Futuros", valor:2766.2},
    {nome:"Cobre Futuros", valor:4.2315},
    {nome:"Petr√≥leo WTI", valor:73.17},
    {nome:"Min√©rio de Ferro", valor:56.72},
    {nome:"Vale SA ADR", valor:9.16},
    {nome:"Petrobras ADR", valor:13.88},
    {nome:"Soja Chicago", valor:1045},
    {nome:"Oslo All Share", valor:1709.43},
    {nome:"Dow Jones Futuros", valor:44904},
    {nome:"The Global Dow USD", valor:5079.14},
    {nome:"BSE Sensex 30", valor:75366.17},
    {nome:"Hang Seng Futuros", valor:20430.5},
    {nome:"China A50 Futuros", valor:12983},
    {nome:"SZSE Component", valor:10292.73},
    {nome:"Shanghai Composite", valor:3252.63},
    {nome:"Financial Select Sector", valor:51.41},
    {nome:"Consumer Staples", valor:80.01},
    {nome:"Energy Select Sector", valor:90.36},
    {nome:"SPDR Metals & Mining", valor:58.68},
    {nome:"iShares MSCI Emerging Markets", valor:42.17},
    {nome:"iShares Semiconductor ETF", valor:212.55}
];

// Ativos de Seguran√ßa
let ativosSeguranca = [
    {nome:"DXY - √çndice D√≥lar", valor:107.16},
    {nome:"EUR/BRL", valor:6.1843},
    {nome:"S&P 500 VIX Futuros", valor:17.61},
    {nome:"USD/MXN", valor:20.665},
    {nome:"USD/NOK", valor:11.2378},
    {nome:"USD/NZD", valor:1.7565},
    {nome:"USD/AUD", valor:1.5892},
    {nome:"USD/KRW", valor:1432.84},
    {nome:"USD/CNY", valor:7.2509}
];

// Gerar hist√≥rico inicial (30 dias, 1 ponto/hora)
function gerarHistorico(){
    const agora = new Date();
    const start = new Date(agora.getTime() - 30*24*60*60*1000);
    datas = []; risco = []; seguro = [];
    let valR = valorRisco;
    let valS = valorSeguro;
    for(let d=new Date(start); d<=agora; d.setHours(d.getHours()+1)){
        valR += (Math.random()-0.5)*2;
        valS += (Math.random()-0.5)*1;
        datas.push(new Date(d));
        risco.push(valR);
        seguro.push(valS);
    }
}

// Plotar gr√°fico
function plotGrafico(x, yR, yS){
    Plotly.react('grafico',[
        {x:x, y:yR, mode:'lines+markers', name:'Risco', line:{color:'green'}},       // Risco verde
        {x:x, y:yS, mode:'lines+markers', name:'Seguran√ßa', line:{color:'red'}}      // Seguran√ßa vermelho
    ],{
        title:'Linha do Tempo Risco x Seguran√ßa',
        xaxis:{title:'Data', type:'date', rangeslider:{visible:false}},
        yaxis:{title:'Valor'},
        margin:{t:40,l:50,r:50,b:50},
        legend:{x:1,xanchor:'right',y:1}
    });
}

// Atualizar tabelas
function atualizarTabelas(){
    const tbodyR = document.querySelector("#tabelaRisco tbody");
    tbodyR.innerHTML="";
    ativosRisco.forEach(a=>{
        let variacao = a.variacao?.toFixed(2)??0;
        let tr = document.createElement("tr");
        tr.innerHTML=`<td class="risco">${a.nome}</td>
                      <td>${a.valor.toFixed(2)}</td>
                      <td class="${variacao>=0?'positivo':'negativo'}">${variacao}%</td>`;
        tbodyR.appendChild(tr);
    });
    const tbodyS = document.querySelector("#tabelaSeguro tbody");
    tbodyS.innerHTML="";
    ativosSeguranca.forEach(a=>{
        let variacao = a.variacao?.toFixed(2)??0;
        let tr = document.createElement("tr");
        tr.innerHTML=`<td class="seguro">${a.nome}</td>
                      <td>${a.valor.toFixed(2)}</td>
                      <td class="${variacao>=0?'positivo':'negativo'}">${variacao}%</td>`;
        tbodyS.appendChild(tr);
    });
}

// Atualiza√ß√£o em tempo real
function atualizarGrafico(){
    const agora = new Date();
    valorRisco += (Math.random()-0.5)*2;
    valorSeguro += (Math.random()-0.5)*1;
    datas.push(agora);
    risco.push(valorRisco);
    seguro.push(valorSeguro);

    if(datas.length>1000){
        datas.shift(); risco.shift(); seguro.shift();
    }

    if(filtered){
        const newD=[], newR=[], newS=[];
        for(let i=0;i<datas.length;i++){
            if(datas[i]>=filteredStart && datas[i]<=filteredEnd){
                newD.push(datas[i]);
                newR.push(risco[i]);
                newS.push(seguro[i]);
            }
        }
        plotGrafico(newD,newR,newS);
    } else {
        plotGrafico(datas,risco,seguro);
    }

    // Atualiza valores e varia√ß√µes dos ativos
    ativosRisco.forEach(a=>{
        let novo = a.valor + (Math.random()-0.5)*2;
        a.variacao = ((novo-a.valor)/a.valor)*100;
        a.valor = novo;
    });
    ativosSeguranca.forEach(a=>{
        let novo = a.valor + (Math.random()-0.5)*1;
        a.variacao = ((novo-a.valor)/a.valor)*100;
        a.valor = novo;
    });

    atualizarTabelas();
}

// Filtrar por datas
function filtrarPorData(){
    filteredStart = new Date(document.getElementById('startDate').value);
    filteredEnd = new Date(document.getElementById('endDate').value);
    if(isNaN(filteredStart) || isNaN(filteredEnd)){ alert("Selecione datas v√°lidas"); return; }
    if(filteredStart > filteredEnd){ alert("A data de in√≠cio deve ser anterior √† data de fim."); return; }
    filtered = true;
    atualizarGrafico();
}

// Resetar filtro
function resetGrafico(){
    filtered = false;
    plotGrafico(datas,risco,seguro);
}

// Alterar timeframe
function setTimeframe(segundos, botao){
    timeframe = segundos;
    document.querySelectorAll('#controls button').forEach(b=>b.classList.remove('active'));
    botao.classList.add('active');
    if(timer) clearInterval(timer);
    timer = setInterval(atualizarGrafico, timeframe*1000);
}

// Inicializa√ß√£o
gerarHistorico();
if(datas.length===0){
    const agora = new Date();
    datas.push(agora); risco.push(valorRisco); seguro.push(valorSeguro);
}
plotGrafico(datas,risco,seguro);
atualizarTabelas();
timer = setInterval(atualizarGrafico, timeframe*1000);

// Redimensionamento responsivo
window.addEventListener('resize', ()=>{ Plotly.Plots.resize('grafico'); });
</script>

<!-- ===== WIDGET COTA√á√ïES GLOBAIS (ISOLADO) ===== -->
<div id="wg-cotacoes-root"></div>

<style>
#wg-cotacoes-root {
  all: initial;
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 270px;
  max-height: 70vh;
  overflow-y: auto;
  background: #ffffff;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.18);
  font-family: Arial, sans-serif;
  font-size: 12px;
  z-index: 99999;
}

#wg-cotacoes-root * {
  all: unset;
  box-sizing: border-box;
  font-family: Arial, sans-serif;
}

#wg-cotacoes-header {
  background: #1f2937;
  color: #fff;
  padding: 10px;
  text-align: center;
  font-weight: bold;
}

#wg-cotacoes-table {
  width: 100%;
  border-collapse: collapse;
}

#wg-cotacoes-table td {
  padding: 5px 6px;
  border-bottom: 1px solid #eee;
  text-align: right;
}

#wg-cotacoes-table td:first-child {
  text-align: left;
}

.wg-cat {
  background: #f3f4f6;
  font-weight: bold;
}

.wg-pos { color: green; }
.wg-neg { color: red; }
</style>

<script>
(function(){
  const ativos = [
    ["√çndices","DJIA","^DJI"],
    ["","Nasdaq 100","^NDX"],
    ["","Russell 2000","^RUT"],
    ["","Nikkei 225","^N225"],
    ["","Euro Stoxx 50","^STOXX50E"],
    ["","DAX","^GDAXI"],
    ["","VIX","^VIX"],
    ["","Ibovespa","^BVSP"],

    ["Energy","Crude Oil WTI","CL=F"],
    ["","Crude Oil Brent","BZ=F"],

    ["Bonds","30Y Bond","^TYX"],
    ["","10Y Note","^TNX"],
    ["","5Y Note","^FVX"],
    ["","2Y Note","^IRX"],

    ["Metals","Gold","GC=F"],

    ["Currencies","USD Index","DX-Y.NYB"],
    ["","EUR/USD","EURUSD=X"]
  ];

  const root = document.getElementById("wg-cotacoes-root");
  root.innerHTML = `
    <div id="wg-cotacoes-header">Cota√ß√µes Globais</div>
    <table id="wg-cotacoes-table"></table>
  `;

  const tabela = root.querySelector("#wg-cotacoes-table");

  async function atualizar(){
    tabela.innerHTML = "";
    let catAtual = "";

    for (const [cat,nome,symbol] of ativos){
      if (cat && cat !== catAtual){
        catAtual = cat;
        const tr = document.createElement("tr");
        tr.innerHTML = `<td class="wg-cat" colspan="3">${cat}</td>`;
        tabela.appendChild(tr);
      }

      try{
       const url = `https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbol}`;
const r = await fetch(
  `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
  { cache: "no-store" }
);
const j = await r.json();

        );
        const j = await r.json();
        const d = j.quoteResponse.result[0];

        const preco = d?.regularMarketPrice?.toFixed(2) ?? "-";
        const varp  = d?.regularMarketChangePercent ?? 0;
        const cls   = varp >= 0 ? "wg-pos" : "wg-neg";

        const tr = document.createElement("tr");
tr.innerHTML = `
  <td class="${cls}" style="text-align:right;">
    ${varp.toFixed(2)}%
  </td>
`;

          
        `;
        tabela.appendChild(tr);

      } catch(e){
        const tr = document.createElement("tr");
        tr.innerHTML = `<td colspan="3">${nome} indispon√≠vel</td>`;
        tabela.appendChild(tr);
      }
    }
  }

  atualizar();
  setInterval(atualizar, 60000); // 1 minuto
})();
</script>
<!-- ===== FIM DO WIDGET ===== -->
<!-- ===== WIDGET VARIA√á√ÉO GLOBAL (ISOLADO) ===== -->
<div id="wg-var-root"></div>

<style>
#wg-var-root {
  position: fixed;
  top: 15px;
  right: 15px;
  width: 220px;
  background: #ffffff;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  font-family: Arial, sans-serif;
  font-size: 12px;
  z-index: 99999;
}

#wg-var-root table {
  width: 100%;
  border-collapse: collapse;
}

#wg-var-root td {
  padding: 6px;
  border-bottom: 1px solid #eee;
  text-align: right;
}

.wg-cat {
  background: #1f2937;
  color: #fff;
  font-weight: bold;
  text-align: center;
}

.wg-pos { color: green; }
.wg-neg { color: red; }
</style>

<script>
(function(){
  const ativos = [
    ["√çndices","DJIA","^DJI"],
    ["","Nasdaq 100","^NDX"],
    ["","Russell 2000","^RUT"],
    ["","Nikkei 225","^N225"],
    ["","Euro Stoxx 50","^STOXX50E"],
    ["","DAX","^GDAXI"],
    ["","VIX","^VIX"],
    ["","Ibovespa","^BVSP"],

    ["Energy","WTI","CL=F"],
    ["","Brent","BZ=F"],

    ["Bonds","30Y","^TYX"],
    ["","10Y","^TNX"],
    ["","5Y","^FVX"],
    ["","2Y","^IRX"],

    ["Metals","Gold","GC=F"],

    ["Currencies","USD","DX-Y.NYB"],
    ["","EUR/USD","EURUSD=X"]
  ];

  const root = document.getElementById("wg-var-root");
  root.innerHTML = `<table id="wg-var-table"></table>`;
  const tabela = root.querySelector("#wg-var-table");

  async function atualizar(){
    tabela.innerHTML = "";
    let catAtual = "";

    for (const [cat,nome,symbol] of ativos){
      if (cat && cat !== catAtual){
        catAtual = cat;
        const trCat = document.createElement("tr");
        trCat.innerHTML = `<td class="wg-cat">${cat}</td>`;
        tabela.appendChild(trCat);
      }

      try {
        const url = `https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbol}`;
        const r = await fetch(
          `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
          { cache: "no-store" }
        );
        const j = await r.json();
        const d = j.quoteResponse.result[0];

        const varp = d?.regularMarketChangePercent ?? 0;
        const cls = varp >= 0 ? "wg-pos" : "wg-neg";

        const tr = document.createElement("tr");
        tr.innerHTML = `<td class="${cls}">${nome}: ${varp.toFixed(2)}%</td>`;
        tabela.appendChild(tr);

      } catch(e){
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${nome}: --</td>`;
        tabela.appendChild(tr);
      }
    }
  }

  atualizar();
  setInterval(atualizar, 60000);
})();
</script>
<!-- ===== FIM DO WIDGET ===== -->

    <!-- ===== WIDGET VARIA√á√ÉO GLOBAL (√öNICO / ISOLADO) ===== -->
<div id="wg-var-root"></div>

<style>
#wg-var-root {
  position: fixed;
  top: 15px;
  right: 15px;
  width: 220px;
  background: #ffffff;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  font-family: Arial, sans-serif;
  font-size: 10px;
  z-index: 99999;
}

#wg-var-root table {
  width: 100%;
  border-collapse: collapse;
}

#wg-var-root td {
  padding: 4px 6px;
  border-bottom: 1px solid #eee;
  text-align: right;
}

.wg-cat {
  background: #1f2937;
  color: #fff;
  font-weight: bold;
  text-align: center;
}

.wg-pos { color: green; }
.wg-neg { color: red; }
</style>

<script>
(function(){
  const ativos = [
    ["√çndices","DJIA","^DJI"],
    ["","Nasdaq 100","^NDX"],
    ["","Russell 2000","^RUT"],
    ["","Nikkei 225","^N225"],
    ["","Euro Stoxx 50","^STOXX50E"],
    ["","DAX","^GDAXI"],
    ["","VIX","^VIX"],
    ["","Ibovespa","^BVSP"],

    ["Energy","WTI","CL=F"],
    ["","Brent","BZ=F"],

    ["Bonds","30Y","^TYX"],
    ["","10Y","^TNX"],
    ["","5Y","^FVX"],
    ["","2Y","^IRX"],

    ["Metals","Gold","GC=F"],

    ["Currencies","USD Index","DX-Y.NYB"],
    ["","EUR/USD","EURUSD=X"]
  ];

  const root = document.getElementById("wg-var-root");
  root.innerHTML = `<table id="wg-var-table"></table>`;
  const tabela = root.querySelector("#wg-var-table");

  async function atualizar(){
    tabela.innerHTML = "";
    let catAtual = "";

    // üîπ UMA √öNICA REQUISI√á√ÉO (robusto)
    const symbols = ativos.map(a => a[2]).join(",");
    const url = `https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbols}`;

    try {
      const r = await fetch(
        `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
        { cache: "no-store" }
      );
      const j = await r.json();
      const dados = j.quoteResponse.result;

      // mapa r√°pido
      const mapa = {};
      dados.forEach(d => mapa[d.symbol] = d);

      for (const [cat,nome,symbol] of ativos){
        if (cat && cat !== catAtual){
          catAtual = cat;
          const trCat = document.createElement("tr");
          trCat.innerHTML = `<td class="wg-cat">${cat}</td>`;
          tabela.appendChild(trCat);
        }

        const d = mapa[symbol];
        const varp = d?.regularMarketChangePercent;

        const valor = (varp !== null && varp !== undefined)
          ? varp.toFixed(2) + "%"
          : "--";

        const cls = varp >= 0 ? "wg-pos" : "wg-neg";

        const tr = document.createElement("tr");
        tr.innerHTML = `<td class="${cls}">${nome}: ${valor}</td>`;
        tabela.appendChild(tr);
      }

    } catch(e){
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>Erro ao carregar cota√ß√µes</td>`;
      tabela.appendChild(tr);
    }
  }

  atualizar();
  setInterval(atualizar, 60000); // 1 minuto
})();
</script>
<!-- ===== FIM DO WIDGET ===== -->
<!-- ===== WIDGET VARIA√á√ÉO ‚Äì SEM CONFLITO ===== -->
<div id="tv-widget-corner"></div>

<style>
#tv-widget-corner {
  position: fixed;
  top: 15px;
  right: 15px;
  width: 260px;
  z-index: 99999;
  font-size: 10px;
}
</style>

<script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
{
  "colorTheme": "light",
  "dateRange": "1D",
  "showChart": false,
  "locale": "pt",
  "width": "260",
  "height": "420",
  "largeChartUrl": "",
  "isTransparent": false,
  "tabs": [
    {
      "title": "√çndices",
      "symbols": [
        {"s": "DJI", "d": "DJIA"},
        {"s": "NASDAQ:NDX", "d": "Nasdaq 100"},
        {"s": "RUSSELL:RUT", "d": "Russell 2000"},
        {"s": "TVC:NI225", "d": "Nikkei 225"},
        {"s": "TVC:SX5E", "d": "Euro Stoxx 50"},
        {"s": "XETR:DAX", "d": "DAX"},
        {"s": "CBOE:VIX", "d": "VIX"},
        {"s": "BMFBOVESPA:IBOV", "d": "Ibovespa"}
      ]
    },
    {
      "title": "Energy",
      "symbols": [
        {"s": "NYMEX:CL1!", "d": "WTI"},
        {"s": "ICEEUR:BRN1!", "d": "Brent"}
      ]
    },
    {
      "title": "Bonds",
      "symbols": [
        {"s": "TVC:US30Y", "d": "30Y"},
        {"s": "TVC:US10Y", "d": "10Y"},
        {"s": "TVC:US05Y", "d": "5Y"},
        {"s": "TVC:US02Y", "d": "2Y"}
      ]
    },
    {
      "title": "Metals",
      "symbols": [
        {"s": "COMEX:GC1!", "d": "Gold"}
      ]
    },
    {
      "title": "FX",
      "symbols": [
        {"s": "TVC:DXY", "d": "USD Index"},
        {"s": "FX:EURUSD", "d": "EUR/USD"}
      ]
    }
  ]
}
</script>
<!-- ===== FIM DO WIDGET ===== -->
<!-- ===== WIDGET VARIA√á√ÉO ‚Äì LISTA √öNICA ===== -->
<div id="tv-var-left"></div>

<style>
#tv-var-left {
  position: fixed;
  top: 15px;
  left: 15px;
  width: 280px;
  z-index: 99999;
}
</style>

<script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-quotes.js" async>
{
  "width": "280",
  "height": "520",
  "symbolsGroups": [
    {
      "name": "Global",
      "symbols": [
        {"name": "DJI", "displayName": "DJIA"},
        {"name": "NASDAQ:NDX", "displayName": "Nasdaq 100"},
        {"name": "RUSSELL:RUT", "displayName": "Russell 2000"},
        {"name": "TVC:NI225", "displayName": "Nikkei 225"},
        {"name": "TVC:SX5E", "displayName": "Euro Stoxx 50"},
        {"name": "XETR:DAX", "displayName": "DAX"},
        {"name": "CBOE:VIX", "displayName": "VIX"},
        {"name": "BMFBOVESPA:IBOV", "displayName": "Ibovespa"},

        {"name": "NYMEX:CL1!", "displayName": "WTI"},
        {"name": "ICEEUR:BRN1!", "displayName": "Brent"},

        {"name": "TVC:US30Y", "displayName": "30Y"},
        {"name": "TVC:US10Y", "displayName": "10Y"},
        {"name": "TVC:US05Y", "displayName": "5Y"},
        {"name": "TVC:US02Y", "displayName": "2Y"},

        {"name": "COMEX:GC1!", "displayName": "Gold"},

        {"name": "TVC:DXY", "displayName": "USD Index"},
        {"name": "FX:EURUSD", "displayName": "EUR/USD"}
      ]
    }
  ],
  "showSymbolLogo": false,
  "colorTheme": "light",
  "isTransparent": false,
  "locale": "pt"
}
</script>
<!-- ===== FIM DO WIDGET ===== -->

    
</body>
</html>
