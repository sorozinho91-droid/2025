<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard Financeiro Global</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#f2f4f7;
  --mod:#ffffff;
  --card:#f7f7f7;
  --line:#dcdcdc;
  --text:#000;
  --muted:#333;
  --blue:#0d47a1;
  --red:#ef5350;
  --orange:#ffb74d;
  --yellow:#fff176;
}

html,body{
  height:100%;
  margin:0;
  overflow:hidden;
}

body{
  background:var(--bg);
  color:var(--text);
  font-family:Arial, Helvetica, sans-serif;
  padding:12px;
}

.dashboard{
  display:grid;
  grid-template-rows:auto 1fr;
  height:100%;
  gap:12px;
}

.section.breaking{
  background:#fff5f5;
  border:2px solid var(--red);
  border-radius:10px;
  padding:10px;
  max-height:22vh;
  overflow-y:auto;
}

.main{
  display:grid;
  grid-template-columns:repeat(3, 1fr);
  grid-auto-rows:minmax(0, 1fr);
  gap:12px;
  height:100%;
  overflow-y:auto;
}

.section{
  background:var(--mod);
  border:1px solid var(--line);
  border-radius:10px;
  padding:10px;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  box-shadow:0 1px 2px rgba(0,0,0,.05);
}

.section h2{
  font-size:14px;
  margin:0 0 6px;
  padding-bottom:4px;
  border-bottom:1px solid var(--line);
}

.list{
  overflow-y:auto;
  scrollbar-width:thin;
}

.news-item{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:6px;
  padding:6px 8px;
  margin-bottom:6px;
  position:relative;
}

.news-item::before{
  content:"";
  position:absolute;
  left:0;
  top:0;
  bottom:0;
  width:3px;
}

.urgente-vermelho::before{background:var(--red);}
.urgente-laranja::before{background:var(--orange);}
.urgente-amarelo::before{background:var(--yellow);}

.news-title a{
  color:var(--blue);
  font-size:12.5px;
  font-weight:bold;
  text-decoration:none;
}

.news-desc{
  font-size:11.5px;
  color:var(--muted);
  margin-top:4px;
  line-height:1.3;
}

@media (min-width:2560px){
  body{font-size:15px;padding:20px}
  .dashboard{max-width:2800px;margin:0 auto}
  .main{grid-template-columns:repeat(4,1fr)}
  .section h2{font-size:16px}
  .news-title a{font-size:14px}
  .news-desc{font-size:13px}
}
</style>
</head>

<body>
<div class="dashboard">

<div class="section breaking" id="breaking">
  <h2>ğŸš¨ Breaking News â€” Impacto Imediato</h2>
  <div class="list"></div>
</div>

<div class="main">
  <div class="section" id="mercado"><h2>ğŸ“° Mercado Financeiro</h2><div class="list"></div></div>
  <div class="section" id="minerio"><h2>ğŸª¨ MinÃ©rio de Ferro</h2><div class="list"></div></div>
  <div class="section" id="petroleo"><h2>ğŸ›¢ï¸ PetrÃ³leo</h2><div class="list"></div></div>
  <div class="section" id="dxy"><h2>ğŸ’µ DXY & DÃ³lar</h2><div class="list"></div></div>
  <div class="section" id="juros"><h2>ğŸ“ˆ Juros Americanos</h2><div class="list"></div></div>
  <div class="section" id="bancos"><h2>ğŸ¦ Bancos</h2><div class="list"></div></div>
  <div class="section" id="bolsasUSA"><h2>ğŸ‡ºğŸ‡¸ Bolsas EUA</h2><div class="list"></div></div>
  <div class="section" id="bolsasEuropa"><h2>ğŸ‡ªğŸ‡º Bolsas Europa</h2><div class="list"></div></div>
  <div class="section" id="bolsasAsia"><h2>ğŸŒ Bolsas Ãsia</h2><div class="list"></div></div>
</div>
</div>

<script>
const palavrasUrgentes=[
 {p:'guerra',c:'urgente-vermelho'},
 {p:'crise',c:'urgente-laranja'},
 {p:'queda',c:'urgente-laranja'},
 {p:'falÃªncia',c:'urgente-laranja'},
 {p:'alta forte',c:'urgente-amarelo'}
];

function getUrgencia(a){
 const t=(a.title+a.desc).toLowerCase();
 for(const p of palavrasUrgentes) if(t.includes(p.p)) return p.c;
 return '';
}

const temas={
 mercado:null,
 minerio:["minÃ©rio","iron ore","vale","aÃ§o"],
 petroleo:["petrÃ³leo","oil","brent","wti","opec"],
 dxy:["dxy","dÃ³lar","usd","fed"],
 juros:["juros","interest","fomc","yield"],
 bancos:["banco","bank","itaÃº","jpmorgan"],
 bolsasUSA:["dow","nasdaq","s&p","wall street"],
 bolsasEuropa:["dax","ftse","cac","ibex","stoxx","europa","londres","frankfurt","paris","madrid"],
 bolsasAsia:["nikkei","hang seng","shanghai","kospi","asia","china","japÃ£o","hong kong"]
};

const feedsMercado=[
 "https://valor.globo.com/rss/mercados/",
 "https://www.infomoney.com.br/feed/"
];

const feedsBreaking=[
 "https://g1.globo.com/rss/g1/ultimas-noticias.rss"
];

function stripHTML(h){
 const d=document.createElement("div");
 d.innerHTML=h;
 return d.textContent||"";
}

async function buscarRSS(url){
 try{
  const r=await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`);
  const x=await r.text();
  const xml=new DOMParser().parseFromString(x,"text/xml");
  return [...xml.querySelectorAll("item")].map(i=>({
    title:i.querySelector("title")?.textContent||"",
    link:i.querySelector("link")?.textContent||"",
    desc:i.querySelector("description")?.textContent||""
  }));
 }catch{return []}
}

function pertenceTema(a,p){
 if(!p) return true;
 const t=(a.title+a.desc).toLowerCase();
 return p.some(x=>t.includes(x));
}

async function atualizarSecao(id,feeds,filtro){
 const box=document.querySelector(`#${id} .list`);
 box.innerHTML="";
 const dados=(await Promise.all(feeds.map(f=>buscarRSS(f)))).flat();
 dados.filter(n=>pertenceTema(n,filtro)).slice(0,5).forEach(n=>{
  const d=document.createElement("div");
  d.className="news-item";
  const u=getUrgencia(n);
  if(u) d.classList.add(u);
  d.innerHTML=`
   <div class="news-title"><a href="${n.link}" target="_blank">${n.title}</a></div>
   <div class="news-desc">${stripHTML(n.desc)}</div>`;
  box.appendChild(d);
 });
}

async function atualizarTudo(){
 await atualizarSecao("breaking",feedsBreaking);
 for(const t in temas){
   await atualizarSecao(t,feedsMercado,temas[t]);
 }
}

atualizarTudo();
setInterval(atualizarTudo,60000);
</script>
</body>
</html>
/* =====================================
   SENTIMENTO IBOV â€” TEMPO REAL (ADD-ON)
   ===================================== */

const PESOS_IBOV = {
  china: 0.25,
  commodities: 0.25,
  petroleo: 0.15,
  dolar: 0.15,
  vix: 0.10,
  bolsas: 0.10
};

const ATIVOS_IBOV = {
  china: "FXI",
  commodities: "BHP",
  petroleo: "CL=F",
  dolar: "DX-Y.NYB",
  vix: "^VIX",
  bolsas: "^GSPC"
};

let ibovDados = {};
let ibovHist = [];
let ibovLabels = [];
let ibovChart;

/* Yahoo Finance */
async function cotacaoYahoo(symbol){
  const r = await fetch(
    `https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbol}`
  );
  const j = await r.json();
  return j.quoteResponse.result[0]?.regularMarketChangePercent || 0;
}

async function atualizarDadosIbov(){
  for(const k in ATIVOS_IBOV){
    ibovDados[k] = await cotacaoYahoo(ATIVOS_IBOV[k]);
  }
}

function calcularScoreIbov(){
  return Math.round((
    ibovDados.china * PESOS_IBOV.china +
    ibovDados.commodities * PESOS_IBOV.commodities +
    ibovDados.petroleo * PESOS_IBOV.petroleo +
    (-ibovDados.dolar) * PESOS_IBOV.dolar +
    (-ibovDados.vix) * PESOS_IBOV.vix +
    ibovDados.bolsas * PESOS_IBOV.bolsas
  ) * 10);
}

function statusIbov(score){
  if(score > 40) return "RISK-ON FORTE";
  if(score > 15) return "RISK-ON";
  if(score < -40) return "RISK-OFF FORTE";
  if(score < -15) return "RISK-OFF";
  return "NEUTRO";
}

function iniciarGraficoIbov(){
  ibovChart = new Chart(
    document.getElementById("ibovChart"),
    {
      type:"line",
      data:{
        labels: ibovLabels,
        datasets:[{
          data: ibovHist,
          borderWidth:2,
          tension:0.3,
          fill:false
        }]
      },
      options:{
        animation:false,
        scales:{ y:{ min:-100, max:100 }},
        plugins:{ legend:{ display:false } }
      }
    }
  );
}

async function loopIbov(){
  await atualizarDadosIbov();
  const score = calcularScoreIbov();
  const hora = new Date().toLocaleTimeString(
    "pt-BR",{hour:"2-digit",minute:"2-digit"}
  );

  ibovHist.push(score);
  ibovLabels.push(hora);

  if(ibovHist.length > 90){
    ibovHist.shift();
    ibovLabels.shift();
  }

  const elScore = document.getElementById("ibovScore");
  elScore.textContent = score;
  elScore.style.color =
    score > 0 ? "#2e7d32" :
    score < 0 ? "#c62828" : "#555";

  document.getElementById("ibovStatus").textContent = statusIbov(score);

  ibovChart.update();
}

/* START (nÃ£o interfere nas notÃ­cias) */
iniciarGraficoIbov();
loopIbov();
setInterval(loopIbov,30000);
