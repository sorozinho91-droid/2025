<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net"></script>
    <style>
        body { background: #111; color: #0f0; font-family: monospace; padding: 20px; }
        /* Forçamos uma altura mínima para o gráfico não "sumir" */
        .chart-container { 
            position: relative; 
            height: 400px !important; 
            width: 100%; 
            border: 1px solid #333; 
        }
        #relogio { font-size: 30px; margin-bottom: 20px; }
    </style>
</head>
<body>

    <div id="relogio">CARREGANDO HORA...</div>

    <div class="chart-container">
        <canvas id="graficoMercado"></canvas>
    </div>

    <script>
        // 1. Relógio imediato
        function atualizarRelogio() {
            document.getElementById('relogio').innerText = new Date().toLocaleTimeString('pt-BR', {timeZone: 'America/Sao_Paulo'});
        }
        setInterval(atualizarRelogio, 1000);
        atualizarRelogio();

        // 2. Gráfico com dados fixos para teste imediato
        const ctx = document.getElementById('graficoMercado').getContext('2d');
        const config = {
            type: 'line',
            data: {
                labels: ['Início', 'Agora'],
                datasets: [{
                    label: 'Mini Índice (WIN)',
                    data: [120000, 120500],
                    borderColor: '#0f0',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false // IMPORTANTE: permite que o gráfico use a altura do container
            }
        };

        // Criar o gráfico
        const meuGrafico = new Chart(ctx, config);

        // 3. Simulação de atualização
        setInterval(() => {
            const novaHora = new Date().toLocaleTimeString('pt-BR', {timeZone: 'America/Sao_Paulo'});
            const novoValor = 120000 + (Math.random() * 500);
            
            meuGrafico.data.labels.push(novaHora);
            meuGrafico.data.datasets[0].data.push(novoValor);

            if(meuGrafico.data.labels.length > 10) {
                meuGrafico.data.labels.shift();
                meuGrafico.data.datasets[0].data.shift();
            }
            meuGrafico.update();
        }, 3000);
    </script>
</body>
</html>
