<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sentimento de Mercado â€“ Risco x SeguranÃ§a</title>

<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>

<style>
    body {
        margin: 0;
        background: #0e0e0e;
        color: #e0e0e0;
        font-family: Arial, sans-serif;
    }
    h2 {
        padding: 12px;
        margin: 0;
    }
    #chart {
        width: 100vw;
        height: 520px;
    }
</style>
</head>

<body>

<h2>ğŸ“Š Sentimento de Mercado â€“ DireÃ§Ã£o do Dia</h2>
<div id="chart"></div>

<script>
/* â”€â”€â”€â”€â”€ CONFIGURAÃ‡Ã•ES â”€â”€â”€â”€â”€ */
const MINUTES_PER_DAY = 390;   // pregÃ£o
const UPDATE_INTERVAL = 60000; // 1 minuto

/* â”€â”€â”€â”€â”€ CRIAR GRÃFICO â”€â”€â”€â”€â”€ */
const container = document.getElementById('chart');

const chart = LightweightCharts.createChart(container, {
    width: container.clientWidth,
    height: container.clientHeight,
    layout: {
        background: { color: '#0e0e0e' },
        textColor: '#cccccc',
    },
    grid: {
        vertLines: { color: '#222' },
        horzLines: { color: '#222' },
    },
    timeScale: {
        timeVisible: true,
        secondsVisible: false,
    },
});

/* â”€â”€â”€â”€â”€ SÃ‰RIES â”€â”€â”€â”€â”€ */
const riskSeries = chart.addLineSeries({
    color: '#00ff88',
    lineWidth: 3,
});

const safetySeries = chart.addLineSeries({
    color: '#ff4444',
    lineWidth: 3,
});

/* â”€â”€â”€â”€â”€ ESTADO â”€â”€â”€â”€â”€ */
let risk = 100;
let safety = 100;

const riskData = [];
const safetyData = [];

/* â”€â”€â”€â”€â”€ FUNÃ‡ÃƒO RANDOM WALK NORMALIZADA â”€â”€â”€â”€â”€ */
function step(current, volatility) {
    return current * (1 + (Math.random() - 0.5) * volatility);
}

/* â”€â”€â”€â”€â”€ INICIALIZA HISTÃ“RICO DO DIA â”€â”€â”€â”€â”€ */
(function initDay() {
    const now = Math.floor(Date.now() / 1000);
    let t = now - MINUTES_PER_DAY * 60;

    for (let i = 0; i < MINUTES_PER_DAY; i++) {
        risk = step(risk, 0.0025);      // risco oscila mais
        safety = step(safety, 0.0012);  // seguranÃ§a oscila menos

        riskData.push({ time: t, value: risk });
        safetyData.push({ time: t, value: safety });

        t += 60;
    }

    riskSeries.setData(riskData);
    safetySeries.setData(safetyData);
})();

/* â”€â”€â”€â”€â”€ ATUALIZA A CADA 1 MINUTO â”€â”€â”€â”€â”€ */
function update() {
    const now = Math.floor(Date.now() / 1000);

    risk = step(risk, 0.003);
    safety = step(safety, 0.0015);

    riskData.push({ time: now, value: risk });
    safetyData.push({ time: now, value: safety });

    // mantÃ©m sÃ³ o dia atual
    if (riskData.length > MINUTES_PER_DAY) {
        riskData.shift();
        safetyData.shift();
    }

    riskSeries.setData(riskData);
    safetySeries.setData(safetyData);
}

setInterval(update, UPDATE_INTERVAL);

/* â”€â”€â”€â”€â”€ RESIZE â”€â”€â”€â”€â”€ */
window.addEventListener('resize', () => {
    chart.resize(container.clientWidth, container.clientHeight);
});
</script>

</body>
</html>
