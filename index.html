<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Direção Intraday do Dólar</title>

<script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>

<style>
body{
  background:#0e0e0e;
  color:#e0e0e0;
  font-family:Arial, Helvetica, sans-serif;
  margin:20px;
}
#grafico{
  width:100%;
  height:520px;
  background:#111;
  border-radius:8px;
}
h2{margin-bottom:5px}
p{color:#aaa;margin-top:0}
</style>
</head>

<body>

<h2>Direção Intraday do Dólar</h2>
<p>Ativos de Risco (verde) × Ativos de Segurança (vermelho) • Atualização 60s</p>

<div id="grafico"></div>

<script>
/* =========================
   SUA API
========================= */
const API_KEY = "d58a789r01qptoar8c7gd58a789r01qptoar8c80";
const INTERVALO = "1min";

/* =========================
   ATIVOS DA CARTEIRA
========================= */
const ativosRisco = [
  "XAU/USD","HG","CL","EWZ","VALE","PBR",
  "XLF","XLP","XLE","XME","EEM","SOXX"
];

const ativosSeguranca = [
  "DXY","USD/NOK","USD/AUD","USD/NZD",
  "USD/KRW","USD/CNY","EUR/BRL"
];

/* =========================
   BUSCA DIREÇÃO
========================= */
async function direcao(symbol){
  const url = `https://api.twelvedata.com/time_series?symbol=${symbol}&interval=${INTERVALO}&outputsize=2&apikey=${API_KEY}`;
  try{
    const r = await fetch(url);
    const d = await r.json();
    if(!d.values || d.values.length < 2) return 0;

    const atual = parseFloat(d.values[0].close);
    const anterior = parseFloat(d.values[1].close);

    return atual > anterior ? 1 : atual < anterior ? -1 : 0;
  }catch{
    return 0;
  }
}

/* =========================
   SCORE MÉDIO POR GRUPO
========================= */
async function scoreGrupo(lista){
  let soma = 0, total = 0;
  for(let s of lista){
    const d = await direcao(s);
    if(d !== 0){
      soma += d;
      total++;
    }
  }
  return total ? +(soma / total).toFixed(2) : 0;
}

/* =========================
   GRÁFICO
========================= */
const chart = echarts.init(document.getElementById("grafico"));
let horas = [], risco = [], seguranca = [];

async function atualizar(){
  const hora = new Date().toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});

  const scoreRisco = await scoreGrupo(ativosRisco);
  const scoreSeg = await scoreGrupo(ativosSeguranca);

  horas.push(hora);
  risco.push(scoreRisco);
  seguranca.push(scoreSeg);

  if(horas.length > 120){
    horas.shift();
    risco.shift();
    seguranca.shift();
  }

  chart.setOption({
    backgroundColor:"#111",
    tooltip:{trigger:"axis"},
    legend:{
      data:["Ativos de Risco","Ativos de Segurança"],
      textStyle:{color:"#ccc"}
    },
    xAxis:{
      type:"category",
      data:horas,
      axisLabel:{color:"#aaa"}
    },
    yAxis:{
      min:-1,
      max:1,
      splitLine:{lineStyle:{color:"#222"}},
      axisLabel:{color:"#aaa"}
    },
    series:[
      {
        name:"Ativos de Risco",
        type:"line",
        smooth:true,
        data:risco,
        lineStyle:{width:2,color:"#00c853"} // VERDE
      },
      {
        name:"Ativos de Segurança",
        type:"line",
        smooth:true,
        data:seguranca,
        lineStyle:{width:2,color:"#d50000"} // VERMELHO
      }
    ]
  });
}

/* =========================
   LOOP AUTOMÁTICO
========================= */
atualizar();
setInterval(atualizar, 60000);
</script>

</body>
</html>
