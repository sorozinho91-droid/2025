<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard – Ativos de Risco x Seguros</title>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #f4f6f8;
}

header {
    background: #1f2937;
    color: white;
    padding: 15px;
    text-align: center;
}

#controls {
    text-align: center;
    padding: 10px;
}

button {
    margin: 5px;
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    background: #e5e7eb;
}

button.active {
    background: #2563eb;
    color: white;
}

#grafico {
    width: 100%;
    height: 500px;
}
</style>
</head>

<body>

<header>
    <h2>Ativos de Risco x Seguros – Dashboard</h2>
</header>

<div id="controls">
    <button onclick="setTimeframe(1, this)" class="active">1m</button>
    <button onclick="setTimeframe(5, this)">5m</button>
    <button onclick="setTimeframe(15, this)">15m</button>
    <button onclick="setTimeframe(60, this)">1h</button>
</div>

<div id="grafico"></div>

<script>
/* ================== VARIÁVEIS ================== */
let timeframe = 1;        // minutos
let timer = null;

let datas = [];
let risco = [];
let seguro = [];

let valorRisco = 100;
let valorSeguro = 100;

/* ================== FUNÇÃO DADOS ================== */
function atualizarValores(valor, volatilidade) {
    return Math.max(0, valor + (Math.random() - 0.5) * volatilidade);
}

function atualizarGrafico() {
    const hora = new Date().toLocaleTimeString();

    valorRisco = atualizarValores(valorRisco, 2);
    valorSeguro = atualizarValores(valorSeguro, 0.5);

    datas.push(hora);
    risco.push(valorRisco);
    seguro.push(valorSeguro);

    if (datas.length > 120) {
        datas.shift();
        risco.shift();
        seguro.shift();
    }

    Plotly.update('grafico', {
        x: [datas, datas],
        y: [risco, seguro]
    });
}

/* ================== GRÁFICO ================== */
const data = [
    {
        x: datas,
        y: risco,
        mode: 'lines',
        name: 'Ativos de Risco',
        line: { color: 'red' }
    },
    {
        x: datas,
        y: seguro,
        mode: 'lines',
        name: 'Ativos Seguros',
        line: { color: 'green' }
    }
];

const layout = {
    title: 'Comparação em Tempo Real',
    xaxis: { title: 'Hora' },
    yaxis: { title: 'Valor' },
    margin: { t: 50 }
};

Plotly.newPlot('grafico', data, layout, { responsive: true });

/* ================== TIMEFRAME ================== */
function setTimeframe(minutos, botao) {
    timeframe = minutos;

    // Remove classe active
    document.querySelectorAll('#controls button')
        .forEach(b => b.classList.remove('active'));

    // Ativa botão clicado
    botao.classList.add('active');

    // Reinicia timer
    if (timer) clearInterval(timer);
    timer = setInterval(atualizarGrafico, timeframe * 60000);
}

/* ================== INICIALIZAÇÃO ================== */
atualizarGrafico();
timer = setInterval(atualizarGrafico, 60000);

/* ================== RESPONSIVO ================== */
window.addEventListener('resize', () => {
    Plotly.Plots.resize('grafico');
});
</script>

</body>
</html>
