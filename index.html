<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Seguro x Risco</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<h2>Ativos de Segurança x Risco</h2>
<canvas id="grafico"></canvas>

<script>
let chart;
let labels = [];
let dadosRisco = [];
let dadosSeguranca = [];

async function atualizar() {
  const res = await fetch("dados.json"); // ou endpoint da API
  const data = await res.json();

  const media = arr =>
    arr.reduce((s, x) => s + x.var, 0) / arr.length;

  labels.push(data.timestamp);
  dadosRisco.push(media(data.risco));
  dadosSeguranca.push(media(data.seguranca));

  renderizar();
}

function renderizar() {
  if (chart) chart.destroy();

  chart = new Chart(document.getElementById("grafico"), {
    type: "line",
    data: {
      labels,
      datasets: [
        {
          label: "Risco",
          data: dadosRisco,
          borderWidth: 2
        },
        {
          label: "Segurança",
          data: dadosSeguranca,
          borderWidth: 2
        }
      ]
    },
    options: {
      responsive: true,
      interaction: { mode: "index", intersect: false }
    }
  });
}

atualizar();
setInterval(atualizar, 60000);
</script>

</body>
</html>
