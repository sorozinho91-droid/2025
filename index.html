<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Direção Intraday do Dólar (Simulada Tendência)</title>

<script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>

<style>
body{
  background:#0e0e0e;
  color:#e0e0e0;
  font-family:Arial, Helvetica, sans-serif;
  margin:20px;
}
#grafico{
  width:100%;
  height:520px;
  background:#111;
  border-radius:8px;
}
#sinal{
  font-size:22px;
  font-weight:bold;
  margin-top:10px;
}
.compra{color:#00c853}
.venda{color:#d50000}
.neutro{color:#ffeb3b}
</style>
</head>

<body>

<h2>Direção Intraday do Dólar (Simulada Tendência)</h2>
<p>Risco × Segurança (dados simulados) • Atualização 60s</p>

<div id="grafico"></div>
<div id="sinal" class="neutro">SINAL: AGUARDANDO DADOS…</div>

<script>
/* =========================
   GRÁFICO
========================= */
const chart = echarts.init(document.getElementById("grafico"));

let eixoX = [];
let serieRisco = [];
let serieSeg = [];
let serieDiff = [];

/* =========================
   FUNÇÃO DE SIMULAÇÃO COM TENDÊNCIA
========================= */
let tendencia = 0; 

function gerarDirecaoTendencia(){
  const delta = (Math.random() - 0.5) * 0.2; 
  tendencia += delta;
  if(tendencia > 1) tendencia = 1;
  if(tendencia < -1) tendencia = -1;
  return tendencia;
}

function scoreRiscoSimulado(){
  let soma = 0, total = 5;
  for(let i=0;i<total;i++){
    soma += gerarDirecaoTendencia();
  }
  return soma / total;
}

function scoreSegurancaSimulado(){
  let soma = 0;
  let pesos = [3,1,1,1,1,1,1];
  for(let i=0;i<pesos.length;i++){
    soma += -gerarDirecaoTendencia() * pesos[i]; // <- inverter direção para caminhar oposto
  }
  const totalPeso = pesos.reduce((a,b)=>a+b,0);
  return soma / totalPeso;
}

/* =========================
   ATUALIZAÇÃO DO GRÁFICO
========================= */
function atualizarSimulado(){
  const hora = new Date().toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});

  const r = scoreRiscoSimulado();
  const s = scoreSegurancaSimulado();
  const d = +(s - r).toFixed(2);

  eixoX.push(hora);
  serieRisco.push(+r.toFixed(2));
  serieSeg.push(+s.toFixed(2));
  serieDiff.push(d);

  if(eixoX.length > 120){
    eixoX.shift();
    serieRisco.shift();
    serieSeg.shift();
    serieDiff.shift();
  }

  /* ===== SINAL ===== */
  const sinal = document.getElementById("sinal");
  if(d > 0.25){
    sinal.textContent = "SINAL: COMPRA DÓLAR";
    sinal.className = "compra";
  }else if(d < -0.25){
    sinal.textContent = "SINAL: VENDA DÓLAR";
    sinal.className = "venda";
  }else{
    sinal.textContent = "SINAL: NEUTRO";
    sinal.className = "neutro";
  }

  chart.setOption({
    backgroundColor:"#111",
    tooltip:{
      trigger:"axis",
      formatter: function(params){
        return params.map(p => `${p.seriesName}: ${p.data.toFixed(2)}`).join("<br>");
      }
    },
    legend:{
      data:["Risco","Segurança","Diferença"],
      textStyle:{color:"#ccc"}
    },
    xAxis:{
      type:"category",
      data:eixoX,
      axisLabel:{color:"#aaa"}
    },
    yAxis:{
      scale:true,
      axisLabel:{color:"#aaa"},
      splitLine:{lineStyle:{color:"#222"}}
    },
    series:[
      {
        name:"Risco",
        type:"line",
        smooth:true,
        showSymbol:false,
        data:serieRisco,
        lineStyle:{color:"#00c853",width:2}
      },
      {
        name:"Segurança",
        type:"line",
        smooth:true,
        showSymbol:false,
        data:serieSeg,
        lineStyle:{color:"#d50000",width:2,type:"dashed"} // linha tracejada
      },
      {
        name:"Diferença",
        type:"line",
        smooth:true,
        showSymbol:true,
        symbol:"circle",
        symbolSize:6,
        data:serieDiff,
        lineStyle:{color:"#ffeb3b",width:3},
        markLine:{
          data:[
            {yAxis:0.25, name:"Limite Compra", lineStyle:{color:"#00c853",type:"dashed"}},
            {yAxis:-0.25, name:"Limite Venda", lineStyle:{color:"#d50000",type:"dashed"}}
          ]
        }
      }
    ]
  });
}

/* =========================
   LOOP 60s
========================= */
atualizarSimulado();
setInterval(atualizarSimulado, 60000);
</script>

</body>
</html>
