<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sentimento de Mercado â€“ Risco x SeguranÃ§a</title>

<script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>

<style>
html, body {
    margin: 0;
    width: 100%;
    height: 100%;
    background: #0e0e0e;
    color: #eee;
    font-family: Arial, sans-serif;
}
#wrapper {
    height: 100%;
    display: flex;
    flex-direction: column;
}
h2 {
    margin: 0;
    padding: 10px;
}
#legend {
    display: flex;
    gap: 20px;
    padding: 8px 12px;
    font-size: 14px;
}
.legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
}
.box {
    width: 12px;
    height: 12px;
}
.green { background: #00ff88; }
.red { background: #ff4444; }

#chart {
    flex: 1;
}
</style>
</head>

<body>

<div id="wrapper">
    <h2>ğŸ“Š Sentimento de Mercado â€“ DireÃ§Ã£o do Dia</h2>

    <div id="legend">
        <div class="legend-item">
            <div class="box green"></div> RISCO (Risk-On)
        </div>
        <div class="legend-item">
            <div class="box red"></div> SEGURANÃ‡A (Risk-Off)
        </div>
    </div>

    <div id="chart"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

    /* â”€â”€â”€â”€â”€ FUNÃ‡ÃƒO HORÃRIO DE BRASÃLIA â”€â”€â”€â”€â”€ */
    function timeBrasilia() {
        return Math.floor(Date.now() / 1000) - (3 * 60 * 60);
    }

    const container = document.getElementById("chart");

    const chart = LightweightCharts.createChart(container, {
        layout: {
            background: { color: "#0e0e0e" },
            textColor: "#cccccc"
        },
        timeScale: {
            timeVisible: true,
            secondsVisible: false
        }
    });

    const riskSeries = chart.addLineSeries({
        color: "#00ff88",
        lineWidth: 3
    });

    const safetySeries = chart.addLineSeries({
        color: "#ff4444",
        lineWidth: 3
    });

    const MINUTES = 390;
    let risk = 100;
    let safety = 100;

    const riskData = [];
    const safetyData = [];

    function step(v, vol) {
        return v * (1 + (Math.random() - 0.5) * vol);
    }

    /* â”€â”€â”€â”€â”€ HISTÃ“RICO INICIAL (BRASÃLIA) â”€â”€â”€â”€â”€ */
    let t = timeBrasilia() - MINUTES * 60;

    for (let i = 0; i < MINUTES; i++) {
        risk = step(risk, 0.0025);
        safety = step(safety, 0.0015);

        riskData.push({ time: t, value: risk });
        safetyData.push({ time: t, value: safety });

        t += 60;
    }

    riskSeries.setData(riskData);
    safetySeries.setData(safetyData);

    chart.timeScale().scrollToRealTime();

    /* â”€â”€â”€â”€â”€ ATUALIZA A CADA 1 MINUTO â”€â”€â”€â”€â”€ */
    setInterval(() => {
        const now = timeBrasilia();

        risk = step(risk, 0.003);
        safety = step(safety, 0.0015);

        const rPoint = { time: now, value: risk };
        const sPoint = { time: now, value: safety };

        riskData.push(rPoint);
        safetyData.push(sPoint);

        if (riskData.length > MINUTES) {
            riskData.shift();
            safetyData.shift();
        }

        riskSeries.update(rPoint);
        safetySeries.update(sPoint);

        chart.timeScale().scrollToRealTime();

    }, 60000);

    window.addEventListener("resize", () => {
        chart.resize(container.clientWidth, container.clientHeight);
    });

});
</script>

</body>
</html>
