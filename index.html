<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Tendência Intraday do Dólar</title>

<!-- ECharts -->
<script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>

<style>
  body {
    background: #0e0e0e;
    color: #e0e0e0;
    font-family: Arial, Helvetica, sans-serif;
    margin: 20px;
  }

  h2 {
    margin-bottom: 10px;
  }

  #info {
    font-size: 13px;
    color: #aaa;
    margin-bottom: 10px;
  }

  #grafico {
    width: 100%;
    height: 520px;
    background: #111;
    border-radius: 6px;
  }
</style>
</head>

<body>

<h2>Tendência Intraday do Dólar</h2>
<div id="info">Atualização automática a cada 60 segundos</div>
<div id="grafico"></div>

<script>
/* ================================
   CONFIGURAÇÕES
================================ */
const API_URL = "http://localhost:8000/api/score"; // backend
const UPDATE_INTERVAL = 60000;

/* ================================
   INICIALIZA GRÁFICO
================================ */
const chart = echarts.init(document.getElementById('grafico'));

/* ================================
   FUNÇÃO DE ATUALIZAÇÃO
================================ */
function atualizarGrafico() {
  fetch(API_URL)
    .then(res => res.json())
    .then(dados => {

      const horas  = dados.historico.map(p => p.hora);
      const scores = dados.historico.map(p => p.score);

      chart.setOption({
        backgroundColor: '#111',

        tooltip: {
          trigger: 'axis',
          formatter: (params) => {
            const p = params[0];
            return `
              Hora: ${p.axisValue}<br>
              Score Dólar: <b>${p.data}</b>
            `;
          }
        },

        xAxis: {
          type: 'category',
          data: horas,
          axisLabel: { color: '#aaa' },
          axisLine: { lineStyle: { color: '#444' } }
        },

        yAxis: {
          min: -1,
          max: 1,
          splitLine: { lineStyle: { color: '#222' } },
          axisLabel: { color: '#aaa' },
          axisLine: { lineStyle: { color: '#444' } }
        },

        visualMap: {
          show: false,
          pieces: [
            { gt: dados.zona_alta, color: '#00c853' },       // Alta
            { gte: dados.zona_baixa, lte: dados.zona_alta, color: '#9e9e9e' }, // Neutro
            { lt: dados.zona_baixa, color: '#d50000' }      // Baixa
          ]
        },

        series: [{
          type: 'line',
          data: scores,
          smooth: true,
          symbol: 'circle',
          symbolSize: 6,
          lineStyle: {
            width: 2
          }
        }]
      });
    })
    .catch(err => {
      console.error("Erro ao buscar dados:", err);
    });
}

/* ================================
   LOOP TEMPO REAL
================================ */
atualizarGrafico();
setInterval(atualizarGrafico, UPDATE_INTERVAL);
</script>

</body>
</html>
