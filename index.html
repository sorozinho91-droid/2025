<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Risco x Segurança – Gráfico Simulado</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f4f6f8; }
header { background:#1f2937; color:white; padding:15px; text-align:center; }
#grafico { width:100%; max-width:1200px; height:500px; margin:20px auto; background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
#ativosControle { width:90%; max-width:1200px; margin:0 auto; padding:10px; text-align:center; }
</style>
</head>
<body>

<header>
<h2>Dashboard – Risco x Segurança (Simulado)</h2>
</header>

<div id="ativosControle"></div>
<div id="grafico"></div>

<script>
// ===== Horário de Brasília =====
function agoraBrasilia(){
    const agora = new Date();
    const offset = -3;
    const utc = agora.getTime() + (agora.getTimezoneOffset()*60000);
    return new Date(utc + (3600000*offset));
}

// ===== Ativos simulados =====
let ativosRisco = [
  {nome:"Ouro Futuros", valor:1800, selected:true},
  {nome:"Petróleo WTI", valor:70, selected:true},
  {nome:"Vale SA ADR", valor:10, selected:true},
  {nome:"Petrobras ADR", valor:15, selected:true},
  {nome:"Cobre Futuros", valor:4, selected:true}
];
let ativosSeguranca = [
  {nome:"DXY - Índice Dólar", valor:107, selected:true},
  {nome:"EUR/BRL", valor:6.1, selected:true},
  {nome:"S&P 500 VIX", valor:17, selected:true},
  {nome:"USD/MXN", valor:20.6, selected:true},
  {nome:"USD/NOK", valor:11.2, selected:true}
];

// ===== Histórico =====
let datas=[], historico={};

// ===== Criar checkboxes =====
function criarCheckboxes(){
    const container = document.getElementById("ativosControle");
    container.innerHTML = "<strong>Selecione ativos:</strong> ";
    [...ativosRisco, ...ativosSeguranca].forEach((a,i)=>{
        let cb = document.createElement("input");
        cb.type="checkbox"; cb.checked=a.selected;
        cb.id="ativo"+i;
        cb.onchange = ()=>{a.selected=cb.checked; plotGrafico();};
        let label = document.createElement("label");
        label.htmlFor="ativo"+i; label.style.margin="0 10px"; label.textContent=a.nome;
        container.appendChild(cb); container.appendChild(label);
    });
}

// ===== Atualiza dados simulados =====
function atualizarSimulado(){
    const agora = agoraBrasilia();
    datas.push(agora);

    [...ativosRisco, ...ativosSeguranca].forEach(a=>{
        let variacao = (Math.random()-0.5) * (a.nome.includes("VIX")?0.5:1);
        a.valor += variacao;

        if(!historico[a.nome]) historico[a.nome]=[];
        historico[a.nome].push(a.valor);
        if(historico[a.nome].length>1440) historico[a.nome].shift(); // até 24h
    });

    if(datas.length>1440) datas.shift();
    plotGrafico();
}

// ===== Plotar gráfico =====
function plotGrafico(){
    let traces=[];
    [...ativosRisco, ...ativosSeguranca].forEach(a=>{
        if(a.selected && historico[a.nome]){
            traces.push({x:datas, y:historico[a.nome], mode:'lines+markers', name:a.nome});
        }
    });
    Plotly.react('grafico', traces,{
        title:'Linha do Tempo – Risco x Segurança',
        xaxis:{title:'Horário (BR)', type:'date', rangeslider:{visible:true}},
        yaxis:{title:'Valor'},
        margin:{t:40,l:50,r:50,b:50},
        legend:{x:1,xanchor:'right',y:1}
    });
}

// ===== Inicialização =====
function iniciarDashboard(){
    criarCheckboxes();
    setInterval(atualizarSimulado,60000); // atualiza a cada 60s
    atualizarSimulado(); // primeira atualização
}
iniciarDashboard();
window.addEventListener('resize',()=>{ Plotly.Plots.resize('grafico'); });
</script>

</body>
</html>
