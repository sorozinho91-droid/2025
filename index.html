<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard – Ativos de Risco x Segurança</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
body { font-family: Arial, sans-serif; margin: 0; background: #f4f6f8; }
header { background: #1f2937; color: white; padding: 15px; text-align: center; }
#controls, #compareDates { text-align: center; padding: 10px; }
button { margin: 5px; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; background: #e5e7eb; }
button.active { background: #2563eb; color: white; }
#grafico { width: 100%; height: 600px; }
#explicacao { max-width:900px; margin:20px auto; background:white; padding:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
table { width:100%; border-collapse:collapse; margin-top:20px; }
th, td { padding:8px; border:1px solid #ccc; text-align:center; }
thead th { background:#2563eb; color:white; }
tbody tr:nth-child(even){ background:#f3f4f6; }
.risco { color:red; }
.seguro { color:green; }
</style>
</head>
<body>

<header>
<h2>Dashboard – Ativos de Risco x Segurança (1 Dia)</h2>
</header>

<div id="explicacao">
<p><strong>Ativos de Risco:</strong> Commodities voláteis, ADRs de mineração e petróleo, ETFs de setores arriscados, pares de moedas emergentes, VIX.</p>
<p><strong>Ativos de Segurança:</strong> Índices consolidados, ETFs de setores estáveis, Dólar futuro, moedas fortes.</p>
</div>

<div id="controls">
<button onclick="setTimeframe(60, this)" class="active">60s</button>
<button onclick="setTimeframe(1, this)">1m</button>
</div>

<div id="compareDates">
<label>Início: <input type="datetime-local" id="startDate"></label>
<label>Fim: <input type="datetime-local" id="endDate"></label>
<button onclick="filtrarPorData()">Comparar</button>
<button onclick="resetGrafico()">Resetar</button>
</div>

<div id="grafico"></div>

<div id="tabelas">
  <table id="tabelaRisco">
    <thead>
      <tr><th>Ativo de Risco</th><th>Preço Atual</th><th>Variação (%)</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <table id="tabelaSeguro">
    <thead>
      <tr><th>Ativo de Segurança</th><th>Preço Atual</th><th>Variação (%)</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
// ==== Variáveis globais ====
let timeframe = 60; // segundos
let timer = null;
let datas = [], risco = [], seguro = [];

// Ativos iniciais
let ativosRisco = [
  {nome:"Ouro Futuros", valor:2766.2},
  {nome:"Cobre Futuros", valor:4.2315},
  {nome:"Petróleo WTI Futuros", valor:73.17},
  {nome:"Vale SA ADR", valor:9.16},
  {nome:"Petrobras ADR", valor:13.88},
  {nome:"iShares MSCI Brazil ETF", valor:24.64},
  {nome:"Energy Select Sector", valor:90.36},
  {nome:"SPDR Metals Mining ETF", valor:58.68},
  {nome:"iShares Emerging Markets", valor:42.17},
  {nome:"iShares Semiconductor", valor:212.55},
  {nome:"S&P 500 VIX Futuros", valor:17.61},
  {nome:"USD/MXN", valor:20.665},
  {nome:"USD/KRW", valor:1432.84}
];

let ativosSeguranca = [
  {nome:"Oslo All Share", valor:1709.43},
  {nome:"Soja Chicago Futuros", valor:1045},
  {nome:"Dow Jones Futuros", valor:44904},
  {nome:"The Global Dow USD", valor:5079.14},
  {nome:"Financial Select Sector", valor:51.41},
  {nome:"Consumer Staples", valor:80.01},
  {nome:"BSE Sensex 30", valor:75366.17},
  {nome:"Índice Dólar Futuros", valor:107.16},
  {nome:"USD/NOK", valor:11.2378},
  {nome:"USD/NZD", valor:1.7565},
  {nome:"USD/AUD", valor:1.5892},
  {nome:"USD/CNY", valor:7.2509},
  {nome:"EUR/BRL", valor:6.1843}
];

// Calcula média inicial
let valorRisco = ativosRisco.reduce((a,b)=>a+b.valor,0)/ativosRisco.length;
let valorSeguro = ativosSeguranca.reduce((a,b)=>a+b.valor,0)/ativosSeguranca.length;

// Layout do gráfico
const layout = {
    title:'Ativos em Tempo Real',
    xaxis:{title:'Data', type:'date', tickformat:'%d/%m %H:%M', rangeslider:{visible:true}},
    yaxis:{title:'Valor'},
    margin:{t:50},
    legend: {x:1, xanchor:'right', y:1}
};

// ==== Funções ====

// Atualização com ruído
function atualizarValor(valor, vol, tendencia=0){
    return Math.max(0, valor + (Math.random()-0.5)*vol + tendencia);
}

// Histórico de 1 dia
function gerarHistorico1Dia(){
    const agora = new Date();
    const start = new Date(agora.getTime() - 24*60*60*1000);
    datas = []; risco = []; seguro = [];
    let valR = valorRisco;
    let valS = valorSeguro;
    for(let d = new Date(start); d <= agora; d.setMinutes(d.getMinutes()+1)){
        valR = atualizarValor(valR,2,0.1);
        valS = atualizarValor(valS,0.5,0.02);
        datas.push(new Date(d));
        risco.push(valR);
        seguro.push(valS);
    }
    valorRisco = valR;
    valorSeguro = valS;
}

// Atualiza gráfico e tabela
function atualizarGrafico(){
    const agora = new Date();
    valorRisco = atualizarValor(valorRisco,2,0.1);
    valorSeguro = atualizarValor(valorSeguro,0.5,0.02);
    datas.push(agora);
    risco.push(valorRisco);
    seguro.push(valorSeguro);
    Plotly.extendTraces('grafico',{x:[[agora],[agora]], y:[[valorRisco],[valorSeguro]]},[0,1]);

    // Atualiza preços individuais
    ativosRisco.forEach(a=>{
        let novo = atualizarValor(a.valor,2,0.05);
        a.variacao = ((novo - a.valor)/a.valor)*100;
        a.valor = novo;
    });
    ativosSeguranca.forEach(a=>{
        let novo = atualizarValor(a.valor,0.5,0.01);
        a.variacao = ((novo - a.valor)/a.valor)*100;
        a.valor = novo;
    });
    atualizarTabelas();
}

// Atualiza tabelas
function atualizarTabelas(){
    const tbodyR = document.querySelector("#tabelaRisco tbody");
    tbodyR.innerHTML = "";
    ativosRisco.forEach(a=>{
        let tr = document.createElement("tr");
        tr.innerHTML = `<td class="risco">${a.nome}</td><td>${a.valor.toFixed(2)}</td><td>${a.variacao.toFixed(2)}%</td>`;
        tbodyR.appendChild(tr);
    });
    const tbodyS = document.querySelector("#tabelaSeguro tbody");
    tbodyS.innerHTML = "";
    ativosSeguranca.forEach(a=>{
        let tr = document.createElement("tr");
        tr.innerHTML = `<td class="seguro">${a.nome}</td><td>${a.valor.toFixed(2)}</td><td>${a.variacao.toFixed(2)}%</td>`;
        tbodyS.appendChild(tr);
    });
}

// Alterar timeframe
function setTimeframe(segundos, botao){
    timeframe = segundos;
    document.querySelectorAll('#controls button').forEach(b=>b.classList.remove('active'));
    botao.classList.add('active');
    if(timer) clearInterval(timer);
    timer = setInterval(atualizarGrafico, timeframe*1000);
}

// Filtrar gráfico por datas
function filtrarPorData(){
    const start = new Date(document.getElementById('startDate').value);
    const end = new Date(document.getElementById('endDate').value);
    if(isNaN(start) || isNaN(end)){
        alert("Selecione datas válidas");
        return;
    }

    const newRisco = [], newSeguro =
